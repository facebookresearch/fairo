
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Usage &#8212; Polymetis  documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="shortcut icon" href="_static/polymetis-favicon.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Installation" href="installation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/polymetis-logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Polymetis  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="prereq.html">
   Prerequisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   Troubleshooting
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="polymetis-doc.html">
   Polymetis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="polysim-doc.html">
   Polysim
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="torchcontrol-doc.html">
   TorchControl
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="modules.html">
   Autogenerated docs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="polymetis.html">
     polymetis package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="polymetis.robot_client.html">
       polymetis.robot_client package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="polymetis.utils.html">
       polymetis.utils package
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="polysim.html">
     polysim package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="polysim.envs.html">
       polysim.envs package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="simple">
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="torchcontrol.html">
     torchcontrol package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="torchcontrol.models.html">
       torchcontrol.models package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torchcontrol.modules.html">
       torchcontrol.modules package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torchcontrol.policies.html">
       torchcontrol.policies package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torchcontrol.transform.html">
       torchcontrol.transform package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="torchcontrol.utils.html">
       torchcontrol.utils package
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/usage.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-server-and-robot-client-simulation">
   Running the server and robot client (simulation)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-both-server-client-on-your-machine">
     Run both server &amp; client
     <strong>
      on your machine
     </strong>
     :
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-server-and-robot-client-on-franka-panda-hardware">
   Running the server and robot client on Franka Panda hardware
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-the-server-on-the-nuc">
     Run the server
     <strong>
      on the NUC
     </strong>
     :
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-user-code-controllers-on-your-machine">
     Running user-code controllers
     <strong>
      on your machine
     </strong>
     :
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-gripper-on-your-machine">
   Running the gripper
   <strong>
    on your machine
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-allegro-hand-client">
   Using the Allegro Hand Client
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Usage</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-server-and-robot-client-simulation">
   Running the server and robot client (simulation)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-both-server-client-on-your-machine">
     Run both server &amp; client
     <strong>
      on your machine
     </strong>
     :
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-server-and-robot-client-on-franka-panda-hardware">
   Running the server and robot client on Franka Panda hardware
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-the-server-on-the-nuc">
     Run the server
     <strong>
      on the NUC
     </strong>
     :
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-user-code-controllers-on-your-machine">
     Running user-code controllers
     <strong>
      on your machine
     </strong>
     :
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-gripper-on-your-machine">
   Running the gripper
   <strong>
    on your machine
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-allegro-hand-client">
   Using the Allegro Hand Client
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="running-the-server-and-robot-client-simulation">
<h2>Running the server and robot client (simulation)<a class="headerlink" href="#running-the-server-and-robot-client-simulation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="run-both-server-client-on-your-machine">
<h3>Run both server &amp; client <strong>on your machine</strong>:<a class="headerlink" href="#run-both-server-client-on-your-machine" title="Permalink to this headline">¶</a></h3>
<p>To run the server and robot client for Franka:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>launch_robot.py <span class="nv">robot_client</span><span class="o">=</span>franka_sim <span class="nv">use_real_time</span><span class="o">=</span><span class="nb">false</span> <span class="nv">gui</span><span class="o">=[</span>true<span class="p">|</span>false<span class="o">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">launch_robot.py</span></code> is an executable script which starts both a controller manager server and a robot client which connects to it, and is installed as a script with the conda package by default in <code class="docutils literal notranslate"><span class="pre">$CONDA_PREFIX/bin</span></code>. It utilizes <a class="reference external" href="https://hydra.cc/">Hydra</a> configurations to easily swap between simulation and hardware.</p>
<p>For simulation, the <code class="docutils literal notranslate"><span class="pre">gui</span></code> option controls whether the PyBullet simulation renders, and requires an active display (i.e. you may need to use VNC if <code class="docutils literal notranslate"><span class="pre">ssh</span></code>ing).</p>
</div>
</div>
<div class="section" id="running-the-server-and-robot-client-on-franka-panda-hardware">
<h2>Running the server and robot client on Franka Panda hardware<a class="headerlink" href="#running-the-server-and-robot-client-on-franka-panda-hardware" title="Permalink to this headline">¶</a></h2>
<div class="section" id="run-the-server-on-the-nuc">
<h3>Run the server <strong>on the NUC</strong>:<a class="headerlink" href="#run-the-server-on-the-nuc" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Wait for your robot to boot up (wait for the blinking yellow light turns solid yellow).</p></li>
<li><p>If your robot has its joints locked (yellow light), unlock it from Franka Desk.</p></li>
<li><p>If your robot’s external activation device (EAD) is not released (white light), release it (blue light). (If you disconnect from the robot for any reason, you need to re-release the EAD.)</p></li>
</ol>
<p>Then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the NUC</span>
launch_robot.py <span class="nv">robot_client</span><span class="o">=</span>franka_hardware
</pre></div>
</div>
<p>For hardware, <code class="docutils literal notranslate"><span class="pre">use_real_time</span></code> acquires the necessary <code class="docutils literal notranslate"><span class="pre">sudo</span></code> rights for real-time optimizations (see <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/polymetis/polymetis/include/real_time.hpp">here</a> for the specific optimizations.)</p>
<p>For debugging and calibration purposes, we provide a read-only mode for the robot client, where no torques will be applied to the robot but robot states are still recorded normally. To launch the robot client in read-only mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On the NUC</span>
launch_robot.py <span class="nv">robot_client</span><span class="o">=</span>franka_hardware robot_client.executable_cfg.readonly<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
</div>
<div class="section" id="running-user-code-controllers-on-your-machine">
<h3>Running user-code controllers <strong>on your machine</strong>:<a class="headerlink" href="#running-user-code-controllers-on-your-machine" title="Permalink to this headline">¶</a></h3>
<p>Once you start an instance of <code class="docutils literal notranslate"><span class="pre">launch_robot.py</span></code>, you can send commands by utilizing the example user code, found in <a class="reference external" href="https://github.com/facebookresearch/fairo/tree/main/polymetis/examples">scripts</a>.</p>
<p>For real-time uses (e.g. on hardware), it is highly recommended that this is run on a different machine than the machine directly controlling the robot, to avoid interruptions of the real-time loop. To do this, simply edit the <code class="docutils literal notranslate"><span class="pre">ip</span></code> while constructing the <code class="docutils literal notranslate"><span class="pre">RobotInterface</span></code>, e.g. in the <a class="reference external" href="https://github.com/facebookresearch/fairo/tree/main/polymetis/examples">scripts</a>.</p>
<p>To <strong>debug custom TorchScript policies</strong>, TorchScript can directly script <code class="docutils literal notranslate"><span class="pre">print</span></code> statements, which will output <strong>on the server</strong> (i.e. for hardware, it will print on the NUC machine, where the <code class="docutils literal notranslate"><span class="pre">launch_robot.py</span></code> script was launched).</p>
</div>
</div>
<div class="section" id="running-the-gripper-on-your-machine">
<h2>Running the gripper <strong>on your machine</strong><a class="headerlink" href="#running-the-gripper-on-your-machine" title="Permalink to this headline">¶</a></h2>
<p>We currently support two grippers: Franka Hand and Robotiq 2F Gripper.</p>
<p>To run the gripper server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>launch_gripper.py <span class="nv">gripper</span><span class="o">=</span>&lt;franka_hand<span class="p">|</span>robotiq_2f&gt;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">launch_gripper.py</span></code> launches a service that exposes gripper functionality to a connected <code class="docutils literal notranslate"><span class="pre">GripperInterface</span></code>.</p>
<p>You can modify the configuration on the command line through Hydra. For example, to change the comport (communication port) while using the <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/polymetis/polymetis/conf/gripper/robotiq_2f.yaml">Robotiq 2F gripper config</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>launch_gripper.py <span class="nv">gripper</span><span class="o">=</span>robotiq_2f gripper.comport<span class="o">=</span>/dev/ttyUSB1
</pre></div>
</div>
</div>
<div class="section" id="using-the-allegro-hand-client">
<h2>Using the Allegro Hand Client<a class="headerlink" href="#using-the-allegro-hand-client" title="Permalink to this headline">¶</a></h2>
<p>The Allegro Hand client communicates using the SocketCAN interface which is included with modern Linux kernels.
Before starting the Allegro Hand client you must configure your CAN netdev interface and specify the CAN bus network interface name in the <code class="docutils literal notranslate"><span class="pre">allegro_hardware.yaml</span></code> configuration file.</p>
<p>One way to configure the CAN netdev interface is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo ip link <span class="nb">set</span> can0 <span class="nb">type</span> can bitrate <span class="m">1000000</span>
sudo ip link <span class="nb">set</span> can0 up
</pre></div>
</div>
<p>you can use the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip link ls 
</pre></div>
</div>
<p>to check the names of the available CAN interfaces in your system.</p>
<p>To launch the Allegro Hand client run the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>launch_robot.py <span class="nv">robot_client</span><span class="o">=</span>allegro_hardware <span class="nv">robot_model</span><span class="o">=</span>allegro_hand
</pre></div>
</div>
<p><em>Note:</em> if you previously installed the PEAK pcan kernel modules for libpcanbasic, the SocketCAN drivers have likely been blocklisted.  On Ubuntu systems you can undo this by commenting out all lines in the file <code class="docutils literal notranslate"><span class="pre">/etc/modprobe.d/blacklist-peak.conf</span> </code></p>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="installation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Installation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="troubleshooting.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Troubleshooting</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Yixin Lin, Austin Wang<br/>
    
        &copy; Copyright 2021, Facebook Inc..<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>