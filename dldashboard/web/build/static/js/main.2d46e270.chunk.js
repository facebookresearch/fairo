(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[0],{216:function(e,t,a){e.exports=a(341)},273:function(e,t,a){},274:function(e,t,a){},275:function(e,t,a){},276:function(e,t,a){},278:function(e,t,a){},333:function(e,t,a){},334:function(e,t,a){},340:function(e,t,a){},341:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(17),r=a.n(i),s=a(185),l=a.n(s),c=(a(221),a(222),a(10)),u=a(11),h=a(15),m=a(14),p=a(18),d=a(66),f=a(31),g=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onResize=n.onResize.bind(Object(p.a)(n)),n.initialState={height:e.height,width:e.width,rgb:null,depth:null},n.state=n.initialState,n}return Object(u.a)(a,[{key:"onResize",value:function(e,t,a,n,o){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.depth,r=this.props,s=r.offsetW,l=r.offsetH,c=n;return null===n&&null==i?o.a.createElement(d.a,{default:{x:s,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},o.a.createElement("p",null,"Loading...")):("depth"===this.props.type&&(c=i),o.a.createElement(d.a,{default:{x:s,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},o.a.createElement(f.Stage,{width:a,height:t},o.a.createElement(f.Layer,null,o.a.createElement(f.Image,{image:c,width:a,height:t})))))}}]),a}(o.a.Component),v=a(379),b=(a(273),a(274),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={selectedTags:[],suggestions:[],currentValue:""},n.inputRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"tag-selector"},o.a.createElement("div",{className:"tag-holder"},this.state.selectedTags.map((function(t){return o.a.createElement("span",{class:"tag-selected"},t,o.a.createElement("button",{onClick:function(){e.removeTag(t)}},"X"))}))),o.a.createElement("input",{type:"text",placeholder:"Tags (press Enter to add)",ref:this.inputRef,onChange:this.update.bind(this),onKeyDown:this.keyDown.bind(this)}),o.a.createElement("div",{className:"tag-suggestions"},this.state.suggestions.map((function(t){return o.a.createElement("span",null,o.a.createElement("button",{onClick:function(){e.addTag(t)}},t))}))))}},{key:"update",value:function(e){var t=this,a=this.inputRef.current.value;0!==a.length?this.setState({suggestions:this.props.tags.filter((function(e){return e.toLowerCase().slice(0,a.length)===a&&-1===t.state.selectedTags.indexOf(e)}))}):this.setState({suggestions:[]})}},{key:"removeTag",value:function(e){var t=this;this.setState({selectedTags:this.state.selectedTags.filter((function(t){return t!==e}))},(function(){t.props.update(t.state.selectedTags)}))}},{key:"addTag",value:function(e){var t=this;e=e.toLowerCase(),this.setState({selectedTags:this.state.selectedTags.concat(e),suggestions:[]},(function(){t.props.update(t.state.selectedTags)})),this.inputRef.current.value=""}},{key:"keyDown",value:function(e){"Enter"===e.key&&""!==this.inputRef.current.value.trim()&&this.addTag(this.inputRef.current.value),this.setState({currentValue:this.inputRef.current.value})}}]),a}(o.a.Component)),y=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).labels=[],n.tags=[],n.nameRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"data-entry-root",style:{top:this.props.y+"px",left:this.props.x+"px",position:"fixed"}},o.a.createElement("input",{placeholder:"Object Name",ref:this.nameRef}),o.a.createElement(b,{tags:this.labels,update:function(t){return e.tags=t}}),o.a.createElement("button",{className:"data-entry-submit",onClick:this.submit.bind(this)},"Submit"))}},{key:"submit",value:function(){var e=this.nameRef.current.value.trim();0!==e.length?this.tags.length<2?alert("Please enter at least 2 descriptive tags for the object. Examples include: color, shape, size, orientation, etc."):this.props.onSubmit({name:e.toLowerCase(),tags:this.tags}):alert("You must enter the object's name")}}]),a}(o.a.Component),E=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).update=n.update.bind(Object(p.a)(n)),n.onClick=n.onClick.bind(Object(p.a)(n)),n.onMouseMove=n.onMouseMove.bind(Object(p.a)(n)),n.keyDown=n.keyDown.bind(Object(p.a)(n)),n.drawPoint=n.drawPoint.bind(Object(p.a)(n)),n.drawLine=n.drawLine.bind(Object(p.a)(n)),n.localToImage=n.localToImage.bind(Object(p.a)(n)),n.imageToLocal=n.imageToLocal.bind(Object(p.a)(n)),n.shiftViewBy=n.shiftViewBy.bind(Object(p.a)(n)),n.isDrawingPolygon=!1,n.lastMouse={x:0,y:0},n.dragging=!1,n.canvasRef=o.a.createRef(),n.zoomPixels=300,n.pointSize=10,n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.points=[],this.img=this.props.img,this.Offset={x:0,y:0},this.baseScale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height),this.scale=this.baseScale,this.update()}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("p",null,"Please trace the ",this.props.object),o.a.createElement("canvas",{ref:this.canvasRef,width:"500px",height:"500px",tabIndex:"0",onClick:this.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){var e=this;if(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.img,0,0),"Enter"!==this.lastKey){for(var t=0;t<this.points.length-1;t++)this.drawLine(this.points[t],this.points[t+1]);this.points.length>0&&!this.dragging&&this.drawLine(this.points[this.points.length-1],this.localToImage(this.lastMouse)),this.points.forEach((function(t){e.drawPoint(t)}))}else{if(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.baseScale,0,0,this.baseScale,0,0),this.ctx.drawImage(this.img,0,0),this.points.length<3)return;var a=new Path2D;a.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)a.lineTo(this.points[n].x,this.points[n].y);a.closePath(),this.ctx.fillStyle="rgba(0,200,0,.5)",this.ctx.fill(a,"evenodd")}}},{key:"updateZoom",value:function(){this.scale=Math.min(this.canvas.width/this.zoomPixels,this.canvas.height/this.zoomPixels),0!==this.points.length&&(this.Offset={x:-(this.points[this.points.length-1].x-this.zoomPixels/2)*this.scale,y:-(this.points[this.points.length-1].y-this.zoomPixels/2)*this.scale})}},{key:"onMouseMove",value:function(e){var t=this.canvas.getBoundingClientRect();this.lastMouse={x:e.clientX-t.left,y:e.clientY-t.top+1},this.dragging&&(this.points[this.draggingIndex]=this.localToImage(this.lastMouse)),this.update()}},{key:"onClick",value:function(e){if(this.dragging)return this.dragging=!1,void this.update();for(var t=null,a=0;a<this.points.length;a++)this.distance(this.points[a],this.localToImage(this.lastMouse))<this.pointSize/2&&(t=a);if(null!=t)return this.dragging=!0,this.draggingIndex=t,void this.update();"Enter"!==this.lastKey&&this.points.push(this.localToImage(this.lastMouse)),this.updateZoom(),this.isDrawingPolygon||(this.points.pop(),this.isDrawingPolygon=!0),this.update(),this.lastKey="Mouse"}},{key:"keyDown",value:function(e){switch(e.key){case" ":this.points.length>0&&this.points.pop();break;case"w":this.shiftViewBy(0,10);break;case"a":this.shiftViewBy(10,0);break;case"s":this.shiftViewBy(0,-10);break;case"d":this.shiftViewBy(-10,0);break;case"Enter":"Enter"===this.lastKey&&(this.lastKey=null,this.props.submitCallback(this.points));break;case"=":this.zoomPixels-=10,this.updateZoom()}this.lastKey=e.key,this.update()}},{key:"drawPoint",value:function(e){this.ctx.fillStyle="black",this.distance(e,this.localToImage(this.lastMouse))<this.pointSize/2&&(this.ctx.fillStyle="green"),this.ctx.fillRect(e.x-2.5,e.y-2.5,5,5)}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}},{key:"localToImage",value:function(e){return{x:(e.x-this.Offset.x)/this.scale,y:(e.y-this.Offset.y)/this.scale}}},{key:"imageToLocal",value:function(e){return{x:e.x*this.scale+this.Offset.x,y:e.y*this.scale+this.Offset.y}}},{key:"resetView",value:function(){this.Offset={x:0,y:0},this.scale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height)}},{key:"shiftViewBy",value:function(e,t){this.Offset={x:this.Offset.x+e,y:this.Offset.y+t}}},{key:"distance",value:function(e,t){return 2*Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}}]),a}(o.a.Component),_=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).update=n.update.bind(Object(p.a)(n)),n.drawLine=n.drawLine.bind(Object(p.a)(n)),n.canvasRef=o.a.createRef(),n.imgRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.Offset={x:0,y:0},this.baseScale=this.canvas.width/this.props.img.width,this.scale=this.baseScale,this.canvas.height=this.props.img.height*this.baseScale,this.update()}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("canvas",{ref:this.canvasRef,width:"500px",height:"500px",tabIndex:"0",onClick:this.props.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.props.img,0,0);for(var e=0;e<this.props.objects.length;e++){var t=this.props.pointMap[this.props.objects[e]];if(t){var a=this.props.colors[e%this.props.colors.length];a?this.drawRegion(t,a):this.drawRegion(t,"rgba(0,200,0,.5)")}}}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}},{key:"drawRegion",value:function(e,t){if(!(e.length<3)){var a=new Path2D;a.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)a.lineTo(e[n].x,e[n].y);a.closePath(),this.ctx.fillStyle=t,this.ctx.fill(a,"evenodd")}}}]),a}(o.a.Component),k=["rgba(0,200,0,.5)","rgba(200,0,0,.5)","rgba(0,0,200,.5)","rgba(200,200,0,.5)","rgba(0,200,200,.5)","rgba(200,0,200,.5)","rgba(150,50,50,.5)","rgba(255, 153, 0, .5)","rgba(128,0,128,.5)","rgba(0,204,255,.5)","rgba(153,204,0,.5)"],O=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={objectIds:[],currentMode:"select",currentOverlay:null},n.currentId=0,n.nameMap={},n.pointMap={},n.propertyMap={},n.registerClick=n.registerClick.bind(Object(p.a)(n)),void 0!==n.props.image?n.image=n.props.image:(n.image=new Image,n.image.onload=function(){n.forceUpdate()},n.image.src=n.props.imgUrl),n.overtime=!1,setInterval((function(){n.overtime=!0}),6e4*window.MINUTES),n}return Object(u.a)(a,[{key:"render",value:function(){var e=this;return"draw_polygon"!==this.state.currentMode?o.a.createElement("div",null,o.a.createElement("p",null,"Label and outline as ",o.a.createElement("b",null,"many objects as possible.")," Click an object in the image to start. ",this.state.objectIds.length," ","object(s) labeled."),this.state.currentOverlay,o.a.createElement(_,{img:this.image,objects:this.state.objectIds,pointMap:this.pointMap,colors:k,onClick:function(t){return e.registerClick(t.clientX,t.clientY)}}),o.a.createElement("button",{onClick:this.submit.bind(this)},"Finished annotating objects")):o.a.createElement(E,{img:this.image,object:this.drawing_data.name,submitCallback:this.drawingFinished.bind(this)})}},{key:"registerClick",value:function(e,t){if("select"===this.state.currentMode){var a=o.a.createElement(y,{x:e,y:t,onSubmit:this.dataEntered.bind(this)});this.setState({currentMode:"fill_data",currentOverlay:a})}}},{key:"dataEntered",value:function(e){this.drawing_data=e,this.setState({currentMode:"draw_polygon",currentOverlay:null})}},{key:"drawingFinished",value:function(e){var t=this;this.propertyMap[this.currentId]=this.drawing_data.tags,this.pointMap[this.currentId]=e,this.nameMap[this.currentId]=this.drawing_data.name,this.setState({currentMode:"select",objectIds:this.state.objectIds.splice(0).concat(this.currentId)},(function(){t.currentId+=1}))}},{key:"submit",value:function(){if(this.state.objectIds.length<window.MIN_OBJECTS)alert("Label more objects, or your HIT may be rejected");else{var e={nameMap:this.nameMap,propertyMap:this.propertyMap,pointMap:this.pointMap};this.props.stateManager.socket.emit("saveObjectAnnotation",e),this.props.not_turk}}}]),a}(o.a.Component),S=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={image:void 0},n.state=n.initialState,n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return void 0===this.state.image?null:o.a.createElement(O,{image:this.state.image,not_turk:!0,stateManager:this.props.stateManager})}}]),a}(o.a.Component),w=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onResize=n.onResize.bind(Object(p.a)(n)),n.onFixup=n.onFixup.bind(Object(p.a)(n)),n.initialState={height:e.height,width:e.width,rgb:null,objects:null},n.state=n.initialState,n}return Object(u.a)(a,[{key:"onResize",value:function(e,t,a,n,o){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"onFixup",value:function(){if(this.props.stateManager){var e=this.props.stateManager,t=void 0;if(e.refs.forEach((function(e){e instanceof S&&(t=e)})),void 0!==t){t.setState({image:this.state.rgb});for(var a=e.dashboardLayout,n=0;n<a._getAllContentItems().length;n++)if("ObjectFixup"===a._getAllContentItems()[n].config.component){var o=a._getAllContentItems()[n];o.parent.setActiveContentItem(o)}}}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.objects,r=this.props,s=r.offsetW,l=r.offsetH;if(null===n)return o.a.createElement(d.a,{default:{x:s,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},o.a.createElement("p",null,"Loading..."));var c=[],u=i;null===i&&(u=[]);var h=0;return u.forEach((function(e){var a=e.id,n=String(a).concat(e.label),i=e.properties,r=n.concat(i).split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0),s=v.a[Math.abs(r%v.a.length)],l=t/512,u=parseInt(e.bbox[0]*l),m=parseInt(e.bbox[1]*l),p=parseInt(e.bbox[2]*l),d=parseInt(e.bbox[3]*l)-m,g=p-u;c.push(o.a.createElement(f.Rect,{key:h,x:u,y:m,width:g,height:d,fillEnabled:!1,stroke:s})),c.push(o.a.createElement(f.Text,{key:[h++,n],text:n.concat("\n",i),x:u,y:m,fill:s,fontSize:10}))})),o.a.createElement(d.a,{default:{x:s,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},o.a.createElement(f.Stage,{width:a,height:t},o.a.createElement(f.Layer,null,o.a.createElement(f.Image,{image:n,width:a,height:t}),c)),o.a.createElement("button",{onClick:this.onFixup},"Fix"))}}]),a}(o.a.Component),x=a(380),C=[["left_ear","left_eye"],["right_ear","right_eye"],["left_eye","right_eye"],["left_eye","nose"],["right_eye","nose"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"],["right_hip","left_hip"],["right_shoulder","left_shoulder"]],j=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onResize=n.onResize.bind(Object(p.a)(n)),n.initialState={height:e.height,width:e.width,rgb:null,humans:null},n.state=n.initialState,n}return Object(u.a)(a,[{key:"onResize",value:function(e,t,a,n,o){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.humans,r=this.props,s=r.offsetW,l=r.offsetH;if(null===n)return o.a.createElement(d.a,{default:{x:s,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},o.a.createElement("p",null,"Loading..."));var c=[],u=0,h=0;return i.forEach((function(e){var a=t/512,n=x.a[u++];u===x.a.length&&(u=0),C.forEach((function(t){var i=e.keypoints[t[0]],r=e.keypoints[t[1]],s=[parseInt(i[0]*a),parseInt(i[1]*a),parseInt(r[0]*a),parseInt(r[1]*a)];c.push(o.a.createElement(f.Line,{key:h++,points:s,stroke:n}))}))})),o.a.createElement(d.a,{default:{x:s,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},o.a.createElement(f.Stage,{width:a,height:t},o.a.createElement(f.Layer,null,o.a.createElement(f.Image,{image:n,width:a,height:t}),c)))}}]),a}(o.a.Component),M=a(116),R=(a(275),a(389)),T=a(388),I=a(381),N=a(386),L=a(385),D=a(190),B=a.n(D),A=a(387),J=a(191),P=a.n(J),U=(a(276),new window.webkitSpeechRecognition);U.lang="en-US";var F=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={recognizing:!1},n.toggleListen=n.toggleListen.bind(Object(p.a)(n)),n.listen=n.listen.bind(Object(p.a)(n)),n.elementRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"renderChatHistory",value:function(){var e=this;return this.props.chats.map((function(t,a){return o.a.cloneElement(o.a.createElement(I.a,null,o.a.createElement(L.a,{primary:t.msg}),o.a.createElement(N.a,null,""!==t.msg?o.a.createElement(A.a,{edge:"end","aria-label":"Fail",onClick:function(){return e.props.goToQuestion(a)}},o.a.createElement(B.a,{className:"cross"})):null)),{key:a.toString()})}))}},{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(e.preventDefault(),this.handleSubmit())}},{key:"componentDidMount",value:function(){document.addEventListener("keypress",this.handleKeyPress.bind(this))}},{key:"toggleListen",value:function(){console.log("togglelisten"),this.setState({recognizing:!this.state.recognizing},this.listen)}},{key:"listen",value:function(){this.state.recognizing?U.start():U.stop(),U.onresult=function(e){for(var t="",a=0;a<e.results.length;++a)e.results[a].isFinal&&(t+=e.results[a][0].transcript);document.getElementById("msg").innerHTML=t},U.onerror=function(e){console.log("Error in recognition: "+e.error)}}},{key:"handleSubmit",value:function(){var e=document.getElementById("msg").innerHTML;""!==e.replace(/\s/g,"")&&(this.props.setInteractState({msg:e,failed:!1}),this.props.stateManager.socket.emit("sendCommandToAgent",e),document.getElementById("msg").innerHTML="")}},{key:"render",value:function(){return o.a.createElement("div",{className:"Chat"},o.a.createElement("p",null,"Enter the command to the bot in the input box below, or click the mic button to start/stop voice input."),o.a.createElement("p",null,"Click the x next to the message if the outcome wasn't as expected."),o.a.createElement(P.a,{className:"ASRButton",variant:"contained",color:this.state.recognizing?"default":"secondary",fontSize:"large",onClick:this.toggleListen.bind(this)}),o.a.createElement(T.a,null,this.renderChatHistory()),o.a.createElement("div",{contentEditable:"true",className:"Msg single-line",id:"msg",suppressContentEditableWarning:!0}," "),o.a.createElement(R.a,{className:"MsgButton",variant:"contained",color:"primary",onClick:this.handleSubmit.bind(this)}," ","Submit"," "),o.a.createElement("p",{id:"callbackMsg"},this.props.status),o.a.createElement("p",{id:"assistantReply"},this.props.agent_reply," "))}}]),a}(n.Component),H=a(399),V=(a(278),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:0,parsing_error:!1,action_dict:{},feedback:""},n}return Object(u.a)(a,[{key:"finishQuestions",value:function(){var e={action_dict:this.state.action_dict,parsing_error:this.state.parsing_error,msg:this.props.chats[this.props.failidx].msg,feedback:this.state.feedback};this.props.stateManager.socket.emit("saveErrorDetailsToDb",e),this.props.goToMessage()}},{key:"saveFeedback",value:function(e){this.setState({feedback:e.target.value})}},{key:"renderParsingFail",value:function(){return o.a.createElement("div",null,o.a.createElement("h3",null," ","Thanks for letting me know that I didn't understand the command right."," "),o.a.createElement(R.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderParsingSuccess",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("h3",null," ","Okay, looks like I understood your command but couldn't follow it all the way through. Tell me more about what I did wrong :"," "),o.a.createElement(H.a,{style:{backgroundColor:"white"},id:"outlined-uncontrolled",label:"",margin:"normal",variant:"outlined",onChange:function(t){return e.saveFeedback(t)}}),o.a.createElement("div",null),o.a.createElement(R.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderEnd",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("h3",null," Thanks! Submit any other feedback here: "),o.a.createElement(H.a,{style:{backgroundColor:"white"},id:"outlined-uncontrolled",label:"",margin:"normal",variant:"outlined",onChange:function(t){return e.saveFeedback(t)}}),o.a.createElement("div",null),o.a.createElement(R.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderSemanticParserErrorQuestion",value:function(){var e=this,t=this.props.stateManager.memory.chatResponse,a=this.props.chats[this.props.failidx].msg;if(this.setState({action_dict:t[a]}),this.state.action_dict)if("dialogue_type"in this.state.action_dict){var n=this.state.action_dict.dialogue_type,i="";if("HUMAN_GIVE_COMMAND"===n){var r=this.state.action_dict.action_sequence[0],s=r.action_type.toLowerCase();i="to "+s+" ",["build","dig"].indexOf(s)>=0?("schematic"in r&&(i=i+"'"+r.schematic.text_span+"'"),"location"in r&&(i=i+" at location '"+r.location.text_span+"'"),i+=" ?"):["destroy","fill","spawn","copy","get","scout"].indexOf(s)>=0?("reference_object"in r&&(i=i+"'"+r.reference_object.text_span+"'"),"location"in r&&(i=i+" at location '"+r.location.text_span+"'"),i+=" ?"):["move"].indexOf(s)>=0?("location"in r&&(i=i+" at location '"+r.location.text_span+"'"),i+=" ?"):["stop","resume","undo"].indexOf(s)>=0&&("target_action_type"in r&&(i=i+" at location '"+r.target_action_type+"'"),i+=" ?")}else"GET_MEMORY"===n?i="to answer a question about something in the Minecraft world ?":"PUT_MEMORY"===n?i="to remember or learn something you taught it ?":"NOOP"===n&&(i="to do nothing ?")}else i="did you want me to do nothing ?";return o.a.createElement("div",{className:"question"},o.a.createElement("h5",null,"Did you want the assistant ",i),o.a.createElement(T.a,{className:"answers",component:"nav"},o.a.createElement(I.a,{button:!0,onClick:function(){return e.answerParsing(1)}},o.a.createElement(L.a,{primary:"Yes"})),o.a.createElement(I.a,{button:!0,onClick:function(){return e.answerParsing(2)}},o.a.createElement(L.a,{primary:"No"}))))}},{key:"answerParsing",value:function(e){1===e?this.setState({view:2}):2===e&&this.setState({parsing_error:!0,view:1})}},{key:"goToEnd",value:function(e){this.setState({view:3,new_action_dict:e})}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("div",{className:"msg-header"},"Message you sent to the bot: ",o.a.createElement("br",null),this.props.chats[this.props.failidx].msg),0===this.state.view?this.renderSemanticParserErrorQuestion():null,1===this.state.view?this.renderParsingFail():null,2===this.state.view?this.renderParsingSuccess():null,3===this.state.view?this.renderEnd():null)}}]),a}(n.Component)),z=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={currentView:1,chatResponse:"",status:"",chats:[{msg:"",failed:!1}],failidx:-1,agent_reply:""},n.state=n.initialState,n.setAssistantReply=n.setAssistantReply.bind(Object(p.a)(n)),n.MessageRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"setInteractState",value:function(e){var t=Object(M.a)(this.state.chats);t.shift(),t.push(e),this.setState({chats:t})}},{key:"setAssistantReply",value:function(e){this.setState({agent_reply:e.agent_reply})}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.props.stateManager.socket.on("showAssistantReply",this.setAssistantReply))}},{key:"getUrlParameterByName",value:function(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}},{key:"goToMessage",value:function(){var e=this.state.chats;-1!==this.state.failidx&&(e[this.state.failidx].failed=!0),this.setState({currentView:1,chats:e})}},{key:"goToQuestion",value:function(e){this.setState({currentView:2,chats:this.state.chats,failidx:e})}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"content"},1===this.state.currentView?o.a.createElement(F,{status:this.state.status,stateManager:this.props.stateManager,ref:this.MessageRef,chats:this.state.chats,agent_reply:this.state.agent_reply,goToQuestion:this.goToQuestion.bind(this),setInteractState:this.setInteractState.bind(this)}):null,2===this.state.currentView?o.a.createElement(V,{stateManager:this.props.stateManager,chats:this.state.chats,failidx:this.state.failidx,goToMessage:this.goToMessage.bind(this),failmsg:this.state.chats[this.state.failidx].msg}):null))}}]),a}(n.Component),W=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={rgb:null,depth:null,objects:null,humans:null},n}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.stateManager;return o.a.createElement("div",null,o.a.createElement(z,{stateManager:e}),o.a.createElement(g,{type:"rgb",height:320,width:320,offsetH:400,offsetW:10,stateManager:e}),o.a.createElement(g,{type:"depth",height:320,width:320,offsetH:400,offsetW:340,stateManager:e}),o.a.createElement(w,{height:320,width:320,offsetH:730,offsetW:10,stateManager:e}),o.a.createElement(j,{height:320,width:320,offsetH:730,offsetW:340,stateManager:e}))}}]),a}(o.a.Component),G=a(192),Y=a.n(G),K={echo:{description:"Echo a passed string.",usage:"echo <string>",fn:function(){return"".concat(Array.from(arguments).join(" "))}}},X=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){return o.a.createElement(Y.a,{commands:K,promptLabel:"me@locobot:~$ (not connected to anything right now)"})}}]),a}(o.a.Component),Q=(a(301),a(142)),q=(a(303),{width:600,margin:50}),Z={minWidth:"60px",display:"inline-block"},$=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={url:n.props.stateManager.url,fps:0,connected:!1,image_quality:-1,image_resolution:-1},n.state=n.initialState,n.handleChange=n.handleChange.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.setImageSettings=n.setImageSettings.bind(Object(p.a)(n)),n.onImageQualityChange=n.onImageQualityChange.bind(Object(p.a)(n)),n.onImageResolutionChange=n.onImageResolutionChange.bind(Object(p.a)(n)),n}return Object(u.a)(a,[{key:"setImageSettings",value:function(e){this.setState(e)}},{key:"handleChange",value:function(e){this.setState({url:e.target.value})}},{key:"handleSubmit",value:function(e){this.props.stateManager.setUrl(this.state.url),e.preventDefault()}},{key:"handleClearSettings",value:function(e){this.props.stateManager.setDefaultUrl()}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.setState({connected:this.props.stateManager.connected}),this.props.stateManager.socket.on("image_settings",this.setImageSettings))}},{key:"onImageQualityChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:e,image_resolution:this.state.image_resolution})}},{key:"onImageResolutionChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:this.state.image_quality,image_resolution:e})}},{key:"render",value:function(){var e;e=!0===this.state.connected?o.a.createElement("status-indicator",{positive:!0,pulse:!0}):o.a.createElement("status-indicator",{negative:!0,pulse:!0});var t=!1;return-1===this.state.image_quality&&(t=!0),o.a.createElement("div",null,o.a.createElement("form",{onSubmit:this.handleSubmit},o.a.createElement("label",null,"Server / Robot URL:",o.a.createElement("input",{type:"text",value:this.state.url,onChange:this.handleChange})),o.a.createElement("input",{type:"submit",value:"Reconnect"})),o.a.createElement("form",{onSubmit:this.handleClearSettings},o.a.createElement("input",{type:"submit",value:"Clear Saved Settings"})),o.a.createElement("p",null,"FPS: ",this.state.fps),o.a.createElement("p",null," Connection Status: ",e," "),o.a.createElement("div",{style:q},o.a.createElement("label",{style:Z},"Image Quality: \xa0"),o.a.createElement("span",null,this.state.image_quality),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(Q.a,{value:this.state.image_quality,min:1,max:100,step:1,onChange:this.onImageQualityChange,disabled:t})),o.a.createElement("div",{style:q},o.a.createElement("label",{style:Z},"Image Resolution: \xa0"),o.a.createElement("span",null,this.state.image_resolution),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(Q.a,{value:this.state.image_resolution,min:16,max:512,step:16,onChange:this.onImageResolutionChange,disabled:t})))}}]),a}(o.a.Component),ee=a(194),te=a.n(ee),ae=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,xmin:-10,xmax:10,ymin:-10,ymax:10,bot_xyz:[0,0,0],tooltip:null},n.state=n.initialState,n.outer_div=o.a.createRef(),n.resizeHandler=n.resizeHandler.bind(Object(p.a)(n)),n}return Object(u.a)(a,[{key:"resizeHandler",value:function(){if(null!=this.outer_div&&null!=this.outer_div.current){var e=this.outer_div.current,t=e.clientHeight,a=e.clientWidth;(void 0!==t&&t!==this.state.height||void 0!==a&&a!==this.state.width)&&this.setState({height:t,width:a})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.bot_xyz,n=this.state,o=n.xmin,i=n.xmax,r=n.ymin,s=n.ymax,l=a[0],c=a[1],u=!1;l<o&&(o=l,u=!0),l>i&&(i=l,u=!0),c<r&&(r=c,u=!0),c>s&&(s=c,u=!0),u&&this.setState({xmin:o,ymin:r,xmax:i,ymax:s}),this.resizeHandler()}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return o.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,i=t.memory,r=t.bot_xyz,s=t.obstacle_map,l=t.tooltip,c=i.objects,u=this.state,h=u.xmin,m=u.xmax,p=u.ymin,d=u.ymax,g=r[1],b=-r[0],y=r[2];if(0===a&&0===n)return o.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});g=parseInt((g-h)/(m-h)*n),b=parseInt((b-p)/(d-p)*a),b=a-b;var E=[],_=[],k=0;s&&s.forEach((function(e){var t=parseInt((e[0]-h)/(m-h)*n),i=parseInt((e[1]-p)/(d-p)*a);_.push(o.a.createElement(f.Circle,{key:k++,radius:2,x:t,y:i,fill:"#827f7f"}))})),c.forEach((function(t,i,r){var s,l=v.a[Math.abs((s=t.label,s.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)))%10],c=t.xyz,u=parseInt((c[2]-h)/(m-h)*n),g=parseInt((-c[0]-p)/(d-p)*a);g=a-g,E.push(o.a.createElement(f.Circle,{key:k++,radius:3,x:u,y:g,fill:l,onMouseEnter:function(a){e.setState({tooltip:JSON.stringify(t,null,4)}),a.currentTarget.setRadius(6)},onMouseLeave:function(t){e.setState({tooltip:null}),t.currentTarget.setRadius(3)}}))})),E.push(o.a.createElement(f.Circle,{key:k++,radius:10,x:g,y:b,fill:"red"})),E.push(o.a.createElement(f.Line,{key:k++,x:g,y:b,points:[0,0,12,0],rotation:180*-y/Math.PI,stroke:"black"}));for(var O=[],S=0;S<n/10;S++)O.push(o.a.createElement(f.Line,{key:12344+S,points:[Math.round(10*S)+.5,0,Math.round(10*S)+.5,a],stroke:"#f5f5f5",strokeWidth:1}));for(O.push(o.a.createElement(f.Line,{key:12344+S++,points:[0,0,10,10]})),k=0;k<a/10;k++)O.push(o.a.createElement(f.Line,{key:12344+S+k,points:[0,Math.round(10*k),n,Math.round(10*k)],stroke:"#ddd",strokeWidth:.5}));return o.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},o.a.createElement(f.Stage,{className:"memory2d",width:n,height:a},o.a.createElement(f.Layer,{className:"gridLayer"},O),o.a.createElement(f.Layer,{className:"mapBoundary"},_),o.a.createElement(f.Layer,{className:"renderedObjects"},E),o.a.createElement(f.Layer,null,o.a.createElement(f.Text,{text:l,offsetX:-12,offsetY:-12,visible:null!=l,shadowEnabled:!0}))))}}]),a}(o.a.Component),ne=a(39),oe=a(78),ie=a(79),re=a(48),se=a(6),le=a(8),ce=a(400),ue=a(118),he=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).getRowClassName=function(t){var a=t.index,n=e.props,o=n.classes,i=n.onRowClick;return Object(se.a)(o.tableRow,o.flexContainer,Object(re.a)({},o.tableRowHover,-1!==a&&null!=i))},e.cellRenderer=function(t){var a=t.cellData,n=t.columnIndex,i=e.props,r=i.columns,s=i.classes,l=i.rowHeight,c=i.onRowClick;return o.a.createElement(ce.a,{component:"div",className:Object(se.a)(s.tableCell,s.flexContainer,Object(re.a)({},s.noClick,null==c)),variant:"body",style:{height:l},align:null!=n&&r[n].numeric?"right":"left"},a)},e.headerRenderer=function(t){var a=t.label,n=t.columnIndex,i=e.props,r=i.headerHeight,s=i.columns,l=i.classes;return o.a.createElement(ce.a,{component:"div",className:Object(se.a)(l.tableCell,l.flexContainer,l.noClick),variant:"head",style:{height:r},align:s[n].numeric?"right":"left"},o.a.createElement("span",null,a))},e}return Object(u.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.height,n=t.width,i=t.classes,r=t.columns,s=t.rowHeight,l=t.headerHeight,c=Object(ie.a)(t,["height","width","classes","columns","rowHeight","headerHeight"]);return o.a.createElement(ue.c,Object.assign({height:a,width:n,rowHeight:s,gridStyle:{direction:"inherit"},size:"small",headerHeight:l,className:i.table},c,{rowClassName:this.getRowClassName}),r.map((function(t,a){var n=t.dataKey,r=Object(ie.a)(t,["dataKey"]);return o.a.createElement(ue.b,Object.assign({key:n,headerRenderer:function(t){return e.headerRenderer(Object(oe.a)(Object(oe.a)({},t),{},{columnIndex:a}))},className:i.flexContainer,cellRenderer:e.cellRenderer,dataKey:n},r))})))}}]),a}(o.a.PureComponent);he.defaultProps={headerHeight:48,rowHeight:36};var me=Object(le.a)((function(e){return{flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:e.palette.action.hover}},tableCell:{flex:1},noClick:{cursor:"initial"}}}))(he);function pe(e){var t=e.memoryManager,a=e.onShowMemoryDetail,n=Object(ne.a)(t,2),i=n[0],r=n[1];return o.a.createElement(ue.a,null,(function(e){var t=e.height,n=e.width;return o.a.createElement(me,{height:t,width:n,rowCount:i(),rowGetter:function(e){var t,a=e.index;return{uuid:(t=r(a)).data[0],id:t.data[1],type:t.data[9],name:t.data[7]}},onRowClick:function(e){e.event,e.index;var t=e.rowData;t&&t.uuid&&a(t.uuid)},columns:[{flexGrow:1,width:1,label:"ID",dataKey:"id",numeric:!0},{flexGrow:5,width:5,label:"Type",dataKey:"type",numeric:!1},{flexGrow:5,width:5,label:"Name",dataKey:"name",numeric:!1}]})}))}var de=a(196);function fe(e,t){e.memories,e.named_abstractions;var a=e.reference_objects,n=e.triples,o=new Map(a.map((function(e){return[e[0],{data:e}]})));n&&n.forEach((function(e){var t=e[1],a=o.get(t);a&&(a.triples?a.triples.push(e):a.triples=[e])}));var i=[];if(null!=t&&t.length>0){var r,s=Object(de.a)(o.values());try{for(s.s();!(r=s.n()).done;){var l=r.value;JSON.stringify(l).includes(t)&&i.push(l)}}catch(c){s.e(c)}finally{s.f()}}else i=Array.from(o.values());return[function(){return i.length},function(e){return i[e]},function(e){return o.get(e)}]}var ge=a(390),ve=a(93);function be(e){return null===e.value||void 0===e.value?null:o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,{item:!0,xs:4,s:4},o.a.createElement(ve.a,{variant:"button",align:"right"},e.title)),o.a.createElement(ge.a,{item:!0,xs:8,s:8},o.a.createElement(ve.a,{variant:"body1",align:"left"},e.value)))}var ye=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=(0,Object(ne.a)(this.props.memoryManager,3)[2])(this.props.uuid);return o.a.createElement(ge.a,{container:!0,spacing:2,style:{padding:"16px"}},o.a.createElement(ge.a,{item:!0,xs:11},o.a.createElement(ve.a,{variant:"h4",align:"left"},"Attributes")),o.a.createElement(be,{title:"UUID",value:e.data[0]}),o.a.createElement(be,{title:"ID",value:e.data[1]}),o.a.createElement(be,{title:"X",value:e.data[2]}),o.a.createElement(be,{title:"Y",value:e.data[3]}),o.a.createElement(be,{title:"Z",value:e.data[4]}),o.a.createElement(be,{title:"Yaw",value:e.data[5]}),o.a.createElement(be,{title:"Pitch",value:e.data[6]}),o.a.createElement(be,{title:"Type",value:e.data[9]}),o.a.createElement(be,{title:"Name",value:e.data[7]}),o.a.createElement(ge.a,{item:!0,xs:12},o.a.createElement(ve.a,{variant:"h4",align:"left"},"Triples")),o.a.createElement(ge.a,{item:!0,xs:4},o.a.createElement(ve.a,{variant:"button",align:"left"},"Predicate")),o.a.createElement(ge.a,{item:!0,xs:4},o.a.createElement(ve.a,{variant:"button",align:"left"},"Value")),o.a.createElement(ge.a,{item:!0,xs:4},o.a.createElement(ve.a,{variant:"button",align:"left"},"Confidence")),e.triples.map((function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,{item:!0,xs:4},o.a.createElement(ve.a,{variant:"body2",align:"left"},e[4])),o.a.createElement(ge.a,{item:!0,xs:4},o.a.createElement(ve.a,{variant:"body2",align:"left"},e[6])),o.a.createElement(ge.a,{item:!0,xs:4},o.a.createElement(ve.a,{variant:"body2",align:"left"},e[7])))})))}}]),a}(o.a.Component),Ee=a(401),_e=a(197),ke=a.n(_e),Oe=a(392),Se=a(202),we=a(391),xe=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,filter:"",showDetail:!1,detailUUID:null},n.state=n.initialState,n.outer_div=o.a.createRef(),n.resizeHandler=n.resizeHandler.bind(Object(p.a)(n)),n}return Object(u.a)(a,[{key:"resizeHandler",value:function(){if(null!=this.outer_div&&null!=this.outer_div.current){var e=this.outer_div.current,t=e.clientHeight,a=e.clientWidth;(void 0!==t&&t!==this.state.height||void 0!==a&&a!==this.state.width)&&this.setState({height:t,width:a})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){this.resizeHandler()}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return o.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,i=t.memory,r=t.isLoaded;if(0===a&&0===n)return o.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});if(!r)return o.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},"Loading...");var s=Object(Se.a)({palette:{type:"dark"}}),l=new fe(i,this.state.filter),c=this.state.height-24,u=this.state.width-24,h=function(){e.setState({showDetail:!1})};return o.a.createElement(we.a,{theme:s},o.a.createElement(H.a,{style:{borderBlockColor:"white"},color:"primary",id:"outlined-uncontrolled",label:"Search",margin:"dense",variant:"outlined",onChange:function(t){e.setState({filter:t.target.value})}}),o.a.createElement(pe,{height:c,width:u,memoryManager:l,onShowMemoryDetail:function(t){e.setState({detailUUID:t,showDetail:!0})}}),o.a.createElement(Ee.a,{anchor:"right",open:this.state.showDetail,onClose:function(){h()}},o.a.createElement("div",{style:{width:450}},o.a.createElement(A.a,{onClick:function(){return h()}},o.a.createElement(ke.a,null)),o.a.createElement(Oe.a,null),o.a.createElement(ye,{memoryManager:l,uuid:this.state.detailUUID}))))}}]),a}(o.a.Component),Ce=(a(333),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"renderChatHistory",value:function(){return this.props.stateManager.memory.chats.map((function(e,t){return o.a.cloneElement(o.a.createElement(I.a,{alignItems:"flex-start"},o.a.createElement("div",{className:"chatItem"},""!==e.msg?o.a.createElement(L.a,{primary:e.msg}):null)),{key:t.toString()})}))}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return o.a.createElement("div",{className:"history"},o.a.createElement("p",null,"The history of the last 5 commands sent to the bot."),o.a.createElement(T.a,null,this.renderChatHistory()))}}]),a}(o.a.Component)),je=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={status:"",world_state:{}},n.worldContainerRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"getVoxelWorldInitialState",value:function(){this.props.stateManager.socket.emit("getVoxelWorldInitialState")}},{key:"componentDidUpdate",value:function(){this.worldContainerRef.current.contentWindow.postMessage(this.state,"*")}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),this.getVoxelWorldInitialState()}},{key:"render",value:function(){return o.a.createElement("div",{id:"world-container"},o.a.createElement("iframe",{id:"ifr",src:"VoxelWorld/world.html",title:"Voxel World",width:"1000",height:"600",ref:this.worldContainerRef}))}}]),a}(o.a.Component),Me=new(function(){function e(){Object(c.a)(this,e),this.refs=[],this.socket=null,this.default_url="http://localhost:8000",this.connected=!1,this.initialMemoryState={objects:new Map,humans:new Map,chatResponse:{},chats:[{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1}]},this.processSensorPayload=this.processSensorPayload.bind(this),this.processMemoryState=this.processMemoryState.bind(this),this.setChatResponse=this.setChatResponse.bind(this),this.setConnected=this.setConnected.bind(this),this.updateStateManagerMemory=this.updateStateManagerMemory.bind(this),this.keyHandler=this.keyHandler.bind(this),this.updateVoxelWorld=this.updateVoxelWorld.bind(this),this.setVoxelWorldInitialState=this.setVoxelWorldInitialState.bind(this),this.memory=this.initialMemoryState,this.processRGB=this.processRGB.bind(this),this.processDepth=this.processDepth.bind(this),this.processObjects=this.processObjects.bind(this),this.default_url=window.location.href,this.setUrl(this.default_url);var t=localStorage.getItem("server_url");"undefined"!==t&&void 0!==t&&null!==t||(t=this.default_url),this.setUrl(t),this.fps_time=performance.now()}return Object(u.a)(e,[{key:"setDefaultUrl",value:function(){localStorage.clear(),this.setUrl(this.default_url)}},{key:"setUrl",value:function(e){this.url=e,localStorage.setItem("server_url",e),this.restart(this.url)}},{key:"restart",value:function(e){var t=this;this.socket=te.a.connect(e,{transports:["polling","websocket"]});var a=this.socket;a.on("reconnect_attempt",(function(){a.io.opts.transports=["polling","websocket"]})),a.on("connect",(function(e){console.log("connect event"),t.setConnected(!0),t.socket.emit("get_memory_objects")})),a.on("reconnect",(function(e){console.log("reconnect event"),t.setConnected(!0),t.socket.emit("get_memory_objects")})),a.on("disconnect",(function(e){console.log("disconnect event"),t.setConnected(!1),t.memory=t.initialMemoryState,t.refs.forEach((function(e){e.setState(e.initialState),e.forceUpdate()})),console.log("disconnected")})),a.on("setChatResponse",this.setChatResponse),a.on("sensor_payload",this.processSensorPayload),a.on("memoryState",this.processMemoryState),a.on("updateState",this.updateStateManagerMemory),a.on("updateVoxelWorldState",this.updateVoxelWorld),a.on("setVoxelWorldInitialState",this.setVoxelWorldInitialState),a.on("rgb",this.processRGB),a.on("depth",this.processDepth),a.on("objects",this.processObjects)}},{key:"updateStateManagerMemory",value:function(e){this.memory=e.memory,this.refs.forEach((function(e){e.forceUpdate()}))}},{key:"setConnected",value:function(e){this.connected=e,this.refs.forEach((function(t){t instanceof $&&t.setState({connected:e})}))}},{key:"setChatResponse",value:function(e){this.memory.chats=e.allChats,this.memory.chatResponse[e.chat]=e.chatResponse,this.refs.forEach((function(t){t instanceof z&&t.setState({status:e.status}),t instanceof Ce&&t.forceUpdate()}))}},{key:"updateVoxelWorld",value:function(e){this.refs.forEach((function(t){t instanceof je&&(console.log("update Voxel World with "+e.world_state),t.setState({world_state:e.world_state,status:e.status}))}))}},{key:"setVoxelWorldInitialState",value:function(e){this.refs.forEach((function(t){t instanceof je&&(console.log("set Voxel World Initial state: "+e.world_state),t.setState({world_state:e.world_state,status:e.status}))}))}},{key:"keyHandler",value:function(e){var t=[];for(var a in e){var n=e[a];a=parseInt(a),!0===n&&(38===a&&t.push("MOVE_FORWARD"),40===a&&t.push("MOVE_BACKWARD"),37===a&&t.push("MOVE_LEFT"),39===a&&t.push("MOVE_RIGHT"),49===a&&t.push("PAN_LEFT"),50===a&&t.push("PAN_RIGHT"),51===a&&t.push("TILT_UP"),52===a&&t.push("TILT_DOWN"))}t.length>0&&this.socket.emit("command",t)}},{key:"processMemoryState",value:function(e){this.refs.forEach((function(t){t instanceof xe&&t.setState({isLoaded:!0,memory:e})}))}},{key:"processRGB",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof g&&"rgb"===e.props.type&&e.setState({isLoaded:!0,rgb:t})}))}},{key:"processDepth",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof g&&"depth"===e.props.type&&e.setState({isLoaded:!0,depth:t})}))}},{key:"processObjects",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e.image.rgb,this.refs.forEach((function(a){a instanceof w&&a.setState({isLoaded:!0,objects:e.objects,rgb:t})}))}},{key:"processSensorPayload",value:function(e){var t=this,a=performance.now(),n=1e3/(a-this.fps_time);this.fps_time=a;var o=new Image;o.src="data:image/webp;base64,"+e.image.rgb;var i=new Image;i.src="data:image/webp;base64,"+e.image.depth;var r=new Image;return-1!==e.object_image&&void 0!==e.object_image&&(r.src="data:image/webp;base64,"+e.object_image.rgb),this.refs.forEach((function(a){a instanceof ae?a.setState({isLoaded:!0,memory:t.memory,bot_xyz:[e.x,e.y,e.yaw],obstacle_map:e.map}):a instanceof $?a.setState({fps:n}):a instanceof g?a.setState({isLoaded:!0,rgb:o,depth:i}):(a instanceof w||a instanceof j)&&-1!==e.object_image&&void 0!==e.object_image&&a.setState({isLoaded:!0,rgb:r,objects:e.objects,humans:e.humans})})),"OK"}},{key:"connect",value:function(e){this.refs.push(e)}}]),e}()),Re=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.navRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"handleSubmit",value:function(e){Me.setUrl(this.state.url),e.preventDefault()}},{key:"componentDidMount",value:function(){var e={},t=function(t){e[t.keyCode]="keydown"===t.type};document.addEventListener("keydown",t),document.addEventListener("keyup",t),setInterval(Me.keyHandler,33.33,e)}},{key:"render",value:function(){return o.a.createElement("div",{ref:this.navRef},o.a.createElement("p",null," Use the arrow keys to move the robot around"))}}]),a}(o.a.Component),Te=a(92),Ie=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={action_dict:{}},n.state=n.initialState,n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.querySemanticParser=n.querySemanticParser.bind(Object(p.a)(n)),n.qRef=o.a.createRef(),n}return Object(u.a)(a,[{key:"querySemanticParser",value:function(e){this.setState({action_dict:e.action_dict})}},{key:"handleSubmit",value:function(e){var t=document.getElementById("command_input").innerHTML;this.props.stateManager.socket.emit("queryParser",{chat:t}),e.preventDefault()}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.props.stateManager.socket.on("renderActionDict",this.querySemanticParser))}},{key:"render",value:function(){return o.a.createElement("div",{ref:this.qRef},o.a.createElement("p",null,"Enter the command below and click on the button to get the parser output."),o.a.createElement("div",{style:{position:"relative",marginLeft:"20%"}},o.a.createElement("div",{id:"command_input",contentEditable:"true",style:{backgroundColor:"white",width:"55%",height:"30%",color:"black",marginBottom:"5%"}}),o.a.createElement(R.a,{style:{marginLeft:"10%"},size:"small",variant:"contained",color:"default",onClick:this.handleSubmit.bind(this)},"Get the program")),o.a.createElement(Te.a,{text:JSON.stringify(this.state.action_dict,null,1),language:"python",wrapLines:!0,theme:Te.b}))}}]),a}(o.a.Component),Ne=a(90),Le=a(37),De=(a(334),a(398)),Be=a(21),Ae=a(393),Je=a(396),Pe=a(395),Ue=a(394);function Fe(e){var t=e.open,a=e.close,n=e.text_to_render;return o.a.createElement(Ae.a,{open:t,"aria-labelledby":"form-dialog-title"},o.a.createElement(Ue.a,{id:"form-dialog-title"},"Generated Code"),o.a.createElement(Pe.a,null,o.a.createElement(Te.a,{text:n,language:"python",wrapLines:!0,theme:Te.b})),o.a.createElement(Je.a,null,o.a.createElement(R.a,{onClick:a,color:"secondary"},"Cancel")))}var He,Ve=a(402),ze=a(201),We=a.n(ze),Ge=function(e,t){var a=0;if(!t||"{"!==e.charAt(t))return-1;for(var n=t;n<e.length;n++){var o=e.charAt(n);if("{"===o)a+=1;else if("}"===o&&0===(a-=1))return n}return-1},Ye=function(e){for(var t=e.indexOf("{");t>=0&&t<e.length;){var a=Ge(e,t);if((t=e.indexOf("{",a))<0)break;e=e.slice(0,a+1)+","+e.slice(a+1),t+=1}return e},Ke=function(e){for(var t=e.indexOf("{"),a=0;t>=0&&t<e.length;){a+=1;var n=Ge(e,t);if(n<0)break;t=e.indexOf("{",n)}return a},Xe=a(44),Qe=a.n(Xe),qe=a(3),Ze=a.n(qe),$e=a(139),et=a.n($e),tt=(a(184),a(19)),at=a.n(tt),nt={Location:"Location",Boolean:"Boolean",Number:"Number",String:"String",CommandDict:"CommandDict",Time:"Time",Mob:"Mob",BlockObject:"BlockObject",Filter:"Filter"},ot=(He={},Object(re.a)(He,nt.Location,[["x","X"],["y","Y"],["z","Z"],["pitch","PITCH"],["yaw","YAW"]]),Object(re.a)(He,nt.Time,[["time (ticks)","TICKS"],["time (seconds)","SECONDS"],["time (minutes)","MINUTES"],["time (hours)","HOURS"],["time (days)","DAYS"],["time string (hh:mm:ss)","TIME"]]),Object(re.a)(He,nt.Mob,[["location","LOC"],["location X","X"],["location Y","Y"],["location Z","Z"],["type","TYPE"],["name","NAME"]]),Object(re.a)(He,nt.BlockObject,[["location","LOC"],["location X","X"],["location Y","Y"],["location Z","Z"],["name","NAME"],["size","SIZE"],["color","COLOR"]]),He),it=nt,rt=function(e){e.label=null;var t=function(){window.openSetLabelModal_?window.openSetLabelModal_(e):console.error("Could not find modal opening function.")},a=function(){var t=Qe.a.Xml.domToText(Qe.a.Xml.blockToDom(e)),a='<xml xmlns="https://developers.google.com/blockly/xml">'.concat(t,"</xml>");window.saveBlockToDatabase_(a,e.label)},n=function(){e.setCollapsed(!1),e.getDescendants().forEach((function(e){return e.setCollapsed(!1)}))};e.customContextMenu=function(o){var i=o.findIndex((function(e){return"Add Comment"===e.text}));o.splice(i,1);var r=o.findIndex((function(e){return"Collapse Block"===e.text||"Expand Block"===e.text}));o.splice(r,1);var s={text:"Expand All",enabled:!!e.collapsed_,callback:n};o.unshift(s);var l={text:(e.collapsed_?"Expand":"Collapse")+" Block",enabled:!0,callback:function(){return t=!e.collapsed_,void(e.label||e.collapsed_?e.setCollapsed(t):window.openSetLabelModal_(e,"Please add a label before collapsing the block."));var t}};o.unshift(l);var c={text:"Add Label",enabled:!0,callback:t};o.unshift(c);var u={text:"Save Block",enabled:!!e.label,callback:a};return o.push(u),o},e.setOnChange((function(t){var a,n,o=t.type===Qe.a.Events.CREATE||t.type===Qe.a.Events.CHANGE,i=t.blockId===e.id,r=o&&("field"===t.element||"inline"===t.element)&&t.name!==Qe.a.Block.COLLAPSED_FIELD_NAME,s=(a=t.blockId,(n=e).getDescendants().filter((function(e){return e.id!==n.id})).map((function(e){return e.id})).includes(a)),l=(i||s)&&r,c=t.type===Qe.a.Events.MOVE&&t.oldParentId!==t.newParentId&&s;(l||c)&&(e.label=null)}))},st={type:"location",message0:"x %1 %2 y %3 %4 z %5",args0:[{type:"field_number",name:"x",value:0},{type:"input_dummy"},{type:"field_number",name:"y",value:0},{type:"input_dummy"},{type:"field_number",name:"z",value:0}],inputsInline:!0,output:it.Location,colour:230,tooltip:"A location in the current bot's coordinate system, given in x, y, and z coordinates.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.location={init:function(){this.jsonInit(st),rt(this)}},qe.JavaScript.location=function(e){var t=e.getFieldValue("x"),a=e.getFieldValue("y"),n=e.getFieldValue("z");return['"location": { "reference_object": { "special_reference": { "coordinate_span": "'.concat(t,", ").concat(a,", ").concat(n,'"} } }'),qe.JavaScript.ORDER_NONE]};var lt=["blocks","meters","feet"],ct=["seconds","minutes","hours","days","ticks"],ut=function(e){return{type:"field_dropdown",name:e,options:lt.map((function(e){return[e,e.toUpperCase()]}))}},ht=function(e){return{type:"field_dropdown",name:e,options:[[">","GREATER_THAN"],["<","LESS_THAN"],["\u2265","GREATER_THAN_EQUAL"],["\u2264","LESS_THAN_EQUAL"],["=","EQUAL"],["\u2260","NOT_EQUAL"]]}},mt=function(e){return{type:"field_dropdown",name:e,options:[["Any","ANY"],["Creeper","CREEPER"],["Skeleton","SKELETON"],["Spider","SPIDER"],["Giant","GIANT"],["Zombie","ZOMBIE"],["Slime","SLIME"],["Ghast","GHAST"],["Pig Zombie","PIG_ZOMBIE"],["Enderman","ENDERMAN"],["Cave Spider","CAVE_SPIDER"],["Silverfish","SILVERFISH"],["Blaze","BLAZE"],["Lava Slime","LAVA_SLIME"],["Ender Dragon","ENDER_DRAGON"],["Wither Boss","WITHER_BOSS"],["Bat","BAT"],["Witch","WITCH"],["Guardian","GUARDIAN"],["Pig","PIG"],["Sheep","SHEEP"],["Cow","COW"],["Chicken","CHICKEN"],["Squid","SQUID"],["Wolf","WOLF"],["Mushroom Cow","MUSHROOM_COW"],["Snow Man","SNOW_MAN"],["Ozelot","OZELOT"],["Villager Golem","VILLAGER_GOLEM"],["Entity Horse","ENTITY_HORSE"],["Rabbit","RABBIT"],["Villager","VILLAGER"]]}},pt={type:"location_relative",message0:"%1 %2 in direction %3 relative to %4",args0:[{type:"field_number",name:"count",value:1,min:0},ut("units"),{type:"field_dropdown",name:"direction",options:[["left","LEFT"],["right","RIGHT"],["up","UP"],["down","DOWN"],["front","FRONT"],["back","BACK"]]},{type:"field_dropdown",name:"person",options:[["agent","AGENT"],["speaker","SPEAKER"]]}],output:it.Location,colour:230,tooltip:"A relative location, specifying a location relative to the agent or speaker.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.location_relative={init:function(){this.jsonInit(pt),rt(this)}},qe.JavaScript.location_relative=function(e){var t=e.getFieldValue("count"),a=e.getFieldValue("units"),n=e.getFieldValue("direction");return['"location": {\n  "steps": '.concat(t,',\n  "has_measure": "').concat(a,'",\n  "relative_direction": "').concat(n,'"\n}'),qe.JavaScript.ORDER_NONE]};var dt={type:"player_location",message0:"Player Location",output:it.Location,colour:230,tooltip:"Location in game world of your Minecraft player.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.player_location={init:function(){this.jsonInit(dt)}},qe.JavaScript.player_location=function(e){return['"location": { "reference_object": { "special_reference": "SPEAKER" } }',qe.JavaScript.ORDER_NONE]};var ft={type:"agent_location",message0:"Agent Location",output:it.Location,colour:230,tooltip:"Location in game world of the Craftassist bot.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.agent_location={init:function(){this.jsonInit(ft)}},qe.JavaScript.agent_location=function(e){return['"location": { "reference_object": { "special_reference": "AGENT" } }',qe.JavaScript.ORDER_NONE]};var gt={type:"agent_move",message0:"move agent towards %1",args0:[{type:"input_value",name:"pos",check:it.Location}],previousStatement:it.CommandDict,nextStatement:it.CommandDict,style:"loop_blocks",helpUrl:"",tooltip:"Move the agent towards a location.",mutator:"labelMutator"};qe.Blocks.agent_move={init:function(){this.jsonInit(gt),rt(this)}},qe.JavaScript.agent_move=function(e){var t=qe.JavaScript.valueToCode(e,"pos",qe.JavaScript.ORDER_NONE);return'{\n  "action_type": "move",\n  '.concat(t,"\n}")};var vt={type:"controls_doUntil",message0:"repeat until %1",args0:[{type:"input_value",name:"BOOL",check:it.Boolean}],message1:"do %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"",tooltip:"Until a boolean condition is met, repeatedly loop a set of commands.",mutator:"labelMutator"};qe.Blocks.controls_doUntil={init:function(){this.jsonInit(vt),rt(this)}},qe.JavaScript.controls_doUntil=function(e){var t=qe.JavaScript.valueToCode(e,"BOOL",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.statementToCode(e,"DO"),n="";if(Ke(a)<=1){var o=JSON.parse(a);o.control={stop_condition:JSON.parse(t)},n=JSON.stringify(o)}else a=Ye(a),n='{ "action_list": { "list": ['.concat(a,'],\n    "control": {\n      "stop_condition": ').concat(t,"\n    }\n  }}");return n};var bt={type:"controls_doForever",message0:"do forever %1",args0:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"",tooltip:"Repeatedly loop a set of commands.",mutator:"labelMutator"};qe.Blocks.controls_doForever={init:function(){this.jsonInit(bt),rt(this)}},qe.JavaScript.controls_doForever=function(e){var t="",a=qe.JavaScript.statementToCode(e,"DO");if(Ke(a)<=1){var n=JSON.parse(a);n.control={repeat_key:"FOR",repeat_count:"forever"},t=JSON.stringify(n)}else a=Ye(a),t='{ "action_list": {\n    "list": ['.concat(a,'],\n    "control": {\n      "repeat_key": "FOR",\n      "repeat_count": "forever"\n    }\n  }}');return t};var yt={type:"controls_doNTimes",message0:"repeat %1 times",args0:[{type:"field_number",name:"REPEATS",value:1}],message1:"do %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"",tooltip:"Loop a set of commands a given amount of times.",mutator:"labelMutator"};qe.Blocks.controls_doNTimes={init:function(){this.jsonInit(yt),rt(this)}},qe.JavaScript.controls_doNTimes=function(e){var t=e.getFieldValue("REPEATS"),a="",n=qe.JavaScript.statementToCode(e,"DO");if(Ke(n)<=1){var o=JSON.parse(n);o.control={repeat_key:"FOR",repeat_count:t},a=JSON.stringify(o)}else n=Ye(n),a='{ "action_list": {\n    "list": ['.concat(n,'],\n    "control": {\n      "repeat_key": "FOR",\n      "repeat_count": "').concat(t,'"\n    }\n  }}');return a};var Et={type:"controls_custom_ifelse",message0:"if %1",args0:[{type:"input_value",name:"IF",check:it.Boolean}],message1:"then %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",extensions:["controls_if_tooltip"],mutator:"labelMutator"};qe.Blocks.controls_custom_ifelse={init:function(){this.jsonInit(Et),rt(this)}},qe.JavaScript.controls_custom_ifelse=function(e){var t=qe.JavaScript.valueToCode(e,"IF",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.statementToCode(e,"DO"),n="";if(Ke(a)<=1){var o=JSON.parse(a);o.control={on_condition:JSON.parse(t)},n=JSON.stringify(o)}else a=Ye(a),n='{ "action_list": { "list": ['.concat(a,'],\n    "control": {\n      "on_condition": ').concat(t,"\n    }\n  }}");return n};var _t={type:"controls_command",message0:"command %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STEPS"}],colour:230,tooltip:"Place your command steps in this block.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.controls_command={init:function(){this.jsonInit(_t),rt(this),this.setDeletable(!1)}},qe.JavaScript.controls_command=function(e){return qe.JavaScript.statementToCode(e,"STEPS")};var kt={type:"controls_savedCommand",message0:"command %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STEPS"}],colour:230,previousStatement:null,nextStatement:null,tooltip:"Place your command steps in this block.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.controls_savedCommand={init:function(){this.jsonInit(kt),rt(this)}},qe.JavaScript.controls_savedCommand=function(e){return qe.JavaScript.statementToCode(e,"STEPS")};var Ot={type:"boolean_proximity",message0:" %1 is %2 %3 %4 from %5",args0:[{type:"input_value",name:"LOC1",check:it.Location},ht("COMP"),{type:"field_number",name:"NUM_BLOCKS",value:1,min:1},ut("UNITS"),{type:"input_value",name:"LOC2",check:it.Location}],inputsInline:!0,output:it.Boolean,style:"logic_blocks",tooltip:"Given two locations, returns true if the proximity condition between the two is true.",helpUrl:"",mutator:"labelMutator"};qe.Blocks.boolean_proximity={init:function(){this.jsonInit(Ot),rt(this)}},qe.JavaScript.boolean_proximity=function(e){var t=e.getFieldValue("NUM_BLOCKS"),a=e.getFieldValue("COMP"),n=e.getFieldValue("UNITS"),o=qe.JavaScript.valueToCode(e,"LOC1",qe.JavaScript.ORDER_NONE),i=qe.JavaScript.valueToCode(e,"LOC2",qe.JavaScript.ORDER_NONE);return['{ "condition": {\n    "condition_type": "COMPARATOR",\n    "input_left" : {"value_extractor": {"distance_between" : [\n      { '.concat(o," },\n      { ").concat(i,' }\n    ]}},\n    "input_right": {\n      "value_extractor": ').concat(t,'\n    },\n    "comparison_type": "').concat(a,'",\n    "comparison_measure": "').concat(n,'"\n  }\n}'),qe.JavaScript.ORDER_NONE]};var St={type:"boolean_comparator",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:[it.Number]},ht("COMP"),{type:"input_value",name:"B",check:[it.Number]}],inputsInline:!0,output:it.Boolean,style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",mutator:"labelMutator"};qe.Blocks.boolean_comparator={init:function(){this.jsonInit(St),rt(this)}},qe.JavaScript.boolean_comparator=function(e){var t=qe.JavaScript.valueToCode(e,"A",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.valueToCode(e,"B",qe.JavaScript.ORDER_NONE),n=e.getFieldValue("COMP");return['{\n    "condition": {\n      "condition_type": "COMPARATOR",\n      "input_left": {\n        "value_extractor": '.concat(t,'\n      },\n      "input_right": {\n        "value_extractor": ').concat(a,'\n      },\n      "comparison_type": "').concat(n,'"\n    }\n  }'),qe.JavaScript.ORDER_NONE]};var wt={type:"boolean_stringMatches",message0:"%1 text matches %2",args0:[{type:"input_value",name:"A",check:[it.String]},{type:"input_value",name:"B",check:[it.String]}],inputsInline:!0,output:it.Boolean,style:"logic_blocks",helpUrl:"",mutator:"labelMutator"};qe.Blocks.boolean_stringMatches={init:function(){this.jsonInit(wt),rt(this)}},qe.JavaScript.boolean_stringMatches=function(e){var t=qe.JavaScript.valueToCode(e,"A",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.valueToCode(e,"B",qe.JavaScript.ORDER_NONE);return['{\n    "condition": {\n      "condition_type": "COMPARATOR",\n      "input_left": { "value_extractor": '.concat(t,' },\n      "comparison_type": "EQUAL",\n      "input_right": {\n        "value_extractor": ').concat(a,"\n      }\n    }\n  }"),qe.JavaScript.ORDER_NONE]};var xt={type:"boolean_and",message0:"%1 and %2",args0:[{type:"input_value",name:"A",check:[it.Boolean]},{type:"input_value",name:"B",check:[it.Boolean]}],inputsInline:!0,output:it.Boolean,style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",mutator:"labelMutator"};qe.Blocks.boolean_and={init:function(){this.jsonInit(xt),rt(this)}},qe.JavaScript.boolean_and=function(e){var t=qe.JavaScript.valueToCode(e,"A",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.valueToCode(e,"B",qe.JavaScript.ORDER_NONE);return['{ "condition": {\n    "condition_type": "AND",\n    "and_condition": [\n      '.concat(t,",\n      ").concat(a,"\n    ]\n  }}"),qe.JavaScript.ORDER_NONE]};var Ct={type:"boolean_or",message0:"%1 or %2",args0:[{type:"input_value",name:"A",check:[it.Boolean]},{type:"input_value",name:"B",check:[it.Boolean]}],inputsInline:!0,output:it.Boolean,style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",mutator:"labelMutator"};qe.Blocks.boolean_or={init:function(){this.jsonInit(Ct),rt(this)}},qe.JavaScript.boolean_or=function(e){var t=qe.JavaScript.valueToCode(e,"A",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.valueToCode(e,"B",qe.JavaScript.ORDER_NONE);return['{ "condition": {\n    "condition_type": "OR",\n    "or_condition": [\n      '.concat(t,",\n      ").concat(a,"\n    ]\n  }}"),qe.JavaScript.ORDER_NONE]};var jt={type:"boolean_not",message0:"not %1",args0:[{type:"input_value",name:"A",check:[it.Boolean]}],inputsInline:!0,output:it.Boolean,style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",mutator:"labelMutator"};qe.Blocks.boolean_not={init:function(){this.jsonInit(jt),rt(this)}},qe.JavaScript.boolean_not=function(e){var t=qe.JavaScript.valueToCode(e,"A",qe.JavaScript.ORDER_NONE);return['{ "condition": {\n    "condition_type": "NOT",\n    "not_condition": '.concat(t,"\n  }}"),qe.JavaScript.ORDER_NONE]};var Mt={type:"boolean_timeEvent",message0:"game event %1",args0:[{type:"field_dropdown",name:"EVENT",options:[["sunset","SUNSET"],["sunrise","SUNRISE"],["day","DAY"],["night","NIGHT"],["rain","RAIN"],["sunny","SUNNY"]]}],inputsInline:!0,output:it.Boolean,tooltip:"Represents an in-game event happening. Returns true when that event is happening.",style:"logic_blocks",mutator:"labelMutator"};qe.Blocks.boolean_timeEvent={init:function(){this.jsonInit(Mt),rt(this)}},qe.JavaScript.boolean_timeEvent=function(e){var t=e.getFieldValue("EVENT");return['{\n    "condition": {\n      "condition_type": "TIME",\n      "special_time_event": "'.concat(t,'"\n    }\n  }'),qe.JavaScript.ORDER_NONE]};var Rt,Tt={type:"boolean_timePassed",message0:"%1 %2 have passed",args0:[{type:"field_number",name:"COUNT",value:1},(Rt="UNITS",{type:"field_dropdown",name:Rt,options:ct.map((function(e){return[e,e.toUpperCase()]}))})],inputsInline:!0,output:it.Boolean,style:"logic_blocks",tooltip:"Represents time passing. Returns true after the amount of time specified has passed.",mutator:"labelMutator"};qe.Blocks.boolean_timePassed={init:function(){this.jsonInit(Tt),rt(this)}},qe.JavaScript.boolean_timePassed=function(e){var t=e.getFieldValue("COUNT"),a=e.getFieldValue("UNITS");return['{\n    "condition": {\n      "condition_type": "TIME",\n      "comparison_type": "GREATER_THAN",\n      "input_right": {\n        "value_extractor": "'.concat(t,'"\n      },\n      "comparison_measure": "').concat(a,'"\n    }\n  }'),qe.JavaScript.ORDER_NONE]};var It={type:"value_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:it.Number,helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"],mutator:"labelMutator"};qe.Blocks.value_number={init:function(){this.jsonInit(It),rt(this)}},qe.JavaScript.value_number=function(e){return[e.getFieldValue("NUM").toString(),qe.JavaScript.ORDER_NONE]};var Nt={type:"value_textj",message0:"%1",args0:[{type:"field_input",name:"TEXT",value:""}],output:it.String,style:"math_blocks",extensions:["parent_tooltip_when_inline"],mutator:"labelMutator"};qe.Blocks.value_text={init:function(){this.jsonInit(Nt),rt(this)}},qe.JavaScript.value_text=function(e){var t=e.getFieldValue("TEXT");return['"'.concat(t,'"'),qe.JavaScript.ORDER_NONE]};var Lt=Object.values(ot).reduce((function(e,t){return t.forEach((function(t){return!e.find((function(e){return e&&e[0]===t[0]}))&&e.push(t)})),e}),[]),Dt={type:"value_accessor",message0:"%1 get value of %2",args0:[{type:"input_value",name:"OBJ",check:[it.Location,it.Time,it.Mob,it.BlockObject]},{type:"field_dropdown",name:"FIELD",options:function(){var e=this.getSourceBlock();if(!e)return Lt;var t=e.getInputTargetBlock("OBJ");if(!t)return Lt;var a=t.outputConnection.getCheck();return a?a.includes(it.Location)?ot[it.Location]:a.includes(it.Time)?ot[it.Time]:a.includes(it.Mob)?ot[it.Mob]:a.includes(it.BlockObject)?ot[it.BlockObject]:Lt:Lt}}],output:null,helpUrl:"",style:"math_blocks",tooltip:"Get a field of a given object.",mutator:"labelMutator"};qe.Blocks.value_accessor={init:function(){this.jsonInit(Dt),rt(this)}};var Bt=function(e,t){var a=Object(oe.a)({output:{memory_node:"ReferenceObject",attribute:t}},function(e){var t=JSON.parse(e);if(t.reference_object)return t.reference_object.filters?t.reference_object.filters:{};console.error("Accessor not provided with reference object.")}(e)),n=JSON.stringify(a);return'{ "filters": '.concat(n," }")};qe.JavaScript.value_accessor=function(e){var t=e.getInputTargetBlock("OBJ").outputConnection.getCheck();if(t.length<0)return console.error("Accessor input has no type."),["",qe.JavaScript.ORDER_NONE];var a=t[0],n=qe.JavaScript.valueToCode(e,"OBJ",qe.JavaScript.ORDER_NONE),o=e.getFieldValue("FIELD"),i="";switch(a){case it.Mob:case it.BlockObject:i=function(e,t){var a="";switch(t){case"LOC":a='"location": '.concat(e);break;case"X":a=Bt(e,"x");break;case"Y":a=Bt(e,"y");break;case"Z":a=Bt(e,"z");break;case"NAME":a=Bt(e,"tag");break;case"TYPE":a=Bt(e,"name");break;case"SIZE":a=Bt(e,"size");break;case"COLOR":a=Bt(e,"color");break;default:console.warn("Unsupported field used in accessor. Returning empty form.")}return a}(n,o);break;case it.Location:i=function(e,t){var a=e.indexOf("{"),n=e.slice(a),o=JSON.parse(n);if(o.reference_object){if("AGENT"===o.reference_object.special_reference)return'{ "filters": {\n      "output": {\n        "memory_node": "SelfNode",\n        "attribute": "'.concat(t.toLowerCase(),'"\n    } }');if("SPEAKER"===o.reference_object.special_reference)return'{ "filters": {\n      "output": {\n        "memory_node": "PlayerNode",\n        "attribute": "'.concat(t.toLowerCase(),'"\n    } }');var i=o.reference_object.special_reference.coordinate_span.split(", "),r=Object(ne.a)(i,3),s=r[0],l=r[1],c=r[2];return'"'.concat("X"===t?s:"Y"===t?l:c,'"')}return console.warn("The accessor is not yet supported for relative locations. Using default value 1."),"1"}(n,o);break;default:console.error("Accessor block given unsupported type.")}return[i,qe.JavaScript.ORDER_NONE]};var At={type:"value_mob",message0:"mob %1",args0:[mt("MOBTYPE")],message1:"with name %1",args1:[{type:"field_input",name:"NAME",value:""}],output:it.Mob,helpUrl:"",colour:40,tooltip:"Represents a mob in the Minecraft game. Use with accessor block to extract values.",mutator:"labelMutator"};qe.Blocks.value_mob={init:function(){this.jsonInit(At),rt(this)}},qe.JavaScript.value_mob=function(e){var t=qe.JavaScript.valueToCode(e,"MOBTYPE",qe.JavaScript.ORDER_NONE),a=qe.JavaScript.valueToCode(e,"NAME",qe.JavaScript.ORDER_NONE);return['{ "reference_object": {\n    "filters": {\n      '.concat("ANY"!==t&&'"has_name": '.concat(t,","),"\n      ").concat(a&&'"has_tag": '.concat(a,","),"\n    }\n  } }"),qe.JavaScript.ORDER_NONE]};var Jt={type:"value_closestMob",message0:"closest %1 to %2",args0:[mt("MOBTYPE"),{type:"input_value",name:"LOC",check:[it.Location]}],output:it.Mob,inputsInline:!0,helpUrl:"",colour:40,tooltip:"Represents the closest mob to the given position in the Minecraft game. Use with accessor block to extract values.",mutator:"labelMutator"};qe.Blocks.value_closestMob={init:function(){this.jsonInit(Jt),rt(this)}},qe.JavaScript.value_closestMob=function(e){var t=e.getFieldValue("MOBTYPE"),a=qe.JavaScript.valueToCode(e,"LOC",qe.JavaScript.ORDER_NONE);return['{ "reference_object": {\n    "filters": {\n      "has_name": "'.concat(t,'",\n      "argmin" : {\n        "ordinal" : "FIRST",\n        "quantity" : {\n          "linear_extent" : {\n            ').concat(a,"\n          }\n        }\n      }\n    }\n  } }"),qe.JavaScript.ORDER_NONE]};var Pt={type:"value_blockObject",message0:"block object",message1:"filters %1",args1:[{type:"input_statement",name:"FILTERS",check:[it.Filter]}],output:it.BlockObject,inputsInline:!0,helpUrl:"",colour:40,tooltip:"Represents a group of blocks in the world. Use with accessor block to extract values.",mutator:"labelMutator"};qe.Blocks.value_blockObject={init:function(){this.jsonInit(Pt),rt(this)}},qe.JavaScript.value_blockObject=function(e){var t=qe.JavaScript.statementToCode(e,"FILTERS");return['{ "reference_object": {\n    "filters": {\n      '.concat(t.slice(0,-2),"\n    }\n  }}"),qe.JavaScript.ORDER_NONE]};var Ut={type:"value_filterColor",message0:"has color %1",args0:[{type:"field_input",name:"COLOR",check:[it.String]}],inputsInline:!0,previousStatement:it.Filter,nextStatement:it.Filter,helpUrl:"",colour:40,tooltip:"Filter option for filtering by reference object color. Use with block object block.",mutator:"labelMutator"};qe.Blocks.value_filterColor={init:function(){this.jsonInit(Ut),rt(this)}},qe.JavaScript.value_filterColor=function(e){var t=e.getFieldValue("COLOR");return'"has_color": "'.concat(t,'",\n')};var Ft={type:"value_filterLocation",message0:"at location %1",args0:[{type:"input_value",name:"LOC",check:[it.Location]}],inputsInline:!0,previousStatement:it.Filter,nextStatement:it.Filter,helpUrl:"",colour:40,tooltip:"Filter option for filtering by reference object location. Use with block object block.",mutator:"labelMutator"};qe.Blocks.value_filterLocation={init:function(){this.jsonInit(Ft),rt(this)}},qe.JavaScript.value_filterLocation=function(e){var t=qe.JavaScript.valueToCode(e,"LOC",qe.JavaScript.ORDER_NONE);return"".concat(t,",\n")};var Ht={type:"value_filterName",message0:"has name %1",args0:[{type:"field_input",name:"NAME"}],inputsInline:!0,previousStatement:it.Filter,nextStatement:it.Filter,helpUrl:"",colour:40,tooltip:"Filter option for filtering by reference object name. Use with block object block.",mutator:"labelMutator"};qe.Blocks.value_filterName={init:function(){this.jsonInit(Ht),rt(this)}},qe.JavaScript.value_filterName=function(e){var t=e.getFieldValue("NAME");return'"has_name": "'.concat(t,'",\n')};var Vt={type:"value_filterSize",message0:"has size %1",args0:[{type:"field_input",name:"SIZE",check:[it.String]}],inputsInline:!0,previousStatement:it.Filter,nextStatement:it.Filter,helpUrl:"",colour:40,tooltip:"Filter option for filtering by reference object size. Use with block object block.",mutator:"labelMutator"};qe.Blocks.value_filterSize={init:function(){this.jsonInit(Vt),rt(this)}},qe.JavaScript.value_filterSize=function(e){var t=e.getFieldValue("SIZE");return'"has_size": "'.concat(t,'",\n')};var zt={type:"value_filterCoreference",message0:"contains coreference",args0:[],inputsInline:!0,previousStatement:it.Filter,nextStatement:it.Filter,helpUrl:"",colour:40,tooltip:"Filter option for filtering by whether or not the object has a coreference. Use with block object block.",mutator:"labelMutator"};qe.Blocks.value_filterCoreference={init:function(){this.jsonInit(zt),rt(this)}},qe.JavaScript.value_filterCoreference=function(e){return'"contains_coreference": "yes",\n'};var Wt={type:"gameplay_clock",message0:"Clock",output:it.Time,helpUrl:"",colour:20,tooltip:"Gets the time of day. Use with accessor or compare blocks.",mutator:"labelMutator"};qe.Blocks.gameplay_clock={init:function(){this.jsonInit(Wt)}},qe.JavaScript.gameplay_clock=function(e){return["",qe.JavaScript.ORDER_NONE]};var Gt={type:"gameplay_gameTime",message0:"Game time %1",args0:[{type:"field_dropdown",name:"TIME",options:[["sunrise","SUNRISE"],["day","DAY"],["noon","NOON"],["sunset","SUNSET"],["night","NIGHT"],["midnight","MIDNIGHT"]]}],output:it.Time,helpUrl:"",colour:20,tooltip:"Gets the time of day. Use with accessor or compare blocks.",mutator:"labelMutator"};qe.Blocks.gameplay_gameTime={init:function(){this.jsonInit(Gt)}},qe.JavaScript.gameplay_gameTime=function(e){return["",qe.JavaScript.ORDER_NONE]};var Yt={type:"gameplay_timer",message0:"Timer",output:it.Time,helpUrl:"",colour:20,tooltip:'Gets current value of timer. Use with accessor or compare blocks. Set timer with "Start Timer" block.',mutator:"labelMutator"};qe.Blocks.gameplay_timer={init:function(){this.jsonInit(Yt)}},qe.JavaScript.gameplay_timer=function(e){return["",qe.JavaScript.ORDER_NONE]};var Kt={type:"gameplay_startTimer",message0:"Start Timer",previousStatement:null,nextStatement:null,helpUrl:"",colour:20,tooltip:'Starts a timer. Use "Timer" block to access current time.',mutator:"labelMutator"};qe.Blocks.gameplay_startTimer={init:function(){this.jsonInit(Kt)}},qe.JavaScript.gameplay_startTimer=function(e){return["",qe.JavaScript.ORDER_NONE]};var Xt={type:"gameplay_stopTimer",message0:"Stop Timer",previousStatement:null,nextStatement:null,helpUrl:"",colour:20,tooltip:'Stops the current timer without resetting it. Use "Timer" block to access current time.',mutator:"labelMutator"};qe.Blocks.gameplay_stopTimer={init:function(){this.jsonInit(Xt)}},qe.JavaScript.gameplay_stopTimer=function(e){return["",qe.JavaScript.ORDER_NONE]};var Qt={type:"gameplay_resetTimer",message0:"Reset Timer",previousStatement:null,nextStatement:null,helpUrl:"",colour:20,tooltip:'Resets and stops the current timer. Use "Timer" block to access current time.',mutator:"labelMutator"};qe.Blocks.gameplay_resetTimer={init:function(){this.jsonInit(Qt)}},qe.JavaScript.gameplay_resetTimer=function(e){return["",qe.JavaScript.ORDER_NONE]};var qt=qe.BlockSvg.prototype.updateCollapsed_;qe.BlockSvg.prototype.oldUpdateCollapsed_=qt,qe.BlockSvg.prototype.updateCollapsed_=function(){if(this.label){for(var e,t=this.isCollapsed(),a=qe.Block.COLLAPSED_INPUT_NAME,n=qe.Block.COLLAPSED_FIELD_NAME,o=0;e=this.inputList[o];o++)e.name!==a&&e.setVisible(!t);if(!t)return void this.removeInput(a);for(var i,r=this.getIcons(),s=0;i=r[s];s++)i.setVisible(!1);var l=this.label,c=this.getField(n);if(c)return void c.setValue(l);(this.getInput(a)||this.appendDummyInput(a)).appendField(new qe.FieldLabel(l),n)}else this.oldUpdateCollapsed_()};var Zt={mutationToDom:function(){var e=document.createElement("mutation"),t=this.label;return t&&e.setAttribute("label",t),e},domToMutation:function(e){var t=e.getAttribute("label");t&&(this.label=t)}};Qe.a.Extensions.registerMutator("labelMutator",Zt);var $t=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(ta,{name:"Booleans"},o.a.createElement(ea,{type:"boolean_proximity"}),o.a.createElement(ea,{type:"boolean_timeEvent"}),o.a.createElement(ea,{type:"boolean_timePassed"}),o.a.createElement(ea,{type:"boolean_comparator"}),o.a.createElement(ea,{type:"boolean_stringMatches"}),o.a.createElement(ea,{type:"boolean_and"}),o.a.createElement(ea,{type:"boolean_or"}),o.a.createElement(ea,{type:"boolean_not"})),o.a.createElement(ta,{name:"Control"},o.a.createElement(ea,{type:"controls_custom_ifelse"}),o.a.createElement(ea,{type:"controls_doUntil"}),o.a.createElement(ea,{type:"controls_doForever"}),o.a.createElement(ea,{type:"controls_doNTimes"})),o.a.createElement(ta,{name:"Location"},o.a.createElement(ea,{type:"location"}),o.a.createElement(ea,{type:"location_relative"}),o.a.createElement(ea,{type:"player_location"}),o.a.createElement(ea,{type:"agent_location"})),o.a.createElement(ta,{name:"Actions"},o.a.createElement(ea,{type:"agent_move"})),o.a.createElement(ta,{name:"Values"},o.a.createElement(ea,{type:"value_number"}),o.a.createElement(ea,{type:"value_text"}),o.a.createElement(ea,{type:"value_accessor"}),o.a.createElement(ea,{type:"value_mob"}),o.a.createElement(ea,{type:"value_closestMob"}),o.a.createElement(ta,{name:"Block Object"},o.a.createElement(ea,{type:"value_blockObject"}),o.a.createElement(ea,{type:"value_filterColor"}),o.a.createElement(ea,{type:"value_filterLocation"}),o.a.createElement(ea,{type:"value_filterName"}),o.a.createElement(ea,{type:"value_filterSize"}),o.a.createElement(ea,{type:"value_filterCoreference"}))))};Ze.a.setLocale(et.a);var ea=function(e){var t=e.children,a=Object(ie.a)(e,["children"]);return o.a.createElement("block",Object.assign({is:"blockly"},a),t)},ta=function(e){var t=e.children,a=e.name,n=Object(ie.a)(e,["children","name"]);return o.a.createElement("category",Object.assign({is:"blockly",name:a},n),t)},aa=o.a.forwardRef((function(e,t){var a=e.initialXml,i=e.children,r=Object(ie.a)(e,["initialXml","children"]),s=Object(n.useRef)(),l=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=Ze.a.inject(s.current,Object(oe.a)({toolbox:l.current},r)),a&&Ze.a.Xml.domToWorkspace(Ze.a.Xml.textToDom(a),t.current)}),[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{id:"blocklyDiv",ref:s}),o.a.createElement("xml",{xmlns:"https://developers.google.com/blockly/xml",is:"blockly",style:{display:"none"},ref:l},i))})),na=a(397);function oa(e){var t=e.block,a=e.open,i=e.closeModal,r=e.saveBlockToDatabase,s=e.error,l=t&&t.label||"",c=Object(n.useState)(""),u=Object(ne.a)(c,2),h=u[0],m=u[1];Object(n.useEffect)((function(){m(l)}),[l]);var p=function(){t.setCollapsed(!1),t.setCollapsed(!0),m(""),i()};return o.a.createElement(Ae.a,{open:a,onClose:i,"aria-labelledby":"form-dialog-title"},o.a.createElement(Ue.a,{id:"form-dialog-title"},"Label Block"),o.a.createElement(Pe.a,null,o.a.createElement(na.a,null,"Type a name for the block you right-clicked on in the box below. Once you add a label, you can save the label, or save the block to the database with the label you wrote."),o.a.createElement(na.a,{color:"error"},s),o.a.createElement(H.a,{autoFocus:!0,margin:"dense",id:"name",label:"Block Label",type:"text",value:h,onChange:function(e){return m(e.target.value)},fullWidth:!0})),o.a.createElement(Je.a,null,o.a.createElement(R.a,{onClick:i,color:"secondary"},"Cancel"),o.a.createElement(R.a,{onClick:function(){t.label=h,p()},color:"secondary",disabled:!h},"Save Label"),o.a.createElement(R.a,{onClick:function(){t.label=h;var e=Qe.a.Xml.domToText(Qe.a.Xml.blockToDom(t)),a='<xml xmlns="https://developers.google.com/blockly/xml">'.concat(e,"</xml>");r(a,h),p()},color:"secondary",disabled:!h},"Save Block")))}var ia=a(403),ra=function(e){var t=e.tagsList,a=e.setTagsList,i=Object(De.a)((function(e){return{formLabel:{color:"#ffffff"},formHelperText:{color:"#ffffff"},formInput:{color:"#ffffff"}}}))(),r=Object(n.useState)(""),s=Object(ne.a)(r,2),l=s[0],c=s[1],u=function(){var e=Object(n.useRef)(0);return{getNextKey:function(){return e.current++,e.current}}}().getNextKey,h=function(e){return function(){a((function(t){return t.filter((function(t){return t.tag!==e.tag}))}))}};return o.a.createElement("div",null,o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),l&&!t.find((function(e){return e.tag===l}))&&a((function(e){return e.concat([{tag:l,key:u()}])})),c("")}},o.a.createElement(H.a,{size:"small",variant:"outlined",label:"Tag",InputLabelProps:{className:i.formLabel},FormHelperTextProps:{className:i.formHelperText},InputProps:{className:i.formInput},helperText:"Keywords that will find your command in searches.",value:l,onChange:function(e){return c(e.target.value)},style:{maxWidth:"320px",marginRight:"20px",marginBottom:"10px"}}),o.a.createElement(R.a,{type:"submit",variant:"contained",color:"secondary"},"Add Tag"),o.a.createElement("span",{style:{display:"flex",maxHeight:"40px",overflow:"scroll",flexWrap:"wrap"}},t.map((function(e){return o.a.createElement(ia.a,{label:e.tag,onDelete:h(e),key:e.key,style:{marginLeft:"10px",marginBottom:"10px"}})})))))},sa='<xml xmlns="https://developers.google.com/blockly/xml"></xml>',la=Object(De.a)((function(e){return{gridRoot:{backgroundColor:"#333333",maxHeight:"calc(50vh - 64px)",minHeight:"calc(50vh - 64px)"},right:{padding:e.spacing(3,5,1),display:"flex",justifyContent:"space-between",flexDirection:"column",overflow:"scroll"},left:{padding:e.spacing(3,5,1),display:"flex",justifyContent:"space-between",flexDirection:"column",overflow:"scroll"},savedCommandsTitle:{margin:e.spacing(3,5,1)},search:Object(re.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:"#fff","&:hover":{backgroundColor:Object(Be.c)("#ffffff",.75)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:Object(re.a)({padding:e.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(e.spacing(4),"px)"),transition:e.transitions.create("width"),width:"100%",color:"#000000",textAlign:"left"},e.breakpoints.up("md"),{width:"20ch"}),searchResult:{"&:hover":{backgroundColor:"#D8D8D8"},padding:e.spacing(1,2,1),margin:e.spacing(0,3),cursor:"pointer"},searchResultList:{maxHeight:"calc(50vh - 154px)",overflow:"scroll",color:"#ffffff"},formLabel:{color:"#ffffff"},formHelperText:{color:"#ffffff"},formInput:{color:"#ffffff"}}})),ca=function(e){var t=e.classes,a=e.commandText,n=e.setCommandText,i=e.logCode,r=e.saveCommand,s=e.statusMessage,l=e.tagsList,c=e.setTagsList;return o.a.createElement(ge.a,{item:!0,xs:!0,className:t.left},o.a.createElement("div",null,o.a.createElement(ve.a,{variant:"h5",style:{marginBottom:"10px",color:"#ffffff"}},"Command Information"),o.a.createElement(H.a,{id:"standard-basic",label:"Command Text",InputLabelProps:{className:t.formLabel},FormHelperTextProps:{className:t.formHelperText},InputProps:{className:t.formInput},helperText:"The chat message that will make the bot perform your command.",value:a,onChange:function(e){return n(e.target.value)},style:{paddingBottom:"20px",maxWidth:"500px",color:"#ffffff"}}),o.a.createElement(ra,{tagsList:l,setTagsList:c})),o.a.createElement("div",{style:{marginBottom:"20px",alignSelf:"flex-end",display:"flex",alignItems:"center"}},o.a.createElement(ve.a,{variant:"body1",style:{marginRight:"10px",display:"inline",fontStyle:"italic"}},s),o.a.createElement(R.a,{size:"small",onClick:r,variant:"contained",color:"secondary",style:{marginRight:"10px"}},"Save Command"),o.a.createElement(R.a,{size:"small",onClick:i,variant:"contained",color:"secondary",style:{marginRight:"10px"}},"Generate Code"),o.a.createElement(R.a,{size:"small",variant:"contained",color:"secondary"},o.a.createElement(Ne.b,{to:"/teach_welcome",style:{color:"inherit",textDecoration:"none"},target:"_blank",rel:"noopener noreferrer"},"View Docs"))))},ua=function(e){var t=e.classes,a=e.query,n=e.setQuery,i=e.addBlockToWorkspace,r=e.commandsList;return o.a.createElement(ge.a,{item:!0,xs:!0,className:t.right},o.a.createElement(ve.a,{variant:"h5",className:t.savedCommandsTitle},"Saved Commands"),o.a.createElement("div",{className:t.search},o.a.createElement("div",{className:t.searchIcon},o.a.createElement(We.a,null)),o.a.createElement(Ve.a,{placeholder:"Search\u2026",classes:{root:t.inputRoot,input:t.inputInput},value:a,onChange:function(e){return n(e.target.value)},inputProps:{"aria-label":"search"}})),o.a.createElement("div",{className:t.searchResultList},0===r.length?o.a.createElement("div",null,"There are no commands yet."):Object(M.a)(r).reverse().map((function(e){return o.a.createElement("div",{className:t.searchResult,key:e.cmd_id,onClick:function(){return i(e)}},e.chat_message||"Untitled command")}))))},ha=function(e){var t=e.username,a=e.stateManager,i=e.updatedCommandList,r=Object(n.useState)(""),s=Object(ne.a)(r,2),l=s[0],c=s[1],u=Object(n.useState)(""),h=Object(ne.a)(u,2),m=h[0],p=h[1],d=Object(n.useState)(""),f=Object(ne.a)(d,2),g=f[0],v=f[1],b=Object(n.useState)([]),y=Object(ne.a)(b,2),E=y[0],_=y[1],k=Object(n.useState)([]),O=Object(ne.a)(k,2),S=O[0],w=O[1],x=Object(n.useState)(null),C=Object(ne.a)(x,2),j=C[0],M=C[1],R=Object(n.useState)(null),T=Object(ne.a)(R,2),I=T[0],N=T[1],L=Object(n.useRef)(),D=Object(n.useRef)(),B=Object(n.useState)(!1),A=Object(ne.a)(B,2),J=A[0],P=A[1],U=Object(n.useState)({}),F=Object(ne.a)(U,2),H=F[0],V=F[1],z=la(),W=Object(n.useCallback)((function(e,t,a){var n={query:m};t.socket.emit("fetchCommand",n),e(a)}),[m]);Object(n.useEffect)((function(){W(_,a,i)}),[m]),Object(n.useEffect)((function(){window.openSetLabelModal_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;M(e),N(t)},window.saveBlockToDatabase_=Y}),[]);var G=function(){var e=at.a.workspaceToCode(D.current),t=e.length;return";"===e.charAt(t-1)?e=e.slice(0,t-1):";"===e.charAt(t-2)&&(e=e.slice(0,t-2)+e.slice(t-1)),'{ "dialogue_type": "HUMAN_GIVE_COMMAND",\n  "actions": {\n    "list": ['.concat(Ye(e),"]\n  }\n}")},Y=function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i={chat_message:n,block_assembly:e,username:t,tags_list:S.map((function(e){return e.tag}))};if(o&&(i.action_dict=o),L.current&&(clearTimeout(L.current),L.current=null),e===sa)return v("Command block not found."),void(L.current=setTimeout((function(){return v("")}),5e3));a.socket.emit("saveCommand",i)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(ge.a,{container:!0,alignItems:"flex-start",className:z.gridRoot},o.a.createElement(ca,{classes:z,commandText:l,setCommandText:c,logCode:function(){P(!0),V(G())},saveCommand:function(){var e=G(),t=function(){var e=D.current.getAllBlocks().find((function(e){return"controls_command"===e.type}));if(!e)return console.error("Couldn't find a top-level command block."),sa;e.type="controls_savedCommand";var t=Qe.a.Xml.domToText(Qe.a.Xml.blockToDom(e)),a='<xml xmlns="https://developers.google.com/blockly/xml">'.concat(t,"</xml>");return e.type="controls_command",a}();Y(t,l,e),W(_,a,i),w([]),c("")},statusMessage:g,tagsList:S,setTagsList:w}),o.a.createElement(ua,{classes:z,query:m,setQuery:p,addBlockToWorkspace:function(e){var t=Qe.a.Xml.textToDom(e.block_assembly),a=Qe.a.Xml.appendDomToWorkspace(t,D.current),n=D.current.getBlockById(a[0]);n&&(n.label=e.chat_message,n.setCollapsed(!1),n.setCollapsed(!0),n.setDeletable(!0))},commandsList:E})),o.a.createElement(aa,{ref:D,readOnly:!1,trashcan:!0,move:{scrollbars:!0,drag:!0,wheel:!0},initialXml:'\n<xml xmlns="http://www.w3.org/1999/xhtml">\n      <block type="controls_command"></block>\n</xml>\n'},o.a.createElement($t,null)),o.a.createElement(Fe,{open:J,close:function(){P(!1)},text_to_render:H}),o.a.createElement(oa,{open:null!==j,closeModal:function(){return M(null)},block:j,error:I,saveBlockToDatabase:Y}))},ma=Object(De.a)((function(e){return{wrapper:{margin:"24px 72px 8px",maxWidth:"80vw","&>:not(img)":{maxWidth:"1000px"}}}})),pa=function(){var e=ma();return o.a.createElement("div",{className:e.wrapper},o.a.createElement("h1",{id:"teach-the-bot"},"Teach the Bot"),o.a.createElement("br",null),o.a.createElement("p",null,"Welcome to the Teach tool"," ",o.a.createElement("span",{role:"img","aria-label":"Smiling Emoji"},"\ud83d\ude03"," "),o.a.createElement("br",null),o.a.createElement("br",null),"This tool is designed to provide users with a way to directly program the bot (or agent), allowing for another type of human-in-the-loop learning. The tool has a specific focus on conditional statements and booleans, using constructs like while...until loops to build out functionality for conditional control flow."),o.a.createElement("p",null,o.a.createElement("strong",null,"The Basics"),": To use the tool, drag and drop pieces from the categories in the toolbox to program the bot. Then, save your command and upload it to the bot (upload feature coming soon)."),o.a.createElement("br",null),o.a.createElement("h2",{id:"accessing-the-tool"},"Accessing the Tool"),o.a.createElement("br",null),o.a.createElement(R.a,{variant:"contained",color:"secondary"},o.a.createElement(Ne.b,{to:"/teach",style:{color:"inherit",textDecoration:"none"}},"Go to App")),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h2",{id:"parts-of-the-tool"},"Parts of the Tool"),o.a.createElement("p",null,o.a.createElement("img",{src:"/files/teach_sections_labeled.png",alt:"Labeled Sections of App",style:{maxWidth:"100%"}})),o.a.createElement("h3",{id:"1-command-info-panel"},"1. Command Info Panel"),o.a.createElement("p",null,"The command info panel, located in the top left, has a few important pieces:"),o.a.createElement("ol",null,o.a.createElement("li",null,"Command text: the chat message associated with the command being built"),o.a.createElement("li",null,"Add tags: add searchable tags to your current command. Once your command is saved, you can type these tags in the search box to bring your command up in the results."),o.a.createElement("li",null,'Save command: saves the command currently being built in the workspace under the "command" block'),o.a.createElement("li",null,"Generate code: generates and logs the logical form for the current command")),o.a.createElement("h3",{id:"2-command-search-panel"},"2. Command Search Panel"),o.a.createElement("p",null,"The command search panel, located in the top right, is where you can find the commands that you and other users have saved during their use of the tool. Type the name of the command, label, or tag in the search bar, and you'll see the command (and others with similar search terms) pop up in the results. You can then scroll through and select the block you want, and click it to repopulate it into the command builder."),o.a.createElement("p",null,o.a.createElement("em",null,"New Commands"),": If you want to build a fairly big new command, this is the place to start. Search for the functionality you need; it may already exist within the tool!"),o.a.createElement("h3",{id:"3-command-builder"},"3. Command Builder"),o.a.createElement("p",null,"The command builder, located in the bottom half of the screen, is the core of the tool. It uses a drag-and-drop interface to build commands."),o.a.createElement("h4",{id:"toolbox-categories"},"Toolbox & Categories"),o.a.createElement("p",null,'On the left of the command builder, the grey area represents the toolbox. This is the "drag" area of the tool, where you can find the pieces of commands and drag them into the workspace. The different blocks are organized into 6 different categories:'),o.a.createElement("ol",null,o.a.createElement("li",null,"Actions: actions the bot can take"),o.a.createElement("li",null,"Booleans: conditions for control flow"),o.a.createElement("li",null,"Control: blocks that affect what happens when, e.g. loops and if statements"),o.a.createElement("li",null,"Location: blocks related to location in the bot's world"),o.a.createElement("li",null,'Values: blocks that represent values, like 0 and "hello"',o.a.createElement("ul",null,o.a.createElement("li",null,'Also includes "object"-related blocks to represent objects in the bot\'s world, like mobs and block objects'),o.a.createElement("li",null,"Block objects have their own subcategory due to them needing a wide variety of filters to work correctly")))),o.a.createElement("h4",{id:"workspace"},"Workspace"),o.a.createElement("p",null,"The workspace is the right-hand side of the command builder. It's the blank white space into which you can drag any of the blocks from the toolbox. To build a command, simply drag any block from the toolbox into this white space. Keep doing this and you'll have a command built!"),o.a.createElement("p",null,"The workspace provides some other special features to enhance the drag-and-drop experience. They're listed below:"),o.a.createElement("p",null,o.a.createElement("em",null,"Command Block:")," This block is part of every command you create. When you click \"Save Command\", the blocks inside here are the command steps which will actually get saved. Any blocks outside this will be ignored. You can't delete this block because it's necessary for saving to work."),o.a.createElement("p",null,o.a.createElement("em",null,"Right-Click Menu:")," Blocks provide a custom menu on right-click that provides some special features. Some of the features are self-explanatory clipboard options (duplicate, delete) and the others are outlined below."),o.a.createElement("p",null,o.a.createElement("em",null,"Types:")," Certain blocks only fit into certain spaces, although they may look like they fit anywhere. This is because blocks have"," ",o.a.createElement("em",null,"types"),'; a block that outputs a "Location" type won\'t fit into a block that accepts a "Number" type.'),o.a.createElement("p",null,o.a.createElement("em",null,"Labels and Collapsing Blocks:"),' Every block can have a label associated with it. Once you give a block a label, you can "collapse" it, changing its appearance from the block-by-block command you built to a compact block with a single text label on it. To do this, right-click on the block, then click "Add Label", or "Collapse Block" if it already has a label. Don\'t worry, you can revert to the original state the same way, by right clicking the block and selecting "Collapse Block". You can also save blocks you\'ve labeled directly to the database in the pop-up window generated by the "Add Label" option.'),o.a.createElement("p",null,o.a.createElement("em",null,"Clipboard Tools:"),' Each block can be "highlighted" by a click, allowing basic clipboard controls to be used on it. This includes control-C (command-C on Mac) for copy, control-V/command-V for paste, backspace/delete for delete, and control-X/command-X for cut.'),o.a.createElement("h3",{id:"4-nav-bar"},"4. Nav Bar"),o.a.createElement("p",null,"The nav bar is a simple tool to help one get around the site. Use the menu in the top left to access the Chat app, and the settings button in the top right to visit the settings page for the application."))},da=Object(Se.a)({palette:{primary:{main:"#ffffff"},secondary:{main:"#5f5f5f"}}}),fa=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={username:"dashboard",updatedCommandList:[]},n.state=n.initialState,n.qRef=o.a.createRef(),n.updateCommandList=n.updateCommandList.bind(Object(p.a)(n)),n}return Object(u.a)(a,[{key:"updateCommandList",value:function(e){this.setState({updatedCommandList:e.commandList})}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.props.stateManager.socket.on("updateSearchList",this.updateCommandList))}},{key:"render",value:function(){return o.a.createElement(Ne.a,{ref:this.qRef},o.a.createElement(we.a,{theme:da},o.a.createElement("div",{ref:this.qRef},o.a.createElement(Le.c,null,o.a.createElement(Le.a,{path:"/teach_welcome"},o.a.createElement(pa,null)),o.a.createElement(Le.a,{path:"/"},o.a.createElement(ha,{username:this.state.username,stateManager:this.props.stateManager,updatedCommandList:this.state.updatedCommandList}))))))}}]),a}(n.Component);a(340);window.React=o.a,window.ReactDOM=r.a;var ga={settings:{showPopoutIcon:!1},content:[{type:"row",content:[{title:"Live Viewer",type:"react-component",component:"MainPane",props:{stateManager:Me}},{type:"column",content:[{type:"stack",content:[{title:"Voxel World",type:"react-component",component:"VoxelWorld",props:{stateManager:Me}},{title:"Memory 2D",type:"react-component",component:"Memory2D",props:{stateManager:Me}},{title:"Memory List",type:"react-component",component:"MemoryList",props:{stateManager:Me}},{title:"Console",type:"react-component",component:"Console"},{title:"Chat History",type:"react-component",component:"History",props:{stateManager:Me}},{title:"Query the Semantic Parser",type:"react-component",component:"QuerySemanticParser",props:{stateManager:Me}},{title:"Program the assistant",type:"react-component",component:"TeachApp",props:{stateManager:Me}}]},{type:"stack",content:[{title:"Settings",type:"react-component",component:"Settings",props:{stateManager:Me}},{title:"Navigator",type:"react-component",component:"Navigator",props:{stateManager:Me}},{title:"Object Annotation Fixer",type:"react-component",component:"ObjectFixup",props:{stateManager:Me}}]}]}]}]},va=new l.a(ga);va.registerComponent("MainPane",W),va.registerComponent("Console",X),va.registerComponent("Settings",$),va.registerComponent("Navigator",Re),va.registerComponent("Memory2D",ae),va.registerComponent("MemoryList",xe),va.registerComponent("QuerySemanticParser",Ie),va.registerComponent("History",Ce),va.registerComponent("TeachApp",fa),va.registerComponent("VoxelWorld",je),va.registerComponent("ObjectFixup",S),va.registerComponent("MemoryDetail",ye),va.init(),Me.dashboardLayout=va}},[[216,152,153]]]);