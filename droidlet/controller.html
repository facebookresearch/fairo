<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controller &mdash; fairo master documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Memory" href="memory.html" />
    <link rel="prev" title="droidlet" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> fairo
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dialogue-manager">Dialogue Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#droidlet.dialog.dialogue_manager.DialogueManager"><code class="docutils literal notranslate"><span class="pre">DialogueManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#droidlet.dialog.dialogue_manager.DialogueManager.step"><code class="docutils literal notranslate"><span class="pre">DialogueManager.step()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#semantic-parser">Semantic Parser</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#droidlet.perception.semantic_parsing.nsp_transformer_model.query_model.NSPBertModel"><code class="docutils literal notranslate"><span class="pre">NSPBertModel</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dialogue-task">Dialogue Task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#droidlet.dialog.dialogue_task.Say"><code class="docutils literal notranslate"><span class="pre">Say</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#droidlet.dialog.dialogue_task.AwaitResponse"><code class="docutils literal notranslate"><span class="pre">AwaitResponse</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#droidlet.dialog.dialogue_task.BotCapabilities"><code class="docutils literal notranslate"><span class="pre">BotCapabilities</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#droidlet.dialog.dialogue_task.ConfirmTask"><code class="docutils literal notranslate"><span class="pre">ConfirmTask</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#interpreter">Interpreter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#droidlet.interpreter.interpreter.Interpreter"><code class="docutils literal notranslate"><span class="pre">Interpreter</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="memory.html#database">Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory"><code class="docutils literal notranslate"><span class="pre">AgentMemory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory._db_read"><code class="docutils literal notranslate"><span class="pre">AgentMemory._db_read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.basic_search"><code class="docutils literal notranslate"><span class="pre">AgentMemory.basic_search()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.forget"><code class="docutils literal notranslate"><span class="pre">AgentMemory.forget()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.get_last_finished_root_task"><code class="docutils literal notranslate"><span class="pre">AgentMemory.get_last_finished_root_task()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.get_mem_by_id"><code class="docutils literal notranslate"><span class="pre">AgentMemory.get_mem_by_id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.get_recent_entities"><code class="docutils literal notranslate"><span class="pre">AgentMemory.get_recent_entities()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.get_time"><code class="docutils literal notranslate"><span class="pre">AgentMemory.get_time()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.get_world_time"><code class="docutils literal notranslate"><span class="pre">AgentMemory.get_world_time()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_clear"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_clear()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_find_lowest_instance"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_find_lowest_instance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_pause"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_pause()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_peek"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_peek()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_pop"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_pop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_push"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_push()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_resume"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_resume()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="memory.html#droidlet.memory.sql_memory.AgentMemory.task_stack_update_task"><code class="docutils literal notranslate"><span class="pre">AgentMemory.task_stack_update_task()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="memory.html#memorynodes">MemoryNodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.MemoryNode"><code class="docutils literal notranslate"><span class="pre">MemoryNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.ProgramNode"><code class="docutils literal notranslate"><span class="pre">ProgramNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.NamedAbstractionNode"><code class="docutils literal notranslate"><span class="pre">NamedAbstractionNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.ReferenceObjectNode"><code class="docutils literal notranslate"><span class="pre">ReferenceObjectNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.PlayerNode"><code class="docutils literal notranslate"><span class="pre">PlayerNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.SelfNode"><code class="docutils literal notranslate"><span class="pre">SelfNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.LocationNode"><code class="docutils literal notranslate"><span class="pre">LocationNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.AttentionNode"><code class="docutils literal notranslate"><span class="pre">AttentionNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.TimeNode"><code class="docutils literal notranslate"><span class="pre">TimeNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.ChatNode"><code class="docutils literal notranslate"><span class="pre">ChatNode</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#droidlet.memory.memory_nodes.TaskNode"><code class="docutils literal notranslate"><span class="pre">TaskNode</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="perception.html">Perception</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tasks.html#droidlet.task.task.Task"><code class="docutils literal notranslate"><span class="pre">Task</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="tasks.html#droidlet.task.task.Task.check_finished"><code class="docutils literal notranslate"><span class="pre">Task.check_finished()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="tasks.html#droidlet.task.task.Task.interrupt"><code class="docutils literal notranslate"><span class="pre">Task.interrupt()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="tasks.html#droidlet.task.task.Task.step"><code class="docutils literal notranslate"><span class="pre">Task.step()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="droidlet_agents.html">Agents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="droidlet_agents.html#locobot">Locobot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="droidlet_agents.html#locobot-perception">Locobot Perception</a><ul>
<li class="toctree-l4"><a class="reference internal" href="droidlet_agents.html#pipelines">Pipelines</a></li>
<li class="toctree-l4"><a class="reference internal" href="droidlet_agents.html#components">Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="droidlet_agents.html#data-structures">Data Structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="droidlet_agents.html#locobot-pyrobot-interface">Locobot PyRobot interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="droidlet_agents.html#craftassist">Craftassist</a><ul>
<li class="toctree-l3"><a class="reference internal" href="droidlet_agents.html#craftassist-perception">Craftassist Perception</a><ul>
<li class="toctree-l4"><a class="reference internal" href="droidlet_agents.html#droidlet.perception.craftassist.low_level_perception.LowLevelMCPerception"><code class="docutils literal notranslate"><span class="pre">LowLevelMCPerception</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="droidlet_agents.html#droidlet.perception.craftassist.heuristic_perception.PerceptionWrapper"><code class="docutils literal notranslate"><span class="pre">PerceptionWrapper</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="droidlet_agents.html#droidlet.perception.craftassist.voxel_models.subcomponent_classifier.SubcomponentClassifierWrapper"><code class="docutils literal notranslate"><span class="pre">SubcomponentClassifierWrapper</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">fairo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Controller</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/controller.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="controller">
<span id="controller-label"></span><h1>Controller<a class="headerlink" href="#controller" title="Permalink to this heading"></a></h1>
<p>In the “abstract” droidlet agent, the controller chooses whether to put Tasks on the Task Stack based on the memory state.   In the locobot agent and the craftassist agent subclasses, it consists of</p>
<ul class="simple">
<li><p>a <a class="reference external" href="https://github.com/facebookresearch/fairo/tree/main/droidlet/documents/logical_form_specification">DSL</a></p></li>
<li><p>a neural semantic parser, which translates natural language into partially specified programs over the DSL</p></li>
<li><p>a Dialogue Manager, Dialogue Stack, and Dialogue objects.</p></li>
<li><p>the Intepreter, a special Dialogue Object that takes partially specified programs from the DSL and fully specifies them using the Memory</p></li>
<li><p>a set of “default behaviors”, run randomly when the Task Stack and Dialogue Stack are empty</p></li>
</ul>
<p>Dialogue Objects behave similarly to <a class="reference internal" href="tasks.html#tasks-label"><span class="std std-ref">Tasks</span></a> , except they only affect the agent’s environment directly by causing the agent to issue utterances (or indirectly by pushing Task Objects onto the Task Stack).  In particular, each Dialogue Object has a .step() that is run when it is the highest priority object on the Stack. Dialogue Objects, like Task Objects are modular:  a learned model or a heuristic can mediate the Dialogue Object, and the same model or heuristic script can be used across many different agents.</p>
<p>The Dialogue Manager puts Dialogue Objects on the Dialogue Stack, either on its own, or at the request of a Dialogue Object.  In the locobot and craftassist agent, the manager is powered by a <a class="reference external" href="https://github.com/facebookresearch/fairo/tree/main/droidlet/perception/semantic_parsing/nsp_transformer_model">neural semantic parser</a>.</p>
<p>A sketch of the controller’s operation is then</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">new</span> <span class="n">utterance</span> <span class="kn">from</span> <span class="nn">human</span><span class="p">:</span>
     <span class="n">logical_form</span> <span class="o">=</span> <span class="n">semantic_parser</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">new</span> <span class="n">command</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">the</span> <span class="n">logical_form</span> <span class="n">denotes</span> <span class="n">a</span> <span class="n">command</span><span class="p">:</span>
         <span class="n">push</span> <span class="n">Interpreter</span><span class="p">(</span><span class="n">logical_form</span><span class="p">,</span> <span class="n">agent_memory</span><span class="p">)</span> <span class="n">onto</span> <span class="n">the</span> <span class="n">DialogueStack</span>
     <span class="k">else</span> <span class="k">if</span> <span class="n">the</span> <span class="n">logical_form</span> <span class="n">denotes</span> <span class="n">some</span> <span class="n">other</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">dialogue</span> <span class="n">the</span> <span class="n">agent</span> <span class="n">can</span> <span class="n">handle</span><span class="p">:</span>
         <span class="n">push</span> <span class="n">some</span> <span class="n">other</span> <span class="n">appropriate</span> <span class="n">DialogueObject</span> <span class="n">on</span> <span class="n">the</span> <span class="n">DialogueStack</span>
<span class="k">if</span> <span class="n">the</span> <span class="n">Dialogue</span> <span class="n">Stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
     <span class="n">step</span> <span class="n">the</span> <span class="n">highest</span> <span class="n">priority</span> <span class="n">DialogueObject</span>
<span class="k">if</span> <span class="n">TaskStack</span> <span class="ow">is</span> <span class="n">empty</span><span class="p">:</span>
     <span class="n">maybe</span> <span class="n">place</span> <span class="n">default</span> <span class="n">behaviors</span> <span class="n">on</span> <span class="n">the</span> <span class="n">stack</span>
</pre></div>
</div>
<div class="section" id="dialogue-manager">
<h2>Dialogue Manager<a class="headerlink" href="#dialogue-manager" title="Permalink to this heading"></a></h2>
<p>The Dialogue Manager operates the logical forms and places dialogue tasks in the agent’s memory.</p>
<blockquote>
<div><dl class="py class">
<dt class="sig sig-object py" id="droidlet.dialog.dialogue_manager.DialogueManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.dialog.dialogue_manager.</span></span><span class="sig-name descname"><span class="pre">DialogueManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">memory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialogue_object_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low_level_interpreter_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/dialog/dialogue_manager.html#DialogueManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.dialog.dialogue_manager.DialogueManager" title="Permalink to this definition"></a></dt>
<dd><div class="line-block">
<div class="line">The current control flow of dialogue is:</div>
<div class="line">1.  A chat comes in and Dialogue manager reads it or the bot triggers a</div>
<div class="line-block">
<div class="line">dialogue because of memory/perception/task state</div>
</div>
<div class="line">2.  The dialogue manage launches an Interpreter or places a dialogue Task on the Task queue.</div>
<div class="line">3.  the agent calls the Interpreters.step() (if there is an Interpreter one) in its</div>
<div class="line-block">
<div class="line">controller_step()</div>
<div class="line"><br /></div>
</div>
<div class="line">This object is likely to be deprecated by nov 2021</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>agent</strong> – a droidlet agent</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="droidlet.dialog.dialogue_manager.DialogueManager.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/dialog/dialogue_manager.html#DialogueManager.step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.dialog.dialogue_manager.DialogueManager.step" title="Permalink to this definition"></a></dt>
<dd><p>Process a chat and step through the dialogue manager task stack.</p>
<p>The chat is given as input to the model, which returns a logical form.
The logical form is fed to an interpreter to
handle the action.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>chat</strong> (<em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>]</em>) – Tuple of (speaker, chat). Speaker is name of speaker.
Chat is an incoming chat command that the agent has received.
Example: (“player_1”, “build a red cube”)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
<div class="section" id="semantic-parser">
<h3>Semantic Parser<a class="headerlink" href="#semantic-parser" title="Permalink to this heading"></a></h3>
<p>The training of the semantic parsing model is described in detail <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/perception/semantic_parsing/nsp_transformer_model/train_model.py">here</a> and the model architecture has been described <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/perception/semantic_parsing/nsp_transformer_model/encoder_decoder.py">here</a> and <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/perception/semantic_parsing/nsp_transformer_model/decoder_with_loss.py">here</a>.
; the interface is</p>
<blockquote>
<div><dl class="py class">
<dt class="sig sig-object py" id="droidlet.perception.semantic_parsing.nsp_transformer_model.query_model.NSPBertModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.perception.semantic_parsing.nsp_transformer_model.query_model.</span></span><span class="sig-name descname"><span class="pre">NSPBertModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'caip_test_model'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/perception/semantic_parsing/nsp_transformer_model/query_model.html#NSPBertModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.perception.semantic_parsing.nsp_transformer_model.query_model.NSPBertModel" title="Permalink to this definition"></a></dt>
<dd><p>NSPBertModel model class that loads a pretrained model and runs inference in the agent.
:ivar tokenizer: Pretrained tokenizer used to tokenize input. Runs end-to-end</p>
<blockquote>
<div><p>tokenization, eg. split punctuation, BPE.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<em>CAIPDataset</em>) – CAIP (CraftAssist Instruction Parsing) Dataset. Note that
this is empty during inference.</p></li>
<li><p><strong>encoder_decoder</strong> (<em>EncoderDecoderWithLoss</em>) – Transformer model class. See</p></li>
</ul>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>model_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Path to directory containing all files necessary to
load and run the model, including args, tree mappings and the checkpointed model.
Semantic parsing models used by current project are in <code class="docutils literal notranslate"><span class="pre">ttad_bert_updated</span></code>.
eg. semantic parsing model is <code class="docutils literal notranslate"><span class="pre">ttad_bert_updated/caip_test_model.pth</span></code></p></li>
<li><p><strong>data_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Path to directory containing all datasets used by the NSP model.
Note that this data is not used in inference, rather we load from the ground truth
data directory.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="droidlet.perception.semantic_parsing.nsp_transformer_model.query_model.NSPBertModel.parse">
<span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noop_thres</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">well_formed_pen</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/perception/semantic_parsing/nsp_transformer_model/query_model.html#NSPBertModel.parse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.perception.semantic_parsing.nsp_transformer_model.query_model.NSPBertModel.parse" title="Permalink to this definition"></a></dt>
<dd><p>Given an incoming chat, query the parser and return a logical form.
Uses beam search decoding, see <cite>beam_search</cite>
:param chat: Preprocessed chat command from a player. Used as text input to parser.
:type chat: str</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Logical form.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
</div>
<div class="section" id="dialogue-task">
<h2>Dialogue Task<a class="headerlink" href="#dialogue-task" title="Permalink to this heading"></a></h2>
<p>The generic Dialogue Task is a Task</p>
<p><a class="reference internal" href="tasks.html#tasks-label"><span class="std std-ref">Tasks</span></a></p>
<p>A Task’s main method is .step(),
Some other dialogue tasks:</p>
<blockquote>
<div><dl class="py class">
<dt class="sig sig-object py" id="droidlet.dialog.dialogue_task.Say">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.dialog.dialogue_task.</span></span><span class="sig-name descname"><span class="pre">Say</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">agent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/dialog/dialogue_task.html#Say"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.dialog.dialogue_task.Say" title="Permalink to this definition"></a></dt>
<dd><p>This Task to says / sends a chat
to the user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>response_options</strong> – a list of responses to pick the final response from</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="droidlet.dialog.dialogue_task.AwaitResponse">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.dialog.dialogue_task.</span></span><span class="sig-name descname"><span class="pre">AwaitResponse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">agent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/dialog/dialogue_task.html#AwaitResponse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.dialog.dialogue_task.AwaitResponse" title="Permalink to this definition"></a></dt>
<dd><p>This Task awaits a response from the user.  it is blocking</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>agent</strong> – the droidlet agent that runs the task, needs a .send_chat() method</p></li>
<li><p><strong>init_time</strong> – initial time</p></li>
<li><p><strong>wait_time</strong> – how long should we await the response</p></li>
<li><p><strong>awaiting_response</strong> – a flag to mark where we are awaiting the response</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="droidlet.dialog.dialogue_task.BotCapabilities">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.dialog.dialogue_task.</span></span><span class="sig-name descname"><span class="pre">BotCapabilities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">agent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/dialog/dialogue_task.html#BotCapabilities"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.dialog.dialogue_task.BotCapabilities" title="Permalink to this definition"></a></dt>
<dd><p>This class represents a sub-type of the Say Task to answer
something about the current capabilities of the bot, to the user.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="droidlet.dialog.dialogue_task.ConfirmTask">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.dialog.dialogue_task.</span></span><span class="sig-name descname"><span class="pre">ConfirmTask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">agent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/dialog/dialogue_task.html#ConfirmTask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.dialog.dialogue_task.ConfirmTask" title="Permalink to this definition"></a></dt>
<dd><p>Confirm that a Task should be executed</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>question</strong> – the question to ask the user</p></li>
<li><p><strong>tasks</strong> – list of task objects</p></li>
<li><p><strong>asked</strong> – flag to denote whether the clarification has been asked for</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div></blockquote>
<div class="section" id="interpreter">
<h3>Interpreter<a class="headerlink" href="#interpreter" title="Permalink to this heading"></a></h3>
<p>The <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/interpreter/interpreter.py">Interpreter</a> is responsible for using the world state (via <a class="reference internal" href="memory.html"><span class="doc">memory</span></a>) and a natural language utterance that has been parsed into a logical form over the agent’s DSL from the semantic parser to choose a <a class="reference internal" href="memory.html"><span class="doc">Task</span></a> to put on the Task Stack.   The <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/interpreter/robot/loco_interpreter.py">robot</a> and <a class="reference external" href="https://github.com/fairinternal/minecraft/blob/master/craftassist/agent/dialogue_objects/mc_intepreter.py">craftassist</a> Interpreters are not the same, but the bulk of the work is done by the shared subinterpreters (in the files *_helper.py) <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/dialog/dialogue_objects/">here</a>.  The subinterpreters, registered in the main Interpreter <a class="reference external" href="https://github.com/facebookresearch/fairo/blob/main/droidlet/dialog/dialogue_objects/intepreter.py#L55">here</a> (and for the specialized versions <a class="reference external" href="https://github.com/fairinternal/minecraft/blob/master/locobot/agent/dialogue_objects/loco_intepreter.py#L56">here</a> and <a class="reference external" href="https://github.com/fairinternal/minecraft/blob/master/craftassist/agent/dialogue_objects/mc_intepreter.py#L61">here</a>), roughly follow the structure of the DSL.  This arrangement is to allow replacing the (currently heuristic) subinterpreters with learned versions or specializing them to new agents.</p>
<blockquote>
<div><dl class="py class">
<dt class="sig sig-object py" id="droidlet.interpreter.interpreter.Interpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">droidlet.interpreter.interpreter.</span></span><span class="sig-name descname"><span class="pre">Interpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">speaker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logical_form_memid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agent_memory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/droidlet/interpreter/interpreter.html#Interpreter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#droidlet.interpreter.interpreter.Interpreter" title="Permalink to this definition"></a></dt>
<dd><div class="line-block">
<div class="line">This class takes a logical form from the semantic parser that specifies a</div>
<div class="line">(world affecting) action for the agent</div>
<div class="line">and the world state (from the agent’s memory),</div>
<div class="line">and uses these to intialize tasks to run</div>
<div class="line">Most of the logic of the interpreter is run in the subinterpreters and task handlers.</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>speaker</strong> – The name of the player/human/agent who uttered the chat resulting in this interpreter</p></li>
<li><p><strong>logical_form_memid</strong> – pointer to the parse to be interpreted</p></li>
<li><p><strong>agent_memory</strong> – memory of the agent that will interpret the parse</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div></blockquote>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="droidlet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="memory.html" class="btn btn-neutral float-right" title="Memory" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Facebook AI.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>