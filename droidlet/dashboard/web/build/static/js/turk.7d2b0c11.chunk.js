(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[158],{100:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=a(53),h=(a(94),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"jsonToResultsTable",value:function(e){var t=e.name,a=e[{perceive:"chat",interpreter:"tasks_to_push",dialogue:"object",memory:"operation"}[t]],n=e.start_time;return n=n.substring(n.indexOf(" ")),l.a.createElement("table",{className:"fixed"},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,n),l.a.createElement("td",null,t),l.a.createElement("td",null,a))))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"subpanel"},l.a.createElement("table",{className:"fixed"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Timestamp"),l.a.createElement("th",null,"Event Type"),l.a.createElement("th",null,"Event Summary")))),l.a.createElement("hr",null),this.props.stateManager.memory.timelineSearchResults&&this.props.stateManager.memory.timelineSearchResults.map((function(t,a){return l.a.createElement("div",{className:"result",key:a,onClick:function(){return Object(c.b)(e.props.stateManager,JSON.stringify(t))}},e.jsonToResultsTable(t),l.a.createElement("hr",null))})))}}]),a}(l.a.Component));t.a=h},101:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=(a(94),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"renderTable",value:function(e){if(e)return e.map((function(e,t){var a=e.event,n=e.description;return l.a.createElement("tr",{key:t},l.a.createElement("td",null,l.a.createElement("strong",null,a)),l.a.createElement("td",null,n))}))}},{key:"render",value:function(){return l.a.createElement("div",{className:"subpanel"},l.a.createElement("table",null,l.a.createElement("tbody",null,this.renderTable(this.props.stateManager.memory.timelineDetails))))}}]),a}(l.a.Component));t.a=c},102:function(e,t,a){"use strict";a.d(t,"b",(function(){return R}));var n=a(20),i=a(3),s=a(4),o=a(6),r=a(5),l=a(0),c=a.n(l),h=a(128),u=a(53),d=a(167);function m(e,t){var a=[];if(t){e.memory.timelineSearchPattern=t;var n=new d.a(e.memory.timelineEventHistory,{ignoreLocation:!0,useExtendedSearch:!0}).search("'"+t);n.length&&n.forEach((function(t){var n=t.item,i=JSON.parse(n);e.memory.timelineFilters.includes(Object(u.a)(i.name))&&a.push(i)}))}e.memory.timelineSearchResults=a,e.updateTimelineResults()}var p=a(14),g=a(733),f=a(716),b=a(749),v=a(734),y=a(718),k=a(288),E=a(741),M=a(743),w=Object(g.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120,maxWidth:300}}})),_={PaperProps:{style:{maxHeight:224,width:250}}};function S(e){var t=e.stateManager,a=w(),n=R,i=c.a.useState(n),s=Object(p.a)(i,2),o=s[0],r=s[1];return c.a.createElement("div",null,c.a.createElement(y.a,{className:a.formControl},c.a.createElement(b.a,{id:"multiple-checkbox-label"},"Filters"),c.a.createElement(E.a,{labelId:"multiple-checkbox-label",id:"multiple-checkbox",multiple:!0,value:o,onChange:function(e){r(e.target.value),t.memory.timelineFilters=e.target.value,t.updateTimeline(),m(t,t.memory.timelineSearchPattern)},input:c.a.createElement(f.a,null),renderValue:function(e){return e.join(", ")},MenuProps:_},n.map((function(e){return c.a.createElement(v.a,{key:e,value:e},c.a.createElement(M.a,{checked:o.indexOf(e)>-1}),c.a.createElement(k.a,{primary:e}))})))))}var j=a(139),C=a.n(j),x=a(377),O=a(724),I=(a(94),Object(x.a)({palette:{type:"dark"}})),T=new h.a,R=["Perceive","Dialogue","Interpreter","Memory"],P=[{id:"Timeline",content:"Timeline",nestedGroups:R},{id:"Perceive",content:"Perception"},{id:"Dialogue",content:"Dialogue"},{id:"Interpreter",content:"Interpreter"},{id:"Memory",content:"Memory"}],D={tooltip:{followMouse:!0,overflowMethod:"cap",template:function(e,t){var a=JSON.parse(e.title);return"<pre>event: "+a.name+"\nagent time: "+a.agent_time+"</pre>"}},zoomMax:864e5,rollingMode:{follow:!0}},A=function(e){var t=e.onChange,a=e.placeholder;return c.a.createElement("div",{className:"search"},c.a.createElement("input",{className:"searchInput",type:"text",onChange:t,placeholder:a}),c.a.createElement("span",{className:"searchSpan"},c.a.createElement(C.a,null)))},N=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(){var e;return Object(i.a)(this,a),(e=t.call(this)).timeline={},e.appRef=Object(l.createRef)(),e.prevEvent="",e.searchPattern="",e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),this.searchFilters=Object(n.a)(this.props.stateManager.memory.timelineFilters),this.timeline=new h.b(this.appRef.current,T,P,D);var e=this.timeline.getCurrentTime(),t=this.timeline.getCurrentTime();e=e.setSeconds(e.getSeconds()-10),t=t.setSeconds(t.getSeconds()+10),this.timeline.setOptions({start:e,end:t});var a=this;this.timeline.on("click",(function(e){if(e.item){var t=T.get(e.item);Object(u.b)(a.props.stateManager,t.title)}}))}},{key:"renderEvent",value:function(){var e=this.props.stateManager.memory.timelineEvent;if(e&&e!==this.prevEvent){this.prevEvent=e;var t=JSON.parse(e),a="";"perceive"===t.name&&(a=' ("'+t.chat+'")'),T.add([{title:JSON.stringify(t,null,2),content:t.name+a,group:"Timeline",className:t.name,start:t.start_time,end:t.end_time,type:"box"}]),T.add([{title:JSON.stringify(t,null,2),group:Object(u.a)(t.name),className:t.name,start:t.start_time,end:t.end_time,type:"box"}])}}},{key:"toggleVisibility",value:function(){var e=this.props.stateManager.memory.timelineFilters;if(e&&e!==this.searchFilters){this.searchFilters=Object(n.a)(e);for(var t=T.get(),a=0;a<t.length;a++)e.includes(Object(u.a)(t[a].className))?t[a].style="opacity: 1;":t[a].style="opacity: 0.2;";T.update(t)}}},{key:"render",value:function(){var e=this;return this.renderEvent(),this.toggleVisibility(),c.a.createElement("div",{className:"timeline"},c.a.createElement("p",{id:"description"},"A visualizer for viewing, inspecting, and searching through agent activities interactively.",c.a.createElement("br",null),"Click an event to view more details!"),c.a.createElement(A,{placeholder:"Search",onChange:function(t){return m(e.props.stateManager,t.target.value)}}),c.a.createElement("div",{id:"dropdown"},c.a.createElement(O.a,{theme:I},c.a.createElement(S,{stateManager:this.props.stateManager}))),c.a.createElement("div",{className:"clearfloat"}),c.a.createElement("div",{ref:this.appRef}))}}]),a}(c.a.Component);t.a=N},104:function(e,t,a){"use strict";var n=a(14),i=a(3),s=a(4),o=a(6),r=a(5),l=a(0),c=a.n(l),h=a(47),u=a(42);function d(e){return null===e.value||void 0===e.value?null:c.a.createElement(c.a.Fragment,null,c.a.createElement(h.a,{item:!0,xs:4,s:4},c.a.createElement(u.a,{variant:"button",align:"right"},e.title)),c.a.createElement(h.a,{item:!0,xs:8,s:8},c.a.createElement(u.a,{variant:"body1",align:"left"},e.value)))}var m=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=(0,Object(n.a)(this.props.memoryManager,3)[2])(this.props.uuid);return c.a.createElement(h.a,{container:!0,spacing:2,style:{padding:"16px"}},c.a.createElement(h.a,{item:!0,xs:11},c.a.createElement(u.a,{variant:"h4",align:"left"},"Attributes")),c.a.createElement(d,{title:"UUID",value:e.data[0]}),c.a.createElement(d,{title:"ID",value:e.data[1]}),c.a.createElement(d,{title:"X",value:e.data[2]}),c.a.createElement(d,{title:"Y",value:e.data[3]}),c.a.createElement(d,{title:"Z",value:e.data[4]}),c.a.createElement(d,{title:"Yaw",value:e.data[5]}),c.a.createElement(d,{title:"Pitch",value:e.data[6]}),c.a.createElement(d,{title:"Type",value:e.data[9]}),c.a.createElement(d,{title:"Name",value:e.data[7]}),c.a.createElement(h.a,{item:!0,xs:12},c.a.createElement(u.a,{variant:"h4",align:"left"},"Triples")),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"button",align:"left"},"Predicate")),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"button",align:"left"},"Value")),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"button",align:"left"},"Confidence")),e.triples.map((function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"body2",align:"left"},e[4])),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"body2",align:"left"},e[6])),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"body2",align:"left"},e[7])))})))}}]),a}(c.a.Component);t.a=m},105:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(2),o=a(6),r=a(5),l=a(0),c=a.n(l),h=(a(82),a(39)),u=(a(112),{width:600,margin:50}),d={minWidth:"60px",display:"inline-block"},m=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialState={learningRate:.005,trainSplit:.7,maxIters:100,modelMetrics:null},i.onAnnotationSave=i.onAnnotationSave.bind(Object(s.a)(i)),i.onRetrain=i.onRetrain.bind(Object(s.a)(i)),i.onModelSwitch=i.onModelSwitch.bind(Object(s.a)(i)),i.onLearningRateChange=i.onLearningRateChange.bind(Object(s.a)(i)),i.onTrainSplitChange=i.onTrainSplitChange.bind(Object(s.a)(i)),i.onMaxItersChange=i.onMaxItersChange.bind(Object(s.a)(i)),i.state=i.initialState,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"onAnnotationSave",value:function(){this.props.stateManager&&this.props.stateManager.saveAnnotations()}},{key:"onRetrain",value:function(){if(this.props.stateManager){console.log("retraining detector...");var e=this.state,t=e.learningRate,a=e.trainSplit,n=e.maxIters;this.props.stateManager.socket.emit("retrain_detector",{learningRate:t,trainSplit:a,maxIters:n})}}},{key:"onModelSwitch",value:function(){this.props.stateManager&&(console.log("switching model..."),this.props.stateManager.socket.emit("switch_detector"))}},{key:"onLearningRateChange",value:function(e){this.setState({learningRate:e})}},{key:"onTrainSplitChange",value:function(e){this.setState({trainSplit:e})}},{key:"onMaxItersChange",value:function(e){this.setState({maxIters:e})}},{key:"render",value:function(){var e=null;if(this.state.modelMetrics){var t=this.state.modelMetrics.segm,a=Object.keys(t).map((function(e){return c.a.createElement("div",null,e+": "+t[e])}));e=c.a.createElement("div",null,c.a.createElement("div",null,"New model trained!"),"Evalution: ",a)}return c.a.createElement("div",null,c.a.createElement("div",{style:u},c.a.createElement("label",{style:d},"Learning Rate: \xa0"),c.a.createElement("span",null,this.state.learningRate),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.learningRate,min:0,max:1,step:.005,onChange:this.onLearningRateChange})),c.a.createElement("div",{style:u},c.a.createElement("label",{style:d},"Train split: \xa0"),c.a.createElement("span",null,this.state.trainSplit),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.trainSplit,min:0,max:1,step:.05,onChange:this.onTrainSplitChange})),c.a.createElement("div",{style:u},c.a.createElement("label",{style:d},"Max iterations: \xa0"),c.a.createElement("span",null,this.state.maxIters),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.maxIters,min:50,max:1e3,step:50,onChange:this.onMaxItersChange})),c.a.createElement("button",{onClick:this.onAnnotationSave},"Save Annotations"),c.a.createElement("button",{onClick:this.onRetrain},"Retrain"),c.a.createElement("button",{onClick:this.onModelSwitch},"Switch"),e)}}]),a}(c.a.Component);t.a=m},106:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(2),o=a(6),r=a(5),l=a(0),c=a.n(l),h=a(9),u=(a(82),a(39)),d=(a(112),{width:600,margin:50}),m={minWidth:"60px",display:"inline-block"},p=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).keyboardToggle=function(){1==i.keyCheckRef.current.checked?i.addKeyListener():i.removeKeyListener(),i.setState({keyboard_enabled:i.keyCheckRef.current.checked})},i.initialState={move:.3,yaw:.01,velocity:.1,data_logging_time:30,keyboard_enabled:!1},i.state=i.initialState,i.handleSubmit=i.handleSubmit.bind(Object(s.a)(i)),i.onYawChange=i.onYawChange.bind(Object(s.a)(i)),i.onDataLoggingTimeChange=i.onDataLoggingTimeChange.bind(Object(s.a)(i)),i.onMoveChange=i.onMoveChange.bind(Object(s.a)(i)),i.onVelocityChange=i.onVelocityChange.bind(Object(s.a)(i)),i.navRef=c.a.createRef(),i.keyCheckRef=c.a.createRef(),i.handleClick=i.handleClick.bind(Object(s.a)(i)),i.logData=i.logData.bind(Object(s.a)(i)),i.stopRobot=i.stopRobot.bind(Object(s.a)(i)),i.unstopRobot=i.unstopRobot.bind(Object(s.a)(i)),i.keyboardToggle=i.keyboardToggle.bind(Object(s.a)(i)),i.addKeyListener=i.addKeyListener.bind(Object(s.a)(i)),i.removeKeyListener=i.removeKeyListener.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"handleSubmit",value:function(e){h.a.setUrl(this.state.url),e.preventDefault()}},{key:"logData",value:function(e){h.a.socket.emit("logData",this.state.data_logging_time),console.log("logData",this.state.data_logging_time)}},{key:"stopRobot",value:function(e){h.a.socket.emit("stopRobot"),console.log("Robot Stopped")}},{key:"unstopRobot",value:function(e){h.a.socket.emit("unstopRobot"),console.log("Robot UnStopped")}},{key:"addKeyListener",value:function(){var e={};this.onkey=function(t){e[t.keyCode]=!0},document.addEventListener("keyup",this.onkey);this.intervalHandle=setInterval(h.a.keyHandler,33.33,e)}},{key:"removeKeyListener",value:function(){document.removeEventListener("keyup",this.onkey),clearInterval(this.intervalHandle)}},{key:"componentDidMount",value:function(){h.a&&h.a.connect(this)}},{key:"onDataLoggingTimeChange",value:function(e){this.setState({data_logging_time:e})}},{key:"onYawChange",value:function(e){this.setState({yaw:e})}},{key:"onMoveChange",value:function(e){this.setState({move:e})}},{key:"onVelocityChange",value:function(e){this.setState({velocity:e})}},{key:"handleClick",value:function(e){var t=e.target.id;"key_up"===t?h.a.keyHandler({38:!0}):"key_down"===t?h.a.keyHandler({40:!0}):"key_left"===t?h.a.keyHandler({37:!0}):"key_right"===t?h.a.keyHandler({39:!0}):"pan_left"===t?h.a.keyHandler({49:!0}):"pan_right"===t?h.a.keyHandler({50:!0}):"tilt_up"===t?h.a.keyHandler({51:!0}):"tilt_down"===t&&h.a.keyHandler({52:!0})}},{key:"render",value:function(){return c.a.createElement("div",{ref:this.navRef},c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("div",null,c.a.createElement("label",null," Base "),c.a.createElement("button",{id:"key_up",onClick:this.handleClick},"Up")),c.a.createElement("div",null,c.a.createElement("button",{id:"key_left",onClick:this.handleClick},"Left"),c.a.createElement("button",{id:"key_down",onClick:this.handleClick},"Down"),c.a.createElement("button",{id:"key_right",onClick:this.handleClick},"Right")),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("div",null,c.a.createElement("label",null," Camera "),c.a.createElement("button",{id:"tilt_up",onClick:this.handleClick},"Up")),c.a.createElement("div",null,c.a.createElement("button",{id:"pan_left",onClick:this.handleClick},"Left"),c.a.createElement("button",{id:"tilt_down",onClick:this.handleClick},"Down"),c.a.createElement("button",{id:"pan_right",onClick:this.handleClick},"Right")),c.a.createElement("br",null),c.a.createElement("input",{type:"checkbox",defaultChecked:this.state.keyboard_enabled,ref:this.keyCheckRef,onChange:this.keyboardToggle}),c.a.createElement("label",null," ","Enable Keyboard control (Use the arrow keys to move the robot, keys"," ",2," and ",4," to move camera)"," "),c.a.createElement("div",{style:d},c.a.createElement("label",{style:m},"Rotation (radians): \xa0"),c.a.createElement("span",null,this.state.yaw),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(u.a,{value:this.state.yaw,min:0,max:6.28,step:.01,onChange:this.onYawChange}),c.a.createElement("br",null),c.a.createElement("label",{style:m},"Move Distance (metres): \xa0"),c.a.createElement("span",null,this.state.move),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(u.a,{value:this.state.move,min:0,max:10,step:.1,onChange:this.onMoveChange})),c.a.createElement("div",{style:d},c.a.createElement("label",{style:m},"Velocity: \xa0"),c.a.createElement("span",null,this.state.velocity),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(u.a,{value:this.state.velocity,min:0,max:1,step:.05,onChange:this.onVelocityChange})),c.a.createElement("div",null,c.a.createElement("div",{style:d},c.a.createElement("label",{style:m},"Data Logging Time (seconds): \xa0"),c.a.createElement("span",null,this.state.data_logging_time),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(u.a,{value:this.state.data_logging_time,min:0,max:300,step:1,onChange:this.onDataLoggingTimeChange})),c.a.createElement("button",{id:"log_data",onClick:this.logData},"Log Data")))}}]),a}(c.a.Component);t.a=p},107:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=a(737),h=a(738),u=a(740),d=(a(196),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state=e.state,i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement(h.a,{style:{overflowX:"scroll",overflowY:"scroll",width:"100%"},className:"Navbar fixed-bottom"},l.a.createElement(u.a,null,l.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("home")}},"Home"),l.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("navigation")}},"Navigation"),l.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("settings")}},"Settings"),l.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("annotation")}},"Annotation"),l.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("camera")}},"Camera")))}}]),a}(l.a.Component)),m=a(735),p=a(736),g=a(27),f=a(48),b=a(9),v=a(38),y=a(50),k=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(m.a,null,l.a.createElement(p.a,null,"Video Feed 1",l.a.createElement(g.a,{type:"rgb",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0})),l.a.createElement(p.a,null,"Memory 2d",l.a.createElement(y.a,{stateManager:b.a,isMobile:!0,dimensions:this.props.imageWidth}))),l.a.createElement(m.a,null,l.a.createElement(p.a,null,"Video Feed 2",l.a.createElement(g.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0})),l.a.createElement(p.a,null,"Video Feed 3",l.a.createElement(f.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0}))),l.a.createElement(m.a,null,l.a.createElement(v.a,{stateManager:b.a,isMobile:!0})))}}]),a}(l.a.Component),E=(a(197),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={commands:[]},i.intervalId=void 0,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.intervalId=setInterval(this.sendAndClearCommands.bind(this),33.33)}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"addCommand",value:function(e){var t=this.state.commands;t.push(e),this.setState({commands:t})}},{key:"sendAndClearCommands",value:function(){this.state&&(b.a.buttonHandler(this.state.commands),this.setState({commands:[]}))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"container"},l.a.createElement("button",{className:"directionButton left",onClick:function(){return e.addCommand("MOVE_LEFT")}},"Turn Left"),l.a.createElement("button",{className:"directionButton up",onClick:function(){return e.addCommand("MOVE_FORWARD")}},"Forward"),l.a.createElement("button",{className:"directionButton down",onClick:function(){return e.addCommand("MOVE_DOWN")}},"Backward"),l.a.createElement("button",{className:"directionButton right",onClick:function(){return e.addCommand("MOVE_RIGHT")}},"Turn Right"))}}]),a}(l.a.Component)),M=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(m.a,null,l.a.createElement(p.a,null,"Video Feed 1",l.a.createElement(g.a,{type:"rgb",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0})),l.a.createElement(p.a,null,"Memory 2d",l.a.createElement(y.a,{stateManager:b.a,isMobile:!0,dimensions:this.props.imageWidth}))),l.a.createElement(m.a,null,l.a.createElement(p.a,null,"Video Feed 2",l.a.createElement(g.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0})),l.a.createElement(p.a,null,"Video Feed 3",l.a.createElement(f.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0}))),l.a.createElement(E,null))}}]),a}(l.a.Component),w=a(64),_=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(m.a,null,l.a.createElement(p.a,null,"Video Feed 1",l.a.createElement(g.a,{type:"rgb",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0})),l.a.createElement(p.a,null,"Memory 2d",l.a.createElement(y.a,{stateManager:b.a,isMobile:!0,dimensions:this.props.imageWidth}))),l.a.createElement(m.a,null,l.a.createElement(p.a,null,"Video Feed 2",l.a.createElement(g.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0})),l.a.createElement(p.a,null,"Video Feed 3",l.a.createElement(f.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:b.a,isMobile:!0}))),l.a.createElement(w.a,{stateManager:b.a,isMobile:!0}))}}]),a}(l.a.Component),S=a(55),j=a(2),C=(a(198),a(199),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={selectedTags:e.tags||[],suggestions:[],currentValue:""},i.inputRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"tag-selector"},l.a.createElement("div",{className:"tag-holder"},this.state.selectedTags.map((function(t,a){return l.a.createElement("span",{className:"tag-selected",key:a},t,l.a.createElement("button",{onClick:function(){e.removeTag(t)}},"X"))}))),l.a.createElement("input",{type:"text",placeholder:"Tags (press Enter to add)",ref:this.inputRef,onChange:this.update.bind(this),onKeyDown:this.keyDown.bind(this)}),l.a.createElement("div",{className:"tag-suggestions"},this.state.suggestions.map((function(t,a){return l.a.createElement("span",{kkey:a},l.a.createElement("button",{onClick:function(){e.addTag(t)}},a))}))))}},{key:"update",value:function(e){var t=this,a=this.inputRef.current.value;0!==a.length?this.setState({suggestions:this.props.tags.filter((function(e){return e.toLowerCase().slice(0,a.length)===a&&-1===t.state.selectedTags.indexOf(e)}))}):this.setState({suggestions:[]})}},{key:"removeTag",value:function(e){var t=this;this.setState({selectedTags:this.state.selectedTags.filter((function(t){return t!==e}))},(function(){t.props.update(t.state.selectedTags)}))}},{key:"addTag",value:function(e){var t=this;e=e.toLowerCase(),this.setState({selectedTags:this.state.selectedTags.concat(e),suggestions:[]},(function(){t.props.update(t.state.selectedTags)})),this.inputRef.current.value=""}},{key:"keyDown",value:function(e){"Enter"===e.key&&""!==this.inputRef.current.value.trim()&&this.addTag(this.inputRef.current.value),this.setState({currentValue:this.inputRef.current.value})}}]),a}(l.a.Component)),x=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).tags=i.props.tags||[],i.submit=i.submit.bind(Object(j.a)(i)),i.nameRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"data-entry-root",style:{top:this.props.y+"px",left:this.props.x+"px"}},l.a.createElement("input",{placeholder:"Object Name",ref:this.nameRef,defaultValue:this.props.label||""}),l.a.createElement(C,{tags:this.tags,update:function(t){return e.tags=t}}),this.props.includeSubmitButton?l.a.createElement("button",{className:"data-entry-submit",onClick:this.submit},"Submit"):null,this.props.deleteCallback?l.a.createElement("button",{className:"data-entry-delete",onClick:this.props.deleteCallback},"Delete object (\u232b)"):null)}},{key:"submit",value:function(){var e=this.nameRef.current.value.trim();0!==e.length?this.tags.length<2?alert("Please enter at least 2 descriptive tags for the object separated by enter. Examples include: color, shape, size, orientation, etc."):this.props.onSubmit({name:e.toLowerCase(),tags:this.tags}):alert("You must enter the object's name")}}]),a}(l.a.Component),O=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onTouchEnd=function(e){i.isDrawing=!1,i.ctx.strokeStyle="red",i.ctx.lineJoin="round",i.ctx.linewidth=5,i.ctx.beginPath(),i.ctx.moveTo(i.currentMouse.x,i.currentMouse.y),i.ctx.lineTo(i.firstCoordinate.x,i.firstCoordinate.y),i.ctx.closePath(),i.ctx.stroke(),i.isDrawing=!1,i.pointList.push(i.firstCoordinate)},i.onTouchMove=function(e){if(i.isDrawing){var t=i.canvas,a=e.touches[0],n=(a.clientX-t.offsetLeft)/i.scale,s=(a.clientY-t.offsetTop)/i.scale;i.currentMouse?(i.prevMouse=i.currentMouse,i.currentMouse={x:n,y:s}):(i.currentMouse={x:n,y:s},i.firstCoordinate=i.currentMouse),i.pointList.push(i.currentMouse),i.prevMouse&&(i.ctx=i.canvas.getContext("2d"),i.ctx&&(i.ctx.strokeStyle="red",i.ctx.lineJoin="round",i.ctx.linewidth=5,i.ctx.beginPath(),i.ctx.moveTo(i.prevMouse.x,i.prevMouse.y),i.ctx.lineTo(i.currentMouse.x,i.currentMouse.y),i.ctx.closePath(),i.ctx.stroke()))}},i.canvasRef=l.a.createRef(),i.imgRef=l.a.createRef(),i.isDrawing=!1,i.annotationName="",i.annotationTags=[],i.pointList=[],i.isDrawing=!0,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.Offset={x:0,y:0},this.baseScale=this.canvas.width/this.props.img.width,this.scale=this.baseScale,this.canvas.height=this.props.img.height*this.baseScale,this.currentMouse=null,this.firstCoordinate=null,this.prevMouse=null,this.update()}},{key:"update",value:function(){this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.props.img,0,0)}},{key:"dataEntrySubmit",value:function(e){this.drawingData=e,this.annotationTags=this.drawingData.tags,this.annotationName=this.drawingData.name,this.props.setMode("select")}},{key:"clearMask",value:function(){this.pointList=[],this.update()}},{key:"render",value:function(){var e="500px";this.props.imageWidth&&(e=this.props.imageWidth);var t=this.canvas&&this.canvas.getBoundingClientRect().left,a=this.canvas&&this.canvas.getBoundingClientRect().bottom+50;return l.a.createElement("div",null,l.a.createElement("div",null," Outline image to annotate "),l.a.createElement("button",{onClick:this.clearMask.bind(this)},"Clear Mask"),l.a.createElement("canvas",{style:{touchAction:"none"},ref:this.canvasRef,width:e,height:e,tabIndex:"0",onTouchMove:this.onTouchMove,onTouchEnd:this.onTouchEnd,onMouseUp:this.mouseEvent}),l.a.createElement(x,{x:t,y:a,onSubmit:this.dataEntrySubmit.bind(this),includeSubmitButton:!0,isMobile:this.props.isMobile}))}}]),a}(l.a.Component),I=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={currentMode:"select"},i.image=i.props.image,i.stateManager=i.props.stateManager,i}return Object(i.a)(a,[{key:"setMode",value:function(e){this.setState({currentMode:e})}},{key:"render",value:function(){var e=this;return"select"===this.state.currentMode?l.a.createElement("div",null,l.a.createElement("button",{onClick:function(){e.setMode("annotating")}},"Start Annotating"),l.a.createElement("img",{width:this.props.imageWidth,height:this.props.imageWidth,src:this.image.src})):l.a.createElement("div",null,l.a.createElement(O,{img:this.image,imageWidth:this.props.imageWidth,setMode:this.setMode.bind(this)}))}}]),a}(l.a.Component),T=a(168),R=a.n(T),P=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={currentMode:"camera",img:null,webCamPermissions:"granted",videoConstraints:{facingMode:{exact:"environment"},height:i.props.imageWidth,width:i.props.imageWidth}},i.webcamRef=l.a.createRef(),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"camera"}).then((function(e){i.setState({webCamPermissions:e.state})})),i}return Object(i.a)(a,[{key:"screenshot",value:function(){var e=this.webcamRef.current.getScreenshot(),t=new Image(this.props.imageWidth,this.props.imageWidth);t.src=e,this.setState({currentMode:"annotation",img:t})}},{key:"switchCamera",value:function(){var e=this.state.videoConstraints.facingMode;e="user"===e?{exact:"environment"}:"user",this.setState({videoConstraints:{facingMode:e,height:this.props.imageWidth,width:this.props.imageWidth}})}},{key:"render",value:function(){return"camera"===this.state.currentMode?"denied"===this.state.webCamPermissions?l.a.createElement("div",null," Please grant camera permissions "):l.a.createElement("div",null,l.a.createElement(R.a,{height:this.props.imageWidth,width:this.props.imageWidth,videoConstraints:this.state.videoConstraints,ref:this.webcamRef}),l.a.createElement("button",{onClick:this.screenshot.bind(this)}," Capture "),l.a.createElement("button",{onClick:this.switchCamera.bind(this)},"Switch Camera")):"annotation"===this.state.currentMode?b.a.useDesktopComponentOnMobile?l.a.createElement(S.a,{imageWidth:this.props.imageWidth,image:this.state.img,stateManager:b.a,isMobile:!0,isFromCamera:!0}):l.a.createElement(I,{imageWidth:this.props.imageWidth-25,image:this.state.img,stateManager:b.a}):void 0}}]),a}(l.a.Component),D=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;Object(n.a)(this,a);var s=window.innerWidth;return(i=t.call(this,e)).state={screen:"home",imageWidth:.4*s,screenWidth:s,objectRGB:null},i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){b.a&&b.a.connect(this)}},{key:"paneHandler",value:function(e){this.setState({screen:e})}},{key:"render",value:function(){var e;return"home"===this.state.screen?e=l.a.createElement(k,{imageWidth:this.state.imageWidth}):"navigation"===this.state.screen?e=l.a.createElement(M,{imageWidth:this.state.imageWidth}):"settings"===this.state.screen?e=l.a.createElement(_,{imageWidth:this.state.imageWidth}):"annotation"===this.state.screen?e=b.a.useDesktopComponentOnMobile?l.a.createElement(S.a,{imageWidth:this.state.screenWidth-25,image:this.state.objectRGB,stateManager:b.a,isMobile:!0}):l.a.createElement(I,{imageWidth:this.state.screenWidth-25,image:this.state.objectRGB,stateManager:b.a}):"camera"===this.state.screen&&(e=l.a.createElement(P,{imageWidth:this.state.screenWidth-25})),l.a.createElement(c.a,{fluid:!0},l.a.createElement("div",{style:{paddingBottom:50}},e),l.a.createElement("div",null,l.a.createElement(d,{paneHandler:this.paneHandler.bind(this)})))}}]),a}(l.a.Component);t.a=D},108:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(2),o=a(6),r=a(5),l=a(0),c=a.n(l),h=a(14),u=a(19),d=a(46),m=a(33),p=a(10),g=a(16),f=a(714),b=a(91),v=["height","width","classes","columns","rowHeight","headerHeight"],y=["dataKey"],k=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(){var e;Object(n.a)(this,a);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).getRowClassName=function(t){var a=t.index,n=e.props,i=n.classes,s=n.onRowClick;return Object(p.a)(i.tableRow,i.flexContainer,Object(m.a)({},i.tableRowHover,-1!==a&&null!=s))},e.cellRenderer=function(t){var a=t.cellData,n=t.columnIndex,i=e.props,s=i.columns,o=i.classes,r=i.rowHeight,l=i.onRowClick;return c.a.createElement(f.a,{component:"div",className:Object(p.a)(o.tableCell,o.flexContainer,Object(m.a)({},o.noClick,null==l)),variant:"body",style:{height:r},align:null!=n&&s[n].numeric?"right":"left"},a)},e.headerRenderer=function(t){var a=t.label,n=t.columnIndex,i=e.props,s=i.headerHeight,o=i.columns,r=i.classes;return c.a.createElement(f.a,{component:"div",className:Object(p.a)(r.tableCell,r.flexContainer,r.noClick),variant:"head",style:{height:s},align:o[n].numeric?"right":"left"},c.a.createElement("span",null,a))},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.height,n=t.width,i=t.classes,s=t.columns,o=t.rowHeight,r=t.headerHeight,l=Object(d.a)(t,v);return c.a.createElement(b.c,Object.assign({height:a,width:n,rowHeight:o,gridStyle:{direction:"inherit"},size:"small",headerHeight:r,className:i.table},l,{rowClassName:this.getRowClassName}),s.map((function(t,a){var n=t.dataKey,s=Object(d.a)(t,y);return c.a.createElement(b.b,Object.assign({key:n,headerRenderer:function(t){return e.headerRenderer(Object(u.a)(Object(u.a)({},t),{},{columnIndex:a}))},className:i.flexContainer,cellRenderer:e.cellRenderer,dataKey:n},s))})))}}]),a}(c.a.PureComponent);k.defaultProps={headerHeight:48,rowHeight:36};var E=Object(g.a)((function(e){return{flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:e.palette.action.hover}},tableCell:{flex:1},noClick:{cursor:"initial"}}}))(k);function M(e){var t=e.memoryManager,a=e.onShowMemoryDetail,n=Object(h.a)(t,2),i=n[0],s=n[1];return c.a.createElement(b.a,null,(function(e){var t=e.height,n=e.width;return c.a.createElement(E,{height:t,width:n,rowCount:i(),rowGetter:function(e){var t,a=e.index;return{uuid:(t=s(a)).data[0],id:t.data[1],type:t.data[9],name:t.data[7]}},onRowClick:function(e){e.event,e.index;var t=e.rowData;t&&t.uuid&&a(t.uuid)},columns:[{flexGrow:1,width:1,label:"ID",dataKey:"id",numeric:!0},{flexGrow:5,width:5,label:"Type",dataKey:"type",numeric:!1},{flexGrow:5,width:5,label:"Name",dataKey:"name",numeric:!1}]})}))}var w=a(86);function _(e,t){e.memories,e.named_abstractions;var a=e.reference_objects,n=e.triples,i=new Map(a.map((function(e){return[e[0],{data:e}]})));n&&n.forEach((function(e){var t=e[1],a=i.get(t);a&&(a.triples?a.triples.push(e):a.triples=[e])}));var s=[];if(null!=t&&t.length>0){var o,r=Object(w.a)(i.values());try{for(r.s();!(o=r.n()).done;){var l=o.value;JSON.stringify(l).includes(t)&&s.push(l)}}catch(c){r.e(c)}finally{r.f()}}else s=Array.from(i.values());return[function(){return s.length},function(e){return s[e]},function(e){return i.get(e)}]}var S=a(104),j=a(745),C=a(746),x=a(380),O=a(51),I=a.n(O),T=a(726),R=a(377),P=a(724),D=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,filter:"",showDetail:!1,detailUUID:null},i.state=i.initialState,i.outer_div=c.a.createRef(),i.resizeHandler=i.resizeHandler.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"resizeHandler",value:function(){if(null!=this.outer_div&&null!=this.outer_div.current){var e=this.outer_div.current,t=e.clientHeight,a=e.clientWidth;(void 0!==t&&t!==this.state.height||void 0!==a&&a!==this.state.width)&&this.setState({height:t,width:a})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){this.resizeHandler()}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return c.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,i=t.memory,s=t.isLoaded;if(0===a&&0===n)return c.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});if(!s)return c.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},"Loading...");var o=Object(R.a)({palette:{type:"dark"}}),r=new _(i,this.state.filter),l=this.state.height-24,h=this.state.width-24,u=function(){e.setState({showDetail:!1})};return c.a.createElement(P.a,{theme:o},c.a.createElement(j.a,{style:{borderBlockColor:"white"},color:"primary",id:"outlined-uncontrolled",label:"Search",margin:"dense",variant:"outlined",onChange:function(t){e.setState({filter:t.target.value})}}),c.a.createElement(M,{height:l,width:h,memoryManager:r,onShowMemoryDetail:function(t){e.setState({detailUUID:t,showDetail:!0})}}),c.a.createElement(C.a,{anchor:"right",open:this.state.showDetail,onClose:function(){u()}},c.a.createElement("div",{style:{width:450}},c.a.createElement(x.a,{onClick:function(){return u()}},c.a.createElement(I.a,null)),c.a.createElement(T.a,null),c.a.createElement(S.a,{memoryManager:r,uuid:this.state.detailUUID}))))}}]),a}(c.a.Component);t.a=D},109:function(e,t,a){"use strict";var n=a(20),i=a(3),s=a(4),o=a(2),r=a(6),l=a(5),c=a(0),h=a.n(c),u=a(81),d=a(377),m=Object(d.a)({palette:{primary:{main:"#ffffff"},secondary:{main:"#5f5f5f"}}}),p=a(724),g=a(126),f=a.n(g),b=a(127),v=(a(82),a(200),function(e){Object(r.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleClick=function(){n.state.isTimerOn?(window.parent.postMessage(JSON.stringify({msg:"timerOFF"}),"*"),window.parent.postMessage(JSON.stringify({msg:{interactionScores:{creativity:n.state.avgCreativity,diversity:n.state.avgDiversity,quantity:n.state.quantityScore,stoplight:n.state.stoplightScore}}}),"*"),n.setState({isTimerOn:!1,isSessionEnd:!0}),n.props.stateManager.socket.emit("terminateAgent",{turk_experiment_id:n.props.stateManager.getTurkExperimentId(),mephisto_agent_id:n.props.stateManager.getMephistoAgentId(),turk_worker_id:n.props.stateManager.getTurkWorkerId()})):(window.parent.postMessage(JSON.stringify({msg:"timerON"}),"*"),n.setState({isTimerOn:!0,startTime:Date.now()}),n.timer=setInterval((function(){n.setState({timeElapsed:Date.now()-n.state.startTime})}),10))},n.state={isTimerOn:!1,isSessionEnd:!1,startTime:0,timeElapsed:0,creativityScores:[null],diversityScores:[null],avgDiversity:null,avgCreativity:null,quantityScore:null,stoplightScore:null,commandList:[],performanceIndicator:[!1,!1,!1],feedback:"",commandCorpus:[],bonus:"$0.00",isOncall:!1},n.calcCreativity=n.calcCreativity.bind(Object(o.a)(n)),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.stateManager.connect(this),this.props.stateManager.forceErrorLabeling(!0);var t=new URLSearchParams(window.location.search);t.get("job_type")&&"oncall"===t.get("job_type")&&this.setState({isOncall:!0}),fetch("https://craftassist.s3.us-west-2.amazonaws.com/pubr/nsp_data.txt").then((function(e){return e.blob()})).then((function(e){return e.text()})).then((function(e){return e.split("\n")})).then((function(t){var a=[];t.forEach((function(e){a.push(e.split("|")[0])})),e.setState({commandCorpus:a})})).catch((function(e){console.error("Error:",e)}))}},{key:"componentWillUnmount",value:function(){this.props.stateManager.disconnect(this)}},{key:"calcCreativity",value:function(e){var t=Object(b.removeStopwords)(e.split(" ")),a=t.length,i=this.state.commandCorpus.length,s=0;this.state.commandCorpus.forEach((function(e){var n=Object(b.removeStopwords)(e.split(" ")),o=a>n.length?a:n.length,r=f.a.diff(t,n).distance/(o*i*.1);isNaN(r)||(s+=r)})),s=16.667*(s-9.4),s-=1.5*Math.pow(Math.abs(4-a),2),s=Math.max(1,Math.round(100*s)/100),console.log("This Creativity Score: "+s+"/10");var o=Object(n.a)(this.state.creativityScores);o.push(s);var r=o.slice(1).reduce((function(e,t){return e+t}))/o.slice(1).length;console.log("Avg Creativity Score: "+r+"/10");var l=Object(n.a)(this.state.commandList),c=0;l.length>0&&l.forEach((function(e){var n=a>e.length?a:e.length,i=f.a.diff(t,e).distance/(n*l.length*.1);isNaN(i)||(c+=i)})),c=3*(c-6.667),c=Math.max(1,Math.round(100*c)/100),console.log("This Diversity Score: "+c+"/10");var h=Object(n.a)(this.state.diversityScores);h.push(c);var u=h.slice(1).reduce((function(e,t){return e+t}))/h.slice(1).length;console.log("Avg Diversity Score: "+u+"/10"),l.push(t);var d=Math.min(l.length,10);console.log("Quantity Score: "+d+"/10");var m=(Math.log10(r)+Math.log10(u)+Math.log10(d))/.3;console.log("Stoplight Score: "+m+"/10");var p,g="$"+(.3*m).toFixed(2);p=m<5?[!1,!1,!0]:m<6.5?[!1,!0,!1]:[!0,!1,!1];var v="";a<3?v+="Try sending longer commands. ":a>5?v+="Try sending shorter commands. ":s<5&&(v+="Try sending more creative commands. "),d<5?v+="Please send more commands. ":c<4&&(v+="Commands should be more different from one another. "),0===v.length&&(v+="Good job!"),this.setState({creativityScores:o,diversityScores:h,avgCreativity:r,avgDiversity:u,quantityScore:d,stoplightScore:m,commandList:l,feedback:v,performanceIndicator:p,bonus:g})}},{key:"renderStoplight",value:function(){return this.state.isOncall?void 0:h.a.createElement("div",{className:"stoplight"},h.a.createElement("h4",null,"HIT Performance Indicator:"),this.state.performanceIndicator[0]?h.a.createElement("status-indicator",{positive:!0,pulse:!0}):h.a.createElement("status-indicator",{positive:!0}),this.state.performanceIndicator[1]?h.a.createElement("status-indicator",{intermediary:!0,pulse:!0}):h.a.createElement("status-indicator",{intermediary:!0}),this.state.performanceIndicator[2]?h.a.createElement("status-indicator",{negative:!0,pulse:!0}):h.a.createElement("status-indicator",{negative:!0}),h.a.createElement("p",{style:{color:"#39ff14"}},"Current Bonus: ",this.state.bonus),h.a.createElement("p",null,"Feedback: ",this.state.feedback))}},{key:"renderTimer",value:function(){var e=this.state.timeElapsed,t=("0"+Math.floor(e/1e3)%60).slice(-2),a=("0"+Math.floor(e/6e4)%60).slice(-2);return this.state.isOncall?h.a.createElement("div",null,h.a.createElement("div",{style:{fontSize:40}},a," : ",t),h.a.createElement("br",null),h.a.createElement(u.a,{className:"MsgButton",variant:"contained",color:this.state.isTimerOn?"secondary":"primary",onClick:this.handleClick.bind(this),disabled:!1},this.state.isTimerOn?"End":"Start"),h.a.createElement("br",null),this.state.isTimerOn?h.a.createElement("div",null,h.a.createElement("p",null,"Please interact with the assistant."),h.a.createElement("p",null,"When you've finished interacting with the assistant, press the 'End' button to proceed to next steps.")):h.a.createElement("div",null,h.a.createElement("p",null,"Please click on the button to start the session. "))):h.a.createElement("div",null,h.a.createElement("div",{style:{fontSize:40}},a," : ",t),h.a.createElement("br",null),h.a.createElement(u.a,{className:"MsgButton",variant:"contained",color:this.state.isTimerOn?"secondary":"primary",onClick:this.handleClick.bind(this),disabled:!!this.state.isTimerOn&&a<5},this.state.isTimerOn?"End":"Start"),h.a.createElement("br",null),this.state.isTimerOn?h.a.createElement("div",null,a<5?h.a.createElement("div",null,h.a.createElement("p",null,"Please interact with the assistant."),h.a.createElement("p",null,"The 'End' button will appear when 5 minutes have passed.")):h.a.createElement("div",null,h.a.createElement("p",null,"When you've finished interacting with the assistant, press the 'End' button to proceed to next steps."))):h.a.createElement("div",null,h.a.createElement("p",null,"Please click on the button to start the session. "),h.a.createElement("p",null,"When at least 5 minutes have passed and you are finished, click on the button to end the session and proceed to next steps.")))}},{key:"render",value:function(){return h.a.createElement(p.a,{theme:m},h.a.createElement("div",{className:"App"},h.a.createElement("div",{className:"infoContent"},this.renderStoplight(),this.state.isSessionEnd?h.a.createElement("p",{style:{fontSize:40,lineHeight:"40px"}},"Thanks for interacting with the bot. You may leave the page now."):h.a.createElement("div",{className:"timer"},this.renderTimer()))))}}]),a}(c.Component));t.a=v},187:function(e,t,a){},188:function(e,t,a){},189:function(e,t,a){},190:function(e,t,a){},195:function(e,t,a){},196:function(e,t,a){},197:function(e,t,a){},198:function(e,t,a){},199:function(e,t,a){},200:function(e,t,a){},27:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(2),o=a(6),r=a(5),l=a(0),c=a.n(l),h=a(52),u=a(12),d=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onResize=i.onResize.bind(Object(s.a)(i)),i.initialState={height:e.height,width:e.width,rgb:null,depth:null},i.state=i.initialState,i}return Object(i.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.depth,s=this.props,o=s.offsetW,r=s.offsetH,l=s.isMobile,d=n;return null===n&&null==i?l?c.a.createElement("p",null,"Loading..."):c.a.createElement(h.a,{default:{x:o,y:r,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement("p",null,"Loading...")):("depth"===this.props.type&&(d=i),l?c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:d,width:a,height:t}))):c.a.createElement(h.a,{default:{x:o,y:r,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:d,width:a,height:t})))))}}]),a}(c.a.Component);t.a=d},279:function(e,t,a){},38:function(e,t,a){"use strict";var n=a(86),i=a(19),s=a(20),o=a(3),r=a(4),l=a(2),c=a(6),h=a(5),u=a(0),d=a.n(u),m=a(81),p=(a(190)," You can type a new command now."),g=function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).allowedStates=["sent","received","thinking","done_thinking","executing"],n.scrollToBottom=function(){n.messagesEnd&&n.messagesEnd.scrollIntoView({behavior:"smooth",block:"nearest"})},n.initialState={connected:!1,ellipsis:"",commandState:"idle",now:null,disableInput:!1,lastChatActionDict:"",memory_entries:null,chats:[{msg:"",timestamp:Date.now()}],response_options:[],last_command:"",agent_replies:[{}],agentType:null,isTurk:!0,action_dict:{},parsing_error:!1,vision_error:!1,task_error:!1,feedback:"",isSaveFeedback:!1,clarify:!1,reference_object_description:null},n.state=n.initialState,n.intervalId=null,n.messagesEnd=null,n.elementRef=d.a.createRef(),n.bindKeyPress=n.handleKeyPress.bind(Object(l.a)(n)),n.sendTaskStackPoll=n.sendTaskStackPoll.bind(Object(l.a)(n)),n.issueResetCommand=n.issueResetCommand.bind(Object(l.a)(n)),n.answerAction=n.answerAction.bind(Object(l.a)(n)),n.answerParsing=n.answerParsing.bind(Object(l.a)(n)),n.answerVision=n.answerVision.bind(Object(l.a)(n)),n.receiveTaskStackPoll=n.receiveTaskStackPoll.bind(Object(l.a)(n)),n}return Object(r.a)(a,[{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"saveFeedback",value:function(){var e={msg:this.state.last_command,action_dict:this.state.action_dict,parsing_error:this.state.parsing_error,task_error:this.state.task_error,vision_error:this.state.vision_error,feedback:this.state.feedback};this.props.stateManager.socket.emit("saveErrorDetailsToCSV",e),this.setState({parsing_error:!1,task_error:!1,vision_error:!1,feedback:"",disableInput:!1})}},{key:"removeButtonsFromLastQuestion",value:function(){var e=Object(s.a)(this.state.agent_replies);e.forEach((function(e){return e.isQuestion=!1,e.enableBack=!1})),this.setState({agent_replies:e})}},{key:"componentDidMount",value:function(){if(document.addEventListener("keypress",this.bindKeyPress),this.props.stateManager){this.props.stateManager.connect(this);var e=this.props.stateManager.memory.lastChatActionDict,t=this.props.stateManager.memory.memory_entries;this.setState({isTurk:this.props.stateManager.memory.isTurk,agent_replies:this.props.stateManager.memory.agent_replies,connected:this.props.stateManager.connected,action_dict:e,memory_entries:t})}this.scrollToBottom()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keypress",this.bindKeyPress),this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"addNewAgentReplies",value:function(e){var t=e.msg,a=e.isQuestion,n=e.questionType,o=e.disablePreviousAnswer,r=e.enableBack;this.setState({agent_replies:this.props.stateManager.memory.agent_replies});var l=this.state.agent_replies,c=o?l.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{isQuestion:!1,enableBack:!1})})):l;c=[].concat(Object(s.a)(c),[{msg:t,timestamp:Date.now()+1,questionType:n,isQuestion:a,enableBack:r}]),this.setState({agent_replies:c}),this.props.stateManager.memory.agent_replies=c}},{key:"updateChat",value:function(e){var t=Object(s.a)(this.state.chats);t.push(e),this.setState({chats:t})}},{key:"renderChatHistory",value:function(){var e=this,t=this.state.chats.filter((function(e){return""!==e.msg})),a=this.state.agent_replies.filter((function(e){return""!==e.msg}));t=t.filter((function(e){return e.msg})),a=a.filter((function(e){return e.msg})),t.forEach((function(e){return e.sender="message user"})),a.forEach((function(e){return e.sender="message agent"})),a.forEach((function(e){e.msg.includes("Agent: ")&&(e.msg=e.msg.substring(7))}));var n=t.concat(a);return n.sort((function(e,t){return e.isQuestion&&!t.isQuestion?1:!e.isQuestion&&t.isQuestion?-1:e.timestamp-t.timestamp})),n.map((function(t){return d.a.cloneElement(d.a.createElement("li",{className:"message-item",key:t.timestamp.toString()},d.a.createElement("div",{className:t.sender},t.msg),d.a.createElement("div",{className:"answer-buttons"},d.a.createElement(m.a,{variant:"contained",color:"primary",className:"yes-button",style:{display:t.isQuestion?"inline flex":"none"},onClick:function(){return e.answerRouting(1,t.questionType)}},"Yes"),d.a.createElement(m.a,{variant:"contained",color:"primary",className:"no-button",style:{display:t.isQuestion?"inline flex":"none"},onClick:function(){return e.answerRouting(2,t.questionType)}},"No"),d.a.createElement(m.a,{variant:"contained",color:"primary",className:"back-button",style:{display:t.enableBack?"inline flex":"none"},onClick:function(){return e.answerRouting(3,t.questionType)}},"Go Back"))))}))}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(e.preventDefault(),this.handleSubmit())}},{key:"handleSubmit",value:function(){var e=document.getElementById("msg").value;document.getElementById("msg").value="",this.removeButtonsFromLastQuestion(),this.state.isSaveFeedback?(this.setState({isSaveFeedback:!1,feedback:e}),this.saveFeedback(),this.updateChat({msg:e,timestamp:Date.now()}),this.addNewAgentReplies({msg:"Feedback has been saved!"+p}),this.removeButtonsFromLastQuestion()):""!==e.replace(/\s/g,"")&&(this.updateChat({msg:e,timestamp:Date.now()}),this.setState({last_command:e}),this.props.stateManager.logInteractiondata("text command",e),window.parent.postMessage(JSON.stringify({msg:{command:e}}),"*"),this.props.stateManager.sendCommandToTurkInfo(e),this.props.stateManager.socket.emit("sendCommandToAgent",e),this.props.stateManager.memory.commandState="sent","craftassist"===this.state.agentType&&this.handleAgentThinking())}},{key:"issueResetCommand",value:function(){this.state.clarify&&this.removeButtonsFromLastQuestion(),this.updateChat({msg:"reset",timestamp:Date.now()}),this.props.stateManager.logInteractiondata("text command","stop"),this.props.stateManager.socket.emit("sendCommandToAgent","stop"),this.props.stateManager.memory.commandState="sent"}},{key:"handleAgentThinking",value:function(){var e=this;this.props.stateManager&&this.props.stateManager.socket.on("taskStackPollResponse",this.receiveTaskStackPoll),this.intervalId=setInterval((function(){var t=null;e.props.stateManager&&(t=e.props.stateManager.memory.commandState),e.safetyCheck()&&e.setState((function(e){return e.commandState!==t&&window.parent.postMessage(JSON.stringify({msg:t}),"*"),e.ellipsis.length>6?{ellipsis:"",commandState:t}:{ellipsis:e.ellipsis+".",commandState:t}}))}),this.props.stateManager.memory.commandPollTime),this.setState({commandState:this.props.stateManager.memory.commandState,now:Date.now()})}},{key:"componentDidUpdate",value:function(e,t){if(this.state.commandState!==t.commandState&&"idle"!==this.state.commandState){this.setState({disableInput:!0})}this.scrollToBottom()}},{key:"renderResetButton",value:function(){if("idle"!==this.state.commandState||this.state.clarify)return d.a.createElement("div",{className:"reset"},d.a.createElement(m.a,{variant:"contained",color:"primary",onClick:this.issueResetCommand.bind(this),className:"reset-button"},this.state.clarify?"Reset":"Stop"))}},{key:"renderStatusMessages",value:function(){if("idle"!==this.state.commandState){var e="";return"sent"===this.state.commandState?e="Sending command...":"received"===this.state.commandState?e="Command received":"thinking"===this.state.commandState?e="Assistant is thinking...":"done_thinking"===this.state.commandState?e="Assistant is done thinking":"executing"===this.state.commandState&&(e="Assistant is doing the task..."),d.a.createElement("div",{className:"status"},e)}}},{key:"sendTaskStackPoll",value:function(){this.props.stateManager.socket.emit("taskStackPoll")}},{key:"receiveTaskStackPoll",value:function(e){var t=this;console.log("Received task stack poll response:"+JSON.stringify(e)),e&&(this.setState({now:Date.now()}),e.task?e.task&&e.clarify?(console.log("Agent asked for task clarification"),this.setState({clarify:!0}),setTimeout((function(){t.sendTaskStackPoll()}),1e3)):setTimeout((function(){t.sendTaskStackPoll()}),1e3):(this.state.isTurk&&this.askActionQuestion(),this.handleClearInterval()))}},{key:"safetyCheck",value:function(){return!(!this.allowedStates.includes(this.state.commandState)||Date.now()-this.state.now>5e4)||(console.log("Safety dance: "+this.state.commandState),this.handleClearInterval(),console.log("After handle clear interval"),console.log(this.state.isTurk),this.state.isTurk&&(console.log("is turk, ask action question"),this.askActionQuestion()),!1)}},{key:"handleClearInterval",value:function(){clearInterval(this.intervalId),this.props.stateManager&&(this.props.stateManager.socket.off("taskStackPollResponse",this.receiveTaskStackPoll),this.setState({disableInput:!1,commandState:"idle",clarify:!1}))}},{key:"answerRouting",value:function(e,t){switch(t){case"answerAction":this.answerAction(e);break;case"answerParsing":this.answerParsing(e);break;case"answerVision":this.answerVision(e);break;case"clarification":this.answerClarification(e);break;default:console.error("Answer Routing called with invalid question type!")}}},{key:"askActionQuestion",value:function(){console.log("askActionQuestion"),this.props.stateManager.socket.emit("getChatActionDict",this.state.last_command),console.log("askActionQuestion, sending out request to get chat AD"),window.parent.postMessage(JSON.stringify({msg:"askActionQuestion"}),"*"),this.addNewAgentReplies({msg:"Did I successfully do the task you asked me to complete?",isQuestion:!0,questionType:"answerAction",enableBack:!1})}},{key:"answerAction",value:function(e){if(1===e)this.updateChat({msg:"Yes",timestamp:Date.now()}),this.addNewAgentReplies({msg:"Thanks!"+p,questionType:"answerParsing",isQuestion:!1,disablePreviousAnswer:!0,enableBack:!0}),this.setState({disableInput:!1});else if(2===e)if(this.setState({task_error:!0}),this.state.action_dict){if(this.updateChat({msg:"No",timestamp:Date.now()}),"dialogue_type"in this.state.action_dict){var t=this.state.action_dict.dialogue_type,a="";if("HUMAN_GIVE_COMMAND"===t){var n=this.state.action_dict.event_sequence[0],i=n.action_type.toLowerCase();if(a="to "+i+" ",["build","dig"].indexOf(i)>=0){if("schematic"in n)if("text_span"in n.schematic)a=a+"'"+n.schematic.text_span+"'";else if("where_clause"in n.schematic.filters){var s="";"selector"in n.schematic.filters&&(s=n.schematic.filters.selector.ordinal);var o=[s,"","","",""];n.schematic.filters.where_clause.AND.forEach((function(e){"has_size"===e.pred_text?o[1]=e.obj_text:"has_colour"===e.pred_text?o[2]=e.obj_text:"has_block_type"===e.pred_text?o[3]=e.obj_text:"has_name"===e.pred_text&&(o[4]=e.obj_text)})),a=a+"'"+o.join(" ").replace(/  +/g," ").trim()+"'"}"location"in n&&("text_span"in n.location?a=a+" at location '"+n.location.text_span+"'":a+=" at this location "),a+=" ?"}else if(["destroy","fill","spawn","copy","get","scout","freebuild"].indexOf(i)>=0){if("reference_object"in n)if("text_span"in n.reference_object)a=a+"'"+n.reference_object.text_span+"'";else if("where_clause"in n.reference_object.filters){var r="";"selector"in n.reference_object.filters&&(r=n.reference_object.filters.selector.ordinal);var l=[r,"","","",""];n.reference_object.filters.where_clause.AND.forEach((function(e){"has_size"===e.pred_text?l[1]=e.obj_text:"has_colour"===e.pred_text?l[2]=e.obj_text:"has_block_type"===e.pred_text?l[3]=e.obj_text:"has_name"===e.pred_text&&(l[4]=e.obj_text)})),a=a+"'"+l.join(" ").replace(/  +/g," ").trim()+"'"}"location"in n&&("text_span"in n.location?a=a+" at location '"+n.location.text_span+"'":a+=" at this location "),a+=" ?"}else["move"].indexOf(i)>=0?("location"in n&&("text_span"in n.location?a=a+" to location '"+n.location.text_span+"'":a+=" to here"),a+=" ?"):["stop","resume","undo"].indexOf(i)>=0?("target_action_type"in n&&(a=a+" at location '"+n.target_action_type+"'"),a+=" ?"):["otheraction"].indexOf(i)>=0&&(a="to perform an action not in assistant capabilities ?")}else"GET_MEMORY"===t?a="to answer a question about something in the Minecraft world ?":"PUT_MEMORY"===t?a="to remember or learn something you taught it ?":"NOOP"===t&&(a="to just respond verbally with no action ?")}else a="to do nothing ?";this.addNewAgentReplies({msg:"Did you want the assistant ".concat(a),isQuestion:!0,questionType:"answerParsing",disablePreviousAnswer:!0,enableBack:!0})}else this.updateChat({msg:"No",timestamp:Date.now()}),this.addNewAgentReplies({msg:"Thanks!"+p,isQuestion:!1,questionType:"answerParsing",disablePreviousAnswer:!0,enableBack:!0})}},{key:"answerParsing",value:function(e){this.removeButtonsFromLastQuestion(),1===e?(this.updateChat({msg:"Yes",timestamp:Date.now()}),this.evalCommandPerception()):2===e?(this.updateChat({msg:"No",timestamp:Date.now()}),this.renderParsingFail(),this.setState({parsing_error:!0})):3===e&&(this.updateChat({msg:"Go Back",timestamp:Date.now()}),this.setState({parsing_error:!1,vision_error:!1,task_error:!1,disableInput:!0,isSaveFeedback:!1}),this.askActionQuestion())}},{key:"renderParsingFail",value:function(){this.addNewAgentReplies({msg:"Thanks for letting me know that I didn't understand the command right."+p,questionType:"answerParsing",disablePreviousAnswer:!0,enableBack:!1}),this.saveFeedback()}},{key:"check_reference_object_in_action_dict",value:function(e){var t=e;for(var a in t){if("reference_object"===a)return!0;if(t[a].constructor===Object&&this.check_reference_object_in_action_dict(t[a]))return!0}return!1}},{key:"extractLocationRef",value:function(e){console.log("extractLocationRef");var t="";if("reference_object"in e)if("text_span"in e.reference_object)t="'"+e.reference_object.text_span+"'";else if("filters"in e.reference_object&&"where_clause"in e.reference_object.filters){var a="";"selector"in e.reference_object.filters&&(a=e.reference_object.filters.selector.ordinal);var n=[a,"","","",""];e.reference_object.filters.where_clause.AND.forEach((function(e){"has_size"===e.pred_text?n[1]=e.obj_text:"has_colour"===e.pred_text?n[2]=e.obj_text:"has_block_type"===e.pred_text?n[3]=e.obj_text:"has_name"===e.pred_text&&(n[4]=e.obj_text)})),t="'"+n.join(" ").replace(/  +/g," ").trim()+"'"}return console.log("extractLocationRef returns:"),console.log(t),t}},{key:"evalCommandPerception",value:function(){console.log("evalCommandPerception");var e=!1,t=null;if(this.state.action_dict){if("HUMAN_GIVE_COMMAND"===this.state.action_dict.dialogue_type){var a,i=Object(n.a)(this.state.action_dict.event_sequence);try{for(i.s();!(a=i.n()).done;){var s=a.value;e=this.check_reference_object_in_action_dict(s)}}catch(l){i.e(l)}finally{i.f()}}if(console.log("evalCommandPerception refobj:"),console.log(e),!0===e){var o=this.state.action_dict.event_sequence[0],r=null;"location"in o?r=o.location:"reference_object"in o&&(r=o),r&&(t=this.extractLocationRef(r))}}console.log("evalCommandPerception: refobj desc"),console.log(t),t||console.log("InteractApp evalCommandPerception: no action dictionary found"),this.setState({reference_object_description:t},this.askVisionQuestion),console.log("Set state: ref obj desc"),console.log(this.state.reference_object_description),console.log("Class state rn:"),console.log(this.state)}},{key:"askVisionQuestion",value:function(){console.log("askVisionQuestion");var e=this.state.reference_object_description;if(console.log("ref obj desc in ask vision q:"),console.log(e),e)if(this.setState({agent_replies:this.props.stateManager.memory.agent_replies}),this.state.memory_entries){var t=this.state.memory_entries.point_target.join(" ");console.log("bbox: "+t),this.props.stateManager.flashBlocksInVW(t),this.addNewAgentReplies({msg:"Okay, I was looking for an object of interest called :\n          ".concat(e,". I'll make it flash in the world now.\n          Does that object look right ?"),isQuestion:!0,questionType:"answerVision",enableBack:!0})}else this.addNewAgentReplies({msg:"I did not find anything called : ".concat(e," in the world.\n          Does that seem right from your view of the world ?"),isQuestion:!0,questionType:"answerVision",enableBack:!0});else this.renderOtherError()}},{key:"answerVision",value:function(e){var t=this;1===e?(this.updateChat({msg:"Yes",timestamp:Date.now()}),this.renderOtherError()):2===e?(this.updateChat({msg:"No",timestamp:Date.now()}),this.setState({vision_error:!0},this.renderVisionFail)):3===e&&(this.updateChat({msg:"Go Back",timestamp:Date.now()}),this.setState({disableInput:!0,isSaveFeedback:!1,parsing_error:!1,vision_error:!1},(function(){return t.answerAction(2)})))}},{key:"renderVisionFail",value:function(){this.addNewAgentReplies({msg:"Thanks for letting me know that I didn't detect the object right."+p,questionType:"answerVision",disablePreviousAnswer:!0,enableBack:!1}),this.saveFeedback()}},{key:"renderOtherError",value:function(){this.addNewAgentReplies({msg:"Okay, looks like I understood your command but didn't complete it. Please tell me more about what I did wrong?",questionType:"answerVision",isQuestion:!1,enableBack:!0}),this.setState({disableInput:!1,isSaveFeedback:!0})}},{key:"answerClarification",value:function(e){var t;1===e?t="yes":2===e&&(t="no"),this.updateChat({msg:t,timestamp:Date.now()}),this.props.stateManager.socket.emit("sendCommandToAgent",t),this.removeButtonsFromLastQuestion()}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"App",style:{padding:0}},d.a.createElement("div",{className:"content"},d.a.createElement("div",null,d.a.createElement("div",null,d.a.createElement("p",null,"Enter the command to the assistant in the input box below, then press 'Enter'.")),d.a.createElement("div",{className:"center"},d.a.createElement("div",{className:"chat"},d.a.createElement("div",{className:"time"},"Assistant is"," ",!0===this.state.connected?d.a.createElement("span",{style:{color:"green"}},"connected"):d.a.createElement("span",{style:{color:"red"}},"not connected")),d.a.createElement("div",{className:"messages"},d.a.createElement("div",{className:"messsages-content",id:"scrollbar"},d.a.createElement("ul",{className:"messagelist",id:"chat"},this.renderChatHistory(),d.a.createElement("div",{className:"messagesEnd",ref:function(t){e.messagesEnd=t}})))),this.renderResetButton(),this.renderStatusMessages(),d.a.createElement("div",{className:"input"},d.a.createElement("input",{id:"msg",placeholder:this.state.disableInput?"Waiting for Assistant".concat(this.state.ellipsis):"Type your command or response here",type:"text",disabled:this.state.disableInput})))))))}}]),a}(u.Component);t.a=g},41:function(e,t,a){"use strict";var n=a(20),i=a(3),s=a(4),o=a(2),r=a(6),l=a(5),c=a(0),h=a.n(c),u=a(52),d=a(12),m=a(55),p=["rgba(0,200,0,.5)","rgba(200,0,0,.5)","rgba(0,100,255,.5)","rgba(255,150,0,.5)","rgba(100,255,200,.5)","rgba(200,200,0,.5)","rgba(0,200,150,.5)","rgba(200,0,200,.5)","rgba(0,204,255,.5)"],g=function(e){Object(r.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).addObject=n.addObject.bind(Object(o.a)(n)),n.onResize=n.onResize.bind(Object(o.a)(n)),n.onFixup=n.onFixup.bind(Object(o.a)(n)),n.onAnnotationSave=n.onAnnotationSave.bind(Object(o.a)(n)),n.onModelSwitch=n.onModelSwitch.bind(Object(o.a)(n)),n.onPrevFrame=n.onPrevFrame.bind(Object(o.a)(n)),n.onNextFrame=n.onNextFrame.bind(Object(o.a)(n)),n.initialState={height:e.height,width:e.width,scale:1,rgb:null,objects:null,modelMetrics:null,offline:!1,updateFixup:!1},n.state=n.initialState,n}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(){this.state.updateFixup&&(this.onFixup(),this.setState({updateFixup:!1}))}},{key:"addObject",value:function(e){var t=this.state.objects?this.state.objects.concat(e):[e];this.setState({objects:t})}},{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"onFixup",value:function(){if(this.props.stateManager){var e=this.props.stateManager,t=void 0;if(e.refs.forEach((function(e){e instanceof m.a&&(t=e)})),void 0!==t){var a=this.state.objects.map((function(e){return{mask:e.mask?e.mask.map((function(e){return e.map((function(e){return{x:e[0]/500,y:e[1]/500}}))})):[],label:e.label,properties:e.properties.split("\n "),type:e.type,id:e.id}}));t.setState({image:this.state.rgb,objects:a});for(var n=e.dashboardLayout,i=0;i<n._getAllContentItems().length;i++)if("ObjectFixup"===n._getAllContentItems()[i].config.component){var s=n._getAllContentItems()[i];s.parent.setActiveContentItem(s)}}}}},{key:"onAnnotationSave",value:function(){this.props.stateManager&&this.props.stateManager.onSave()}},{key:"onModelSwitch",value:function(){this.props.stateManager&&(console.log("switching model..."),this.props.stateManager.socket.emit("switch_detector"))}},{key:"onPrevFrame",value:function(){this.props.stateManager&&this.props.stateManager.previousFrame()}},{key:"onNextFrame",value:function(){this.props.stateManager&&this.props.stateManager.nextFrame()}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this,t=this.state,a=t.height,i=t.width,s=t.rgb,o=t.objects,r=this.props,l=r.offsetW,c=r.offsetH;if(null===s)return h.a.createElement(u.a,{default:{x:l,y:c,width:i,height:a},lockAspectRatio:!0,onResize:this.onResize},h.a.createElement("p",null,"Loading..."));var m=[],g=o;null===o&&(g=[]);var f=0;g.forEach((function(t,a){if("person"!==t.label){var i=t.id,s=a;Number.isInteger(i)&&(s=i);var o=String(i).concat("_"+t.label),r=(t.properties,p[s%p.length]),l=e.state.scale,c=parseInt(t.bbox[0]*l),u=parseInt(t.bbox[1]*l),g=parseInt(t.bbox[2]*l),b=parseInt(t.bbox[3]*l)-u,v=g-c;if(m.push(h.a.createElement(d.Rect,{key:f,x:c,y:u,width:v,height:b,fillEnabled:!1,stroke:r,opacity:1})),t&&t.mask)for(var y=function(e){var i=t.mask[e].map((function(e){return[e[0]*l,e[1]*l]}));m.push(h.a.createElement(d.Shape,{sceneFunc:function(e,t){e.beginPath(),e.moveTo.apply(e,Object(n.a)(i[0]));for(var a=1;a<i.length;a++)e.lineTo.apply(e,Object(n.a)(i[a]));e.closePath(),e.fillStrokeShape(t)},fill:r,opacity:1,stroke:"detector"===t.type?"white":"black",strokeWidth:1,key:"".concat(a,"-").concat(e)}))},k=0;k<t.mask.length;k++)y(k);m.push(h.a.createElement(d.Text,{key:[f++,o],text:o,x:c,y:u,fill:"white",opacity:1,fontSize:20}))}}));var b=null;return this.state.offline&&(b=h.a.createElement("span",{style:{float:"right"}},h.a.createElement("button",{onClick:this.onPrevFrame},"<-"),h.a.createElement("button",{onClick:this.onNextFrame},"->"))),h.a.createElement(u.a,{default:{x:l,y:c,width:i,height:a},lockAspectRatio:!0,onResize:this.onResize},h.a.createElement(d.Stage,{width:i,height:a},h.a.createElement(d.Layer,null,h.a.createElement(d.Image,{image:s,width:i,height:a}),m)),h.a.createElement("button",{onClick:this.onFixup},"Fix"),h.a.createElement("button",{onClick:this.onAnnotationSave},"Save"),b)}}]),a}(h.a.Component);t.a=g},48:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(2),o=a(6),r=a(5),l=a(0),c=a.n(l),h=a(52),u=a(12),d=a(171),m=[["left_ear","left_eye"],["right_ear","right_eye"],["left_eye","right_eye"],["left_eye","nose"],["right_eye","nose"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"],["right_hip","left_hip"],["right_shoulder","left_shoulder"]],p=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onResize=i.onResize.bind(Object(s.a)(i)),i.initialState={height:e.height,width:e.width,rgb:null,humans:null},i.state=i.initialState,i}return Object(i.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.humans,s=this.props,o=s.offsetW,r=s.offsetH,l=s.isMobile;if(null===n)return l?c.a.createElement("p",null,"Loading... "):c.a.createElement(h.a,{default:{x:o,y:r,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement("p",null,"Loading..."));var p=[],g=0,f=0;return i.forEach((function(e){var a=t/512,n=d.a[g++];g===d.a.length&&(g=0),m.forEach((function(t){var i=e.keypoints[t[0]],s=e.keypoints[t[1]],o=[parseInt(i[0]*a),parseInt(i[1]*a),parseInt(s[0]*a),parseInt(s[1]*a)];p.push(c.a.createElement(u.Line,{key:f++,points:o,stroke:n}))}))})),l?c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:n,width:a,height:t}),p)):c.a.createElement(h.a,{default:{x:o,y:r,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:n,width:a,height:t}),p)))}}]),a}(c.a.Component);t.a=p},50:function(e,t,a){"use strict";var n=a(14),i=a(46),s=a(69),o=a(33),r=a(19),l=a(3),c=a(4),h=a(2),u=a(6),d=a(5),m=a(0),p=a.n(m),g=a(739),f=a(747),b={PlayerNode:"#F47373",AttentionNode:"#DCE775",LocationNode:"#2CCCE4",MobNode:"#37D67A",ItemStackNode:"#0000FF"},v=[40,25],y=[30,25],k=[10,15],E=[32,5],M="Segoe UI";function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left-start",n=t-4>>1;return e&&e.length>t?p.a.createElement(g.a,{display:"flex",justifyContent:"center",alignItems:"center",maxHeight:20},p.a.createElement(f.a,{title:e,placement:a,interactive:!0,leaveDelay:500},p.a.createElement("p",null,e.substring(0,n)+"..."+e.substring(e.length-n)))):e}var _=a(12),S=a(732),j=a(16),C=a(720),x=a(722),O=a(714),I=a(719),T=a(721),R=a(715),P=a(686),D=a(81),A=a(380),N=a(164),F=a.n(N),L=a(163),W=a.n(L),H=a(51),z=a.n(H),B=a(745),V=Object(j.a)((function(e){return{root:{fontSize:14,fontFamily:M,width:"auto !important",maxWidth:100,overflow:"hidden"},head:{backgroundColor:e.palette.common.black,color:e.palette.common.white},body:{color:e.palette.common.black,borderBottomColor:e.palette.common.black}}}))(O.a),U=Object(j.a)((function(e){return{root:{"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover}}}}))(R.a),q=Object(j.a)((function(e){return{root:{border:"1px solid #e2e2e1",overflow:"hidden",borderRadius:4,backgroundColor:"#0a0a01","& .Mui-error":{backgroundColor:"red"}}}}))(B.a);function G(e){var t=Object(m.useState)(e.value),a=Object(n.a)(t,2),i=a[0],s=a[1],o=Object(m.useState)(!1),r=Object(n.a)(o,2),l=r[0],c=r[1];return p.a.createElement(q,{defaultValue:e.value,size:"small",error:l,onChange:function(t){if(s(t.target.value),!t.target.value)return c(!0),void e.updateDisableSubmit(!0);c(!1),e.updateDisableSubmit(!1);try{JSON.parse(t.target.value)}catch(a){c(!0),e.updateDisableSubmit(!0)}},onBlur:function(t){i!==e.value?e.updateStatus("changed"):e.updateStatus("same");try{JSON.parse(i),e.updateValue(JSON.parse(i))}catch(a){e.updateStatus("error")}},InputProps:{disableUnderline:!0},inputProps:{style:{padding:5,fontSize:14,fontFamily:M}}})}function Y(e){var t=Object(m.useState)(null),a=Object(n.a)(t,2),i=a[0],s=a[1],l=Object(m.useState)({}),c=Object(n.a)(l,2),h=c[0],u=c[1],d=Object(m.useState)(0),b=Object(n.a)(d,2),v=b[0],y=b[1],k=Object(m.useState)(!0),E=Object(n.a)(k,2),M=E[0],_=E[1],S=Object(m.useState)([]),j=Object(n.a)(S,2),O=j[0],N=j[1];Object(m.useEffect)((function(){if(e.data){var t={};Object.keys(e.data).forEach((function(a){return t[a]={value:e.data[a],valueType:typeof e.data[a],status:"same"}})),s(e.data.memid),u(t),_(!0)}}),[e.data,v]),Object(m.useEffect)((function(){if(e.allTriples){var t=[];e.allTriples.forEach((function(e){e[1]===i&&t.push(e)})),N(t)}}),[e.allTriples,i]);var L=["memid","eid","node_type","obj_id"];return p.a.createElement(I.a,{component:P.a,square:!0,style:{maxHeight:220}},p.a.createElement(C.a,{stickyHeader:!0,size:"small"},p.a.createElement(T.a,null,p.a.createElement(R.a,null,p.a.createElement(V,null,"Attribute"),p.a.createElement(V,null,p.a.createElement(g.a,{display:"flex",justifyContent:"space-between"},"Value",p.a.createElement(A.a,{onClick:e.onTableClose,color:"secondary",size:"small"},p.a.createElement(z.a,{fontSize:"small"})))))),p.a.createElement(x.a,{key:i},Object.keys(Object.keys(h).reduce((function(e,t){return"deleted"!==h[t].status&&(e[t]=h[t]),e}),{})).map((function(e){return p.a.createElement(U,{key:e},p.a.createElement(V,{desc:"attribute cell"},w(e,16,"right-start")),p.a.createElement(V,{desc:"value cell"},L.includes(e)?w(h[e].value,16,"right-start"):p.a.createElement(G,{attr:e,key:[h[e].value,h[e].status],value:JSON.stringify(h[e].value),updateValue:function(t){u((function(a){return Object(r.a)(Object(r.a)({},a),{},Object(o.a)({},e,Object(r.a)(Object(r.a)({},a[e]),{},{value:t})))}))},updateStatus:function(t){u((function(a){return Object(r.a)(Object(r.a)({},a),{},Object(o.a)({},e,Object(r.a)(Object(r.a)({},a[e]),{},{status:t})))}))},updateDisableSubmit:function(e){_(e?function(e){return!0}:function(e){return!1})}})))})),p.a.createElement(U,null,p.a.createElement(V,{colSpan:2,align:"center"},p.a.createElement(g.a,{display:"flex",justifyContent:"space-around"},p.a.createElement(f.a,{title:"restores values to what they were before any manual edits",placement:"bottom",interactive:!0,leaveDelay:500},p.a.createElement(A.a,{onClick:function(){e.onTableRestore(e.data.memid)},size:"small"},p.a.createElement(W.a,{fontSize:"small"}))),p.a.createElement(D.a,{variant:"contained",onClick:function(){e.onTableSubmit(Object.keys(h).reduce((function(e,t){return(L.includes(t)||"changed"===h[t].status)&&(e[t]=h[t]),e}),{}))},disabled:M},"Submit"),p.a.createElement(f.a,{title:"refreshes values to what they were when table was opened",placement:"bottom",interactive:!0,leaveDelay:500},p.a.createElement(A.a,{onClick:function(){y((function(e){return e+1}))},size:"small"},p.a.createElement(F.a,{fontSize:"small"}))))))),e.allTriples&&O.length>0&&p.a.createElement(p.a.Fragment,null,p.a.createElement(T.a,null,p.a.createElement(R.a,null,p.a.createElement(V,null,"Predicate"),p.a.createElement(V,null,p.a.createElement(g.a,{display:"flex",justifyContent:"space-between"},"Value",p.a.createElement(A.a,{onClick:e.onTableClose,color:"secondary",size:"small"},p.a.createElement(z.a,{fontSize:"small"})))))),p.a.createElement(x.a,null,O.map((function(e){return p.a.createElement(U,{key:e[0]},p.a.createElement(V,{desc:"predicate"},w(e[4],16,"right-start")),p.a.createElement(V,{desc:"value"},w(e[6],16,"right-start")))}))))))}function Q(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o={position:"absolute"},r=[a[0]+n[0],a[1]+n[1]],l=["left","top"];if(i){var c=[200,Math.min(210,42*(Object.keys(s).length-3)+128+51)];r[1]>Math.min(e,t)-c[1]&&(r[1]=Math.min(e,t)-r[1],l[1]="bottom")}return o[l[0]]=r[0],o[l[1]]=r[1],o}var K=a(88),J=a.n(K),X=Object(j.a)((function(e){return{root:{fontSize:14,fontFamily:M,width:"auto !important",maxWidth:100,overflow:"hidden"},head:{backgroundColor:e.palette.common.black,color:e.palette.common.white},body:{color:e.palette.common.black,borderBottomColor:"transparent"}}}))(O.a),Z=Object(j.a)((function(e){return{root:{"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover},"&:hover":{backgroundColor:"orange"}}}}))(R.a);function $(e){var t=Object(m.useState)(null),a=Object(n.a)(t,2),i=a[0],s=a[1];return Object(m.useEffect)((function(){e.table_visible||s(null)}),[e.table_visible]),p.a.createElement(I.a,{component:P.a,square:!0,style:{maxHeight:220}},p.a.createElement(C.a,{stickyHeader:!0,size:"small"},p.a.createElement(T.a,null,p.a.createElement(R.a,null,p.a.createElement(X,null,"Memid"),p.a.createElement(X,null,p.a.createElement(g.a,{display:"flex",justifyContent:"space-between"},"Pos",p.a.createElement(A.a,{onClick:function(t){e.onPopupClose(t)},color:"secondary",size:"small"},p.a.createElement(z.a,{fontSize:"small"})))))),p.a.createElement(x.a,{key:e.map_pos},e.data.map((function(t){return p.a.createElement(Z,{key:t.data.memid,onClick:function(){e.handleObjClick(t.type,[e.map_pos[0],e.map_pos[1]],t.data),e.selection_mode||s(t.data.memid)},style:t.data.memid===i?{backgroundColor:"orange"}:t.data.memid in e.selected_objects?{backgroundColor:"green"}:{}},p.a.createElement(X,null,p.a.createElement(g.a,{display:"flex",justifyContent:"space-between",alignItems:"center"},w(t.data.memid,12),p.a.createElement(A.a,{size:"small",disableRipple:!0},p.a.createElement(J.a,{style:{color:t.color},fontSize:"small"})))),p.a.createElement(X,null," ",JSON.stringify(t.data.pos)," "))})))))}function ee(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o={position:"absolute"},r=[t-(a[0]+n[0]),a[1]+n[1]],l=["right","top"];if(i){var c=[200,Math.min(210,32*s.length+28)];r[1]>Math.min(e,t)-c[1]&&(r[1]=Math.min(e,t)-r[1],l[1]="bottom")}return o[l[0]]=r[0],o[l[1]]=r[1],o}var te=a(377),ae=a(724),ne=a(729),ie=a(90),se=a.n(ie),oe=a(746),re=a(726),le=a(172),ce=a(743),he=a(47),ue=a(727),de=a(728),me=a(723),pe=a(169);function ge(e){var t=Object(m.useState)(e.color),a=Object(n.a)(t,2),i=a[0],s=a[1],o=Object(m.useState)(!1),r=Object(n.a)(o,2),l=r[0],c=r[1],h=Object(m.useRef)(null),u=Object(m.useRef)(null);return Object(m.useEffect)((function(){if(h.current){var e=u.current.getBoundingClientRect(),t=e.x,a=e.y,n=e.height,i=e.width;h.current.style.position="fixed",h.current.style.left=t+i/2-85+"px",h.current.style.top=a+n/2+14+"px",h.current.style.zindex=10}}),[l]),Object(m.useEffect)((function(){u.current.style.color=i}),[i]),p.a.createElement("div",null,p.a.createElement(he.a,{container:!0,spacing:2},p.a.createElement(he.a,{item:!0},p.a.createElement(J.a,{ref:u,onClick:function(){c((function(e){return!e}))}})),p.a.createElement(he.a,{item:!0},e.type," (",e.count,")")),l&&p.a.createElement(me.a,{onClickAway:function(){c(!1)}},p.a.createElement("div",{ref:h},p.a.createElement(pe.a,{color:i,colors:fe,width:170,triangle:"top",onChange:function(t){var a=t.hex;a=a.toUpperCase(),s(a),e.setNodeColoring(a)}}))))}var fe=["#F47373","#DCE775","#2CCCE4","#37D67A","#0000FF","#D9E3F0","#697689","#555555","#FF8A65","#BA68C8"],be=a(744),ve=a(730),ye=a(731),ke=a(165),Ee=a.n(ke),Me=Object(te.a)({palette:{type:"dark"}});var we=function(e){var t=p.a.useState(""),a=Object(n.a)(t,2),i=a[0],s=a[1],o=p.a.useState(0),r=Object(n.a)(o,2),l=r[0],c=r[1],h=p.a.useState(e.mapView),u=Object(n.a)(h,2),d=u[0],m=u[1];return p.a.createElement(ae.a,{theme:Me},p.a.createElement(oe.a,{anchor:"right",open:e.showMenu,onClose:e.onMenuClose},p.a.createElement("div",{style:{width:450}},p.a.createElement(he.a,{container:!0,direction:"column",spacing:3},p.a.createElement(he.a,{item:!0,key:"close-menu"},p.a.createElement(A.a,{onClick:e.onMenuClose},p.a.createElement(z.a,null)),p.a.createElement(re.a,null)),p.a.createElement(he.a,{item:!0,key:"menu-items",container:!0,direction:"column",spacing:3,style:{marginLeft:3}},p.a.createElement(he.a,{item:!0,key:"grouping-form",xs:"auto",container:!0},p.a.createElement(ue.a,{variant:"outlined"},p.a.createElement(de.a,null,p.a.createElement(he.a,{item:!0,container:!0,alignItems:"center",spacing:6},p.a.createElement(he.a,{item:!0,xs:6},p.a.createElement(B.a,{value:i,error:Object.keys(e.selected_objects).length<=1,helperText:Object.keys(e.selected_objects).length<=1?"Select multiple objects":Object.keys(e.selected_objects).length+" objects selected",placeholder:"Group Name "+(l>0?l+1:""),onChange:function(e){s(e.target.value)}})),p.a.createElement(he.a,{item:!0,xs:3},p.a.createElement(D.a,{variant:"contained",disabled:Object.keys(e.selected_objects).length<=1||!i,onClick:function(){e.onGroupSubmit({selected_objects:e.selected_objects,group_name:i}),c((function(e){return e+1})),s("")}},"Group")),p.a.createElement(he.a,{item:!0,xs:3},p.a.createElement(f.a,{title:"Group selected objects and store as 'is_a' predicate triple in memory. To select objects, use Cmd+Click or right click to start describing a selection window",interactive:!0,leaveDelay:500},p.a.createElement(se.a,null))))))),p.a.createElement(he.a,{item:!0,key:"options",container:!0,direction:"column",alignItems:"flex-start"},p.a.createElement(he.a,{item:!0,key:"toggle dyna pos",container:!0,alignItems:"center"},p.a.createElement(he.a,{item:!0},p.a.createElement(le.a,{control:p.a.createElement(ce.a,{size:"small",checked:e.dynamicPositioning,onChange:e.toggleDynamicPositioning}),label:"Dynamic Positioning",labelPlacement:"end"})),p.a.createElement(he.a,{item:!0},p.a.createElement(f.a,{title:"Enabling this makes it so any tabular component on the map automatically repositions itself to remain on screen when dragging. May reduce performance.",placement:"top",interactive:!0,leaveDelay:500},p.a.createElement(se.a,{fontSize:"small"})))),p.a.createElement(he.a,{item:!0,key:"toggle show triples"},p.a.createElement(le.a,{control:p.a.createElement(ce.a,{size:"small",checked:e.showTriples,onChange:e.toggleShowTriples}),label:"Show triples",labelPlacement:"end"})),p.a.createElement(he.a,{item:!0,key:"toggle square map"},p.a.createElement(le.a,{control:p.a.createElement(ce.a,{size:"small",checked:e.squareMap,onChange:e.toggleSquareMap}),label:"Square Map",labelPlacement:"end"}))),p.a.createElement(he.a,{item:!0,key:"change-map-view",container:!0,alignItems:"center"},p.a.createElement(he.a,{item:!0},"View:    ",p.a.createElement(ne.a,{variant:"contained"},p.a.createElement(D.a,{color:"ZX"===d?"secondary":"default",onClick:function(){e.toggleMapView("ZX"),m("ZX")}},"ZX"),p.a.createElement(D.a,{color:"XY"===d?"secondary":"default",onClick:function(){e.toggleMapView("XY"),m("XY")}},"XY"),p.a.createElement(D.a,{color:"YZ"===d?"secondary":"default",onClick:function(){e.toggleMapView("YZ"),m("YZ")}},"YZ"))),p.a.createElement(he.a,{item:!0},p.a.createElement(D.a,{onClick:e.centerToBot},"CENTER TO BOT"))),p.a.createElement(he.a,{item:!0,key:"color-picker",xs:9},p.a.createElement(be.a,{styles:{color:"#0000FF"}},p.a.createElement(ve.a,{expandIcon:p.a.createElement(Ee.a,null)},p.a.createElement(he.a,{container:!0,alignItems:"center",spacing:3},p.a.createElement(he.a,{item:!0},"Node Details"),p.a.createElement(he.a,{item:!0},p.a.createElement(f.a,{title:"List of all node types on map. Click on colored circle to change color. Click away from color picker menu to close it.",placement:"top",interactive:!0,leaveDelay:500},p.a.createElement(se.a,{fontSize:"small"}))))),Object.entries(e.nodeTypeInfo).map((function(t){var a=Object(n.a)(t,2),i=a[0],s=a[1];return p.a.createElement(ye.a,{key:i},p.a.createElement(ge,{type:i,count:s.count,color:s.color,setNodeColoring:function(t){e.setNodeColoring(i,t)}}))})))))))))},_e=a(166),Se=a.n(_e),je=["count"],Ce=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var c;return Object(l.a)(this,a),(c=t.call(this,e)).handleDrag=function(e,t){c.setState({memory2d_className:e}),t&&c.setState({drag_coordinates:t})},c.handleWheel=function(e){e.evt.preventDefault();var t=e.target.getStage(),a=t.scaleX(),n=t.getPointerPosition().x/a-t.x()/a,i=t.getPointerPosition().y/a-t.y()/a,s=e.evt.deltaY>0?1.2*a:a/1.2,o=s<1?1:s;c.setState({drag_coordinates:[-(n-t.getPointerPosition().x/o)*o,-(i-t.getPointerPosition().y/o)*o],stageScale:o,stageX:-(n-t.getPointerPosition().x/o)*o,stageY:-(i-t.getPointerPosition().y/o)*o})},c.convertGridCoordinate=function(e,t){var a=c.state,n=a.xmax,i=a.xmin,s=a.ymax,o=a.ymin,r=c.state,l=r.width,h=r.height;h=l=Math.min(l,h);var u=Math.min(n-i,s-o);return[e*u/l+i,t*u/h+o]},c.convertCoordinate=function(e){var t=c.state,a=t.xmax,n=t.xmin,i=t.ymax,s=t.ymin,o=c.state,r=o.width,l=o.height,h=o.mapView;l=r=Math.min(r,l);var u,d,m=Math.min(a-n,i-s);switch(h){case"ZX":var p=[e[2],-e[0]];u=p[0],d=p[1];break;case"XY":var g=[e[0],-e[1]];u=g[0],d=g[1];break;case"YZ":var f=[e[1],-e[2]];u=f[0],d=f[1];break;default:return console.log("invalid view"),[0,0]}u=Math.round(u),d=Math.round(d);var b=parseInt((u-n)/m*r),v=parseInt((d-s)/m*l);return[b,v=l-v]},c.handleObjClick=function(e,t,a){var n=c.state,l=n.selection_mode,h=n.selected_objects,u=n.focused_point_coords;if(["bot","detection_from_memory"].includes(e))if(l)if(a.memid in h){var d=a.memid,m=(h[d],Object(i.a)(h,[d].map(s.a)));c.setState({selected_objects:m})}else c.setState({selected_objects:Object(r.a)(Object(r.a)({},h),{},Object(o.a)({},a.memid,a))});else c.setState({table_data:a,table_visible:!0,focused_point_coords:t}),t[0]===u[0]&&t[1]===u[1]||c.setState({popup_visible:!1})},c.handlePopupClick=function(e,t){var a=c.state,n=a.selection_mode,o=a.selected_objects,l=a.focused_point_coords;if(n){var h={},u=o;t.forEach((function(e){var t=e.data;if(t.memid in o){var a=u,n=t.memid,r=(a[n],Object(i.a)(a,[n].map(s.a)));u=r}else h[t.memid]=t})),c.setState({selected_objects:Object(r.a)(Object(r.a)({},u),h)})}else c.setState({popup_data:t,popup_visible:!0,focused_point_coords:e}),e[0]===l[0]&&e[1]===l[1]||c.setState({table_visible:!1})},c.onTableClose=function(){c.setState((function(e){return Object(r.a)({table_visible:!1},!e.popup_visible&&{focused_point_coords:[null,null]})}))},c.onTableSubmit=function(e){Object.keys(e).reduce((function(t,a){return"changed"===e[a].status&&(t+=1),t}),0)>0&&c.props.stateManager.sendManualChange({type:"edit",data:e}),c.onTableClose()},c.onTableRestore=function(e){c.props.stateManager.sendManualChange({type:"restore",data:e}),c.onTableClose()},c.onPopupClose=function(){c.setState({popup_visible:!1,focused_point_coords:[null,null]}),c.onTableClose()},c.handleToggleDraw=function(e){var t=c.state,a=t.drag_coordinates,n=t.stageScale,i=t.drawing_mode;e.evt.preventDefault(),c.onTableClose(),c.onPopupClose();var s={x:(e.target.getStage().getPointerPosition().x-a[0])/n,y:(e.target.getStage().getPointerPosition().y-a[1])/n};i?c.handleDrawEnd(s):c.setState({draw_pos_start:s}),c.setState({drawing_mode:!i})},c.inDrawnBounds=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=c.state,s=i.drawing_mode,o=i.draw_pos_curr,r=i.draw_pos_start,l=Object(n.a)(e,2),h=l[0],u=l[1],d=r,m=a||o;if(!m||!d)return!1;var p={x:Math.min(d.x,m.x),y:Math.min(d.y,m.y)},g={x:Math.max(d.x,m.x),y:Math.max(d.y,m.y)};return t===s&&h>p.x&&u>p.y&&h<g.x&&u<g.y},c.handleDrawEnd=function(e){var t=c.state,a=t.bot_data,o=(t.obstacle_map,t.detections_from_memory),l=(t.xmin,t.xmax,t.ymin,t.ymax,t.width,t.height,t.selected_objects),h={},u=l;if(c.inDrawnBounds(c.convertCoordinate(a.pos),!0,e))if(a.memid in l){var d=u,m=a.memid,p=(d[m],Object(i.a)(d,[m].map(s.a)));u=p}else h[a.memid]=a;o.forEach((function(t){var a=t.pos,o=c.convertCoordinate(a),r=Object(n.a)(o,2),d=r[0],m=r[1];if(c.inDrawnBounds([d,m],!0,e))if(t.memid in l){var p=u,g=t.memid,f=(p[g],Object(i.a)(p,[g].map(s.a)));u=f}else h[t.memid]=t})),c.setState({selected_objects:Object(r.a)(Object(r.a)({},u),h)})},c.handleMouseMove=function(e){var t=c.state,a=t.drag_coordinates,n=t.stageScale,i={x:(e.target.getStage().getPointerPosition().x-a[0])/n,y:(e.target.getStage().getPointerPosition().y-a[1])/n};c.setState({draw_pos_curr:i})},c.onMenuOpen=function(){c.setState({showMenu:!0})},c.onGroupSubmit=function(e){c.props.stateManager.sendManualChange({type:"group",data:e}),c.setState({selected_objects:{}})},c.centerToBot=function(){var e=c.state,t=e.height,a=e.width,i=e.bot_data;e.squareMap&&(a=Math.min(a,t),t=a);var s=c.convertCoordinate(i.pos),o=Object(n.a)(s,2),r=o[0],l=o[1];c.setState({drag_coordinates:[a/2-r,t/2-l],stageScale:1},(function(){c.stage_ref.current.setAttrs({x:a/2-r,y:t/2-l})}))},c.initialState={height:400,width:600,isLoaded:!1,memory:null,triples:null,detections_from_memory:[],xmin:-10,xmax:10,ymin:-10,ymax:10,bot_xyz:[0,0,0],bot_data:null,tooltip:null,stageScale:1,stageX:0,stageY:0,memory2d_className:"memory2d",drag_coordinates:[0,0],enlarge_bot_marker:!1,focused_point_coords:[null,null],table_data:null,table_visible:!1,popup_data:null,popup_visible:!1,map_update_count:0,selection_mode:!1,drawing_mode:!1,draw_pos_curr:null,draw_pos_start:null,selected_objects:{},group_name:"",grouping_count:0,showMenu:!1,dynamicPositioning:!1,showTriples:!1,mapView:"ZX",squareMap:!1,nodeColorings:b},c.state=c.initialState,c.outer_div=p.a.createRef(),c.stage_ref=p.a.createRef(),c.resizeHandler=c.resizeHandler.bind(Object(h.a)(c)),c}return Object(c.a)(a,[{key:"resizeHandler",value:function(){if(this.props.isMobile){var e=this.props.dimensions;(void 0!==e&&e!==this.state.height||void 0!==e&&e!==this.state.width)&&this.setState({height:e,width:e})}else if(null!=this.outer_div&&null!=this.outer_div.current){var t=this.outer_div.current,a=t.clientHeight,n=t.clientWidth;(void 0!==a&&a!==this.state.height||void 0!==n&&n!==this.state.width)&&this.setState({height:a,width:n})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.bot_xyz,n=this.state,i=n.xmin,s=n.xmax,o=n.ymin,r=n.ymax,l=a[0],c=a[1],h=!1;l<i&&(i=l,h=!0),l>s&&(s=l,h=!0),c<o&&(o=c,h=!0),c>r&&(r=c,h=!0),h&&this.setState({xmin:i,ymin:o,xmax:s,ymax:r}),this.resizeHandler()}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return p.a.createElement("p",null,"Loading");var t=this.state,a=t.height,s=t.width,l=t.memory,c=t.detections_from_memory,h=t.bot_data,u=t.obstacle_map,d=t.tooltip,m=t.drag_coordinates,g=t.stageScale,f=t.enlarge_bot_marker,b=t.table_data,w=t.table_visible,j=t.popup_data,C=t.popup_visible,x=t.dynamicPositioning,O=t.showTriples,I=t.focused_point_coords,T=t.map_update_count,R=t.selected_objects,P=t.draw_pos_start,D=t.draw_pos_curr,N=t.drawing_mode,F=t.mapView,L=t.squareMap,W=t.nodeColorings;L&&(s=Math.min(s,a),a=s);var H=l.objects,z=this.state,B=z.xmin,V=z.xmax,U=z.ymin,q=z.ymax;if(0===a&&0===s)return p.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});if(!this.props.stateManager.dash_enable_map||!this.props.stateManager.agent_enable_map)return p.a.createElement("p",null,"Map Disabled");var G=[],K=0,J={},X={};u&&u.forEach((function(e){var t=parseInt((e[0]-B)/(V-B)*s)+","+parseInt((e[1]-U)/(q-U)*a),n={type:"obstacle_map",radius:2,color:"#827f7f",data:{memid:"don't edit "+t,x:e[0],y:e[1],pos:"["+e[0]+",0,"+e[1]+"]"}};t in J?J[t].push(n):J[t]=[n]})),c.forEach((function(t){var a=t.pos,s=t.node_type,o=s&&W[s]?W[s]:"0000FF",l=e.convertCoordinate(a),c=Object(n.a)(l,2),h=c[0]+","+c[1],u={type:"detection_from_memory",radius:6,color:o,data:t};if(h in J?J[h].push(u):J[h]=[u],s)if(s in X){var d=X[s],m=d.count,p=Object(i.a)(d,je);X[s]=Object(r.a)({count:m+1},p)}else X[s]={count:1,color:o}})),void 0!==H&&void 0!==H.forEach&&H.forEach((function(t,a,i){var s,o=S.a[Math.abs((s=t.label,s.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)))%10],r=t.xyz,l=e.convertCoordinate(r),c=Object(n.a)(l,2),h=c[0],u=c[1];G.push(p.a.createElement(_.Circle,{key:K++,radius:3,x:h,y:u,fill:o,onMouseOver:function(e){e.currentTarget.setRadius(6)},onMouseOut:function(e){e.currentTarget.setRadius(3)},perfectDrawEnabled:!1})),G.push(p.a.createElement(_.Text,{key:K++,text:t.label,x:h,y:u,fill:o,fontSize:10,perfectDrawEnabled:!1}))})),Object.entries(J).forEach((function(t){var a=Object(n.a)(t,2),i=a[0],s=a[1],o=i.split(","),r=Object(n.a)(o,2),l=r[0],c=r[1];l=parseInt(l),c=parseInt(c);var h=e.inDrawnBounds([l,c])||l===I[0]&&c===I[1];if(1===s.length){var u=s[0];G.push(p.a.createElement(_.Circle,{key:u.data.memid,x:l,y:c,radius:h?1.5*u.radius:u.radius,fill:u.data.memid in R?"green":u.color,onClick:function(t){0===t.evt.button&&e.handleObjClick(u.type,[l,c],u.data)},perfectDrawEnabled:!1}))}else{var d=s.length,m=new Set,g=[];s.forEach((function(e){e.data.node_type&&m.add(e.data.node_type),g.push(e)}));var f=s.some((function(e){return e.data.memid in R})),b=[];Array.from(m).forEach((function(e,t){b.push((t/Math.max(1,m.size-1)).toFixed(2)),b.push(W[e])})),G.push(p.a.createElement(_.Group,{key:i,x:l,y:c,onClick:function(t){0===t.evt.button&&e.handlePopupClick([l,c],g)}},p.a.createElement(_.Circle,{x:0,y:0,radius:h?9:6,fillRadialGradientColorStops:f?[0,"green"]:b,fillRadialGradientStartPoint:{x:0,y:0},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:0,y:0},fillRadialGradientEndRadius:h?9:6,stroke:"black",strokeWidth:1,perfectDrawEnabled:!1}),p.a.createElement(_.Text,{x:d>9?-5:-3,y:d>9?-5:-3,width:d>9?10:6,height:d>9?10:6,text:d>9?"9+":d,fontSize:d>9?8:10,fontFamily:M,fill:"black",align:"center",verticalAlign:"middle",perfectDrawEnabled:!1})))}}));var Z=this.convertCoordinate(h.pos),te=Object(n.a)(Z,2),ae=te[0],ne=te[1],ie=h.yaw;G.push(p.a.createElement(_.Group,{key:h.memid,x:ae,y:ne,onClick:function(t){0===t.evt.button&&e.handleObjClick("bot",[ae,ne],h)},onMouseOver:function(t){e.setState({enlarge_bot_marker:!0})},onMouseOut:function(t){e.setState({enlarge_bot_marker:!1})}},p.a.createElement(_.Circle,{key:K++,radius:f||this.inDrawnBounds([ae,ne])||ae===I[0]&&ne===I[1]?15:10,fill:h.memid in R?"green":"red",perfectDrawEnabled:!1}),p.a.createElement(_.Line,{key:K++,points:f||this.inDrawnBounds([ae,ne])||ae===I[0]&&ne===I[1]?[0,0,18,0]:[0,0,12,0],rotation:180*-ie/Math.PI,stroke:"black",strokeWidth:f||this.inDrawnBounds([ae,ne])||ae===I[0]&&ne===I[1]?1.5:1,perfectDrawEnabled:!1})));for(var se=[],oe=0;oe<s/10;oe++){var re=m[0]%(10*g)+Math.round(10*oe*g-m[0])+.5;se.push(p.a.createElement(_.Line,{key:12344+oe,points:[re/g,(0-m[1])/g,re/g,(a-m[1])/g],stroke:"#f5f5f5",strokeWidth:1}))}for(K=0;K<a/10;K++){var le=m[1]%(10*g)+Math.round(10*K*g-m[1]);se.push(p.a.createElement(_.Line,{key:12344+oe+K,points:[(0-m[0])/g,le/g,(s-m[0])/g,le/g],stroke:"#ddd",strokeWidth:.5}))}for(var ce=[],he=[v[0],a-v[1]],ue=(he[0]-m[0])/g,de=(he[1]-m[1])/g,me=this.convertGridCoordinate(ue,de),pe=.5/g,ge=p.a.createElement(_.Line,{key:"axesHorz",points:[0,0,(s-he[0]-20)/g,0],x:ue,y:de,stroke:"#AAAAAA",strokeWidth:pe}),fe=p.a.createElement(_.Line,{key:"axesVert",points:[0,(20-he[1])/g,0,0],x:ue,y:de,stroke:"#AAAAAA",strokeWidth:pe}),be=[],ve=he[0],ye=he[1];ve<s-(20+y[0]);){ve+=y[0];var ke=this.convertGridCoordinate((ve-m[0])/g,0);be.push(p.a.createElement(_.Text,{key:"textCoordinateX-"+ve,text:ke[0].toFixed(2),fontSize:10/g,x:(ve-k[0]-m[0])/g,y:(he[1]-k[1]-m[1])/g,fill:"#AAAAAA"})),be.push(p.a.createElement(_.Line,{key:"coordinateX-"+ve,points:[0,-3/g,0,3/g],x:(ve-m[0])/g,y:de,stroke:"#AAAAAA",strokeWidth:pe}))}for(;ye>20+y[1];){ye-=y[1];var Ee=this.convertGridCoordinate(0,(ye-m[1])/g);be.push(p.a.createElement(_.Text,{key:"textCoordinateY-"+ye,text:Ee[1].toFixed(2),fontSize:10/g,x:(he[0]-E[0]-m[0])/g,y:(ye-E[1]-m[1])/g,fill:"#AAAAAA"})),be.push(p.a.createElement(_.Line,{key:"coordinateY-"+ye,points:[-3/g,0,3/g,0],x:ue,y:(ye-m[1])/g,stroke:"#AAAAAA",strokeWidth:pe}))}var Me=[(he[0]-25-m[0])/g,(he[1]+10-m[1])/g];be.push(p.a.createElement(_.Text,{key:"root-text",fill:"#AAAAAA",text:"".concat(me[1].toFixed(2),", ").concat(me[0].toFixed(2)),fontSize:10/g,x:Me[0],y:Me[1]}));var _e=[35,2];be.push(p.a.createElement(_.Text,{key:"vert-axis-text",fill:"#AAAAAA",text:"ZX"===F?"x":"XY"===F?"y":"z",fontSize:18/g,x:(_e[0]-m[0])/g,y:(_e[1]-m[1])/g}));var Ce=[s-15,a-35];return be.push(p.a.createElement(_.Text,{key:"horz-axis-text",fill:"#AAAAAA",text:"ZX"===F?"z":"XY"===F?"x":"y",fontSize:18/g,x:(Ce[0]-m[0])/g,y:(Ce[1]-m[1])/g})),ce.push(fe,ge,be),p.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%",position:"relative"},onKeyDown:function(t){["Meta","Command","Ctrl"].includes(t.key)&&e.setState({selection_mode:!0});["Escape","Esc"].includes(t.key)&&(e.setState({selection_mode:!1,drawing_mode:!1,draw_pos_start:null}),e.onTableClose(),e.onPopupClose())},onKeyUp:function(){e.setState({selection_mode:!1})},tabIndex:"0",onMouseDown:function(t){1===t.button&&e.setState((function(e){return{showMenu:!e.showMenu}}))}},p.a.createElement("div",{style:Object(r.a)({position:"absolute"},this.state.drawing_mode&&{cursor:"crosshair"})},p.a.createElement(_.Stage,{draggable:!0,className:this.state.memory2d_className,ref:this.stage_ref,width:s,height:a,onWheel:this.handleWheel,scaleX:g,scaleY:g,x:this.state.stageX,y:this.state.stageY,onDragMove:function(t){return e.handleDrag("memory2d dragging-memory2d",[t.target.attrs.x,t.target.attrs.y])},onDragEnd:function(t){return e.handleDrag("memory2d",[t.target.attrs.x,t.target.attrs.y])},onContextMenu:function(t){e.handleToggleDraw(t)},onMouseMove:function(t){e.handleMouseMove(t)}},p.a.createElement(_.Layer,{className:"gridLayer"},se),p.a.createElement(_.Layer,{className:"coordinateAxesLayer"},ce),p.a.createElement(_.Layer,{className:"renderedObjects",key:T},G),p.a.createElement(_.Layer,null,p.a.createElement(_.Text,{text:d,offsetX:-12,offsetY:-12,visible:null!==d,shadowEnabled:!0})),p.a.createElement(_.Layer,{className:"dragToGroup"},p.a.createElement(_.Shape,{sceneFunc:function(e,t){if(N){var a=parseInt(D.x),n=parseInt(D.y),i=parseInt(P.x),s=parseInt(P.y);e.clearRect(0,0,t.width,t.height),e.beginPath(),e.rect(i,s,a-i,n-s),e.fillStrokeShape(t)}},fill:"transparent",stroke:"black",strokeWidth:4/g,perfectDrawEnabled:!1})))),C&&p.a.createElement("div",{style:ee(this.state.height,this.state.width,I,m,x,x&&j)},p.a.createElement($,{data:j,map_pos:I,onPopupClose:this.onPopupClose,handleObjClick:this.handleObjClick,table_visible:w,selection_mode:this.state.selection_mode,selected_objects:R})),w&&p.a.createElement("div",{style:Q(this.state.height,this.state.width,I,m,x,x&&b)},p.a.createElement(Y,{data:b,onTableClose:this.onTableClose,onTableSubmit:this.onTableSubmit,onTableRestore:this.onTableRestore,allTriples:O&&this.state.triples})),p.a.createElement("div",{style:{position:"absolute",right:this.state.width-s,top:"-0.1%"}},p.a.createElement(A.a,{size:"small",disableRipple:!0,onClick:this.onMenuOpen},p.a.createElement(Se.a,null))),p.a.createElement(we,{showMenu:this.state.showMenu,onMenuClose:function(){e.setState({showMenu:!1})},selected_objects:R,onGroupSubmit:this.onGroupSubmit,dynamicPositioning:x,toggleDynamicPositioning:function(){e.setState((function(e){return{dynamicPositioning:!e.dynamicPositioning}}))},showTriples:O,toggleShowTriples:function(){e.setState((function(e){return{showTriples:!e.showTriples}}))},mapView:this.state.mapView,toggleMapView:function(t){e.setState({mapView:t},(function(){e.centerToBot()}))},centerToBot:this.centerToBot,squareMap:L,toggleSquareMap:function(){e.setState((function(e){return{squareMap:!e.squareMap}}))},nodeTypeInfo:X,setNodeColoring:function(t,a){e.setState((function(e){return{nodeColorings:Object(r.a)(Object(r.a)({},e.nodeColorings),{},Object(o.a)({},t,a))}}))}}))}}]),a}(p.a.Component);t.a=Ce},53:function(e,t,a){"use strict";function n(e){return(e=e.replace(/_/g," ")).replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function i(e,t){var a=JSON.parse(t),i=function(e){var t=[];for(var a in e)"logical_form"===a?t.push({event:n(a),description:JSON.stringify(e[a])}):t.push({event:n(a),description:e[a]});return t}(a);e.memory.timelineDetails=i,e.updateTimelineResults();var s={title:n(a.name),cssClass:"scrollable",type:"react-component",component:"TimelineDetails",props:{stateManager:e}};e.dashboardLayout.root.getItemsById("timelineDetails")[0].addChild(s)}a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}))},55:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=a(20),h=a(2),u=(a(187),a(188),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={selectedTags:e.tags||[],suggestions:[],currentValue:""},i.inputRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"tag-selector"},l.a.createElement("div",{className:"tag-holder"},this.state.selectedTags.map((function(t,a){return l.a.createElement("span",{className:"tag-selected",key:a},t,l.a.createElement("button",{onClick:function(){e.removeTag(t)}},"X"))}))),l.a.createElement("input",{type:"text",placeholder:"Tags (press Enter to add)",ref:this.inputRef,onChange:this.update.bind(this),onKeyDown:this.keyDown.bind(this)}),l.a.createElement("div",{className:"tag-suggestions"},this.state.suggestions.map((function(t,a){return l.a.createElement("span",{kkey:a},l.a.createElement("button",{onClick:function(){e.addTag(t)}},a))}))))}},{key:"update",value:function(e){var t=this,a=this.inputRef.current.value;0!==a.length?this.setState({suggestions:this.props.tags.filter((function(e){return e.toLowerCase().slice(0,a.length)===a&&-1===t.state.selectedTags.indexOf(e)}))}):this.setState({suggestions:[]})}},{key:"removeTag",value:function(e){var t=this;this.setState({selectedTags:this.state.selectedTags.filter((function(t){return t!==e}))},(function(){t.props.update(t.state.selectedTags)}))}},{key:"addTag",value:function(e){var t=this;e=e.toLowerCase(),this.setState({selectedTags:this.state.selectedTags.concat(e),suggestions:[]},(function(){t.props.update(t.state.selectedTags)})),this.inputRef.current.value=""}},{key:"keyDown",value:function(e){"Enter"===e.key&&""!==this.inputRef.current.value.trim()&&this.addTag(this.inputRef.current.value),this.setState({currentValue:this.inputRef.current.value})}}]),a}(l.a.Component)),d=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).tags=i.props.tags||[],i.submit=i.submit.bind(Object(h.a)(i)),i.nameRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return this.props.isMobile?l.a.createElement("div",{className:"data-entry-root",style:{top:this.props.y+"px",left:this.props.x+"px"}},l.a.createElement("input",{placeholder:"Object Name",ref:this.nameRef,defaultValue:this.props.label||""}),l.a.createElement(u,{tags:this.tags,update:function(t){return e.tags=t}}),this.props.includeSubmitButton?l.a.createElement("button",{className:"data-entry-submit",onClick:this.submit},"Submit"):null,this.props.deleteCallback?l.a.createElement("button",{className:"data-entry-delete",onClick:this.props.deleteCallback},"Delete object (\u232b)"):null):l.a.createElement("div",{className:"data-entry-root",style:{top:this.props.y+"px",left:this.props.x+"px",position:"fixed"}},l.a.createElement("input",{placeholder:"Object Name",ref:this.nameRef,defaultValue:this.props.label||""}),l.a.createElement(u,{tags:this.tags,update:function(t){return e.tags=t}}),this.props.includeSubmitButton?l.a.createElement("button",{className:"data-entry-submit",onClick:this.submit},"Submit"):null,this.props.deleteCallback?l.a.createElement("button",{className:"data-entry-delete",onClick:this.props.deleteCallback},"Delete object (\u232b)"):null)}},{key:"submit",value:function(){var e=this.nameRef.current.value.trim();0!==e.length?this.tags.length<2?alert("Please enter at least 2 descriptive tags for the object. Examples include: color, shape, size, orientation, etc."):this.props.onSubmit({name:e.toLowerCase(),tags:this.tags}):alert("You must enter the object's name")}}]),a}(l.a.Component),m=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={message:""},i.update=i.update.bind(Object(h.a)(i)),i.drawPointsAndLines=i.drawPointsAndLines.bind(Object(h.a)(i)),i.onClick=i.onClick.bind(Object(h.a)(i)),i.addHandler=i.addHandler.bind(Object(h.a)(i)),i.addMaskHandler=i.addMaskHandler.bind(Object(h.a)(i)),i.addPointHandler=i.addPointHandler.bind(Object(h.a)(i)),i.deleteHandler=i.deleteHandler.bind(Object(h.a)(i)),i.deleteMaskHandler=i.deleteMaskHandler.bind(Object(h.a)(i)),i.deletePointHandler=i.deletePointHandler.bind(Object(h.a)(i)),i.changeTextHandler=i.changeTextHandler.bind(Object(h.a)(i)),i.zoomIn=i.zoomIn.bind(Object(h.a)(i)),i.zoomOut=i.zoomOut.bind(Object(h.a)(i)),i.onMouseMove=i.onMouseMove.bind(Object(h.a)(i)),i.keyDown=i.keyDown.bind(Object(h.a)(i)),i.drawPoint=i.drawPoint.bind(Object(h.a)(i)),i.drawLine=i.drawLine.bind(Object(h.a)(i)),i.localToImage=i.localToImage.bind(Object(h.a)(i)),i.imageToLocal=i.imageToLocal.bind(Object(h.a)(i)),i.shiftViewBy=i.shiftViewBy.bind(Object(h.a)(i)),i.mode=i.props.mode||"default",i.prevMode="default",i.baseMode="default",i.message="",i.currentMaskId=0,i.isDrawingPolygon=!1,i.lastMouse={x:0,y:0},i.points=[[]],i.regions=[],i.newMask="drawing"===i.props.mode,i.canvasRef=l.a.createRef(),i.dataEntryRef=l.a.createRef(),i.zoomPixels=300,i.zoomed=!1,i.pointSize=10,i.color=i.props.color,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.points=this.props.masks?this.props.masks.map((function(t){return t.map((function(t){return{x:t.x*e.canvas.width,y:t.y*e.canvas.height}}))})).filter((function(e){return e})):[[]],this.img=this.props.img,this.Offset={x:0,y:0},this.baseScale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height),this.scale=this.baseScale,this.update()}},{key:"render",value:function(){var e=this,t="500px";this.props.imageWidth&&(t=this.props.imageWidth);var a=0,n=0;return this.props.isMobile?(a=this.canvas&&this.canvas.getBoundingClientRect().left,n=this.canvas&&this.canvas.getBoundingClientRect().bottom+50):(a=this.canvas&&this.canvas.getBoundingClientRect().right,n=this.canvas&&this.canvas.getBoundingClientRect().top+this.canvas.height/3),l.a.createElement("div",null,l.a.createElement("p",null,this.state.message),l.a.createElement("div",null,l.a.createElement("button",{onClick:this.addHandler},l.a.createElement("span",{role:"img","aria-label":"Plus"},"\u2795")," ","(a)"),l.a.createElement("button",{onClick:this.deleteHandler},l.a.createElement("span",{role:"img","aria-label":"Trash"},"\ud83d\uddd1\ufe0f")," ","(d)"),l.a.createElement("button",{onClick:this.zoomIn},l.a.createElement("span",{role:"img","aria-label":"Magnifying Glass Right"},"\ud83d\udd0e")," ","(=)"),l.a.createElement("button",{onClick:this.zoomOut},l.a.createElement("span",{role:"img","aria-label":"Magnifying Glass Left"},"\ud83d\udd0d")," ","(-)"),l.a.createElement("button",{onClick:this.dataEntryRef.current&&this.dataEntryRef.current.submit},l.a.createElement("span",{role:"img","aria-label":"Save"},"\ud83d\udcbe")," ","(\u21b5)")),l.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},l.a.createElement("canvas",{ref:this.canvasRef,width:t,height:t,tabIndex:"0",onClick:this.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}),this.props.isMobile&&l.a.createElement("button",{onClick:this.pressEnterOnMobile.bind(this)},"Finished with ",this.props.object,"'s label"),l.a.createElement("div",null,l.a.createElement(d,{ref:this.dataEntryRef,x:a,y:n,onSubmit:this.changeTextHandler,isMobile:this.props.isMobile,label:this.props.object,tags:this.props.tags,deleteCallback:function(){return e.props.deleteLabelHandler()}}))))}},{key:"update",value:function(){this.resetImage(this.zoomed),this.updateMessage();var e=["dragging","focus"].includes(this.mode);this.drawPointsAndLines(e),this.drawRegions(e),"Enter"===this.lastKey&&this.points[this.currentMaskId]&&this.points[this.currentMaskId].length>=3&&(this.zoomed=!1,this.resetImage(this.zoomed),this.drawPointsAndLines(),this.drawRegions())}},{key:"onClick",value:function(e){if("dragging"===this.mode){var t=this.prevMode;return this.prevMode=this.mode,this.mode=t,void this.update()}var a=this.getPointClick();if(null!=a){if("adding"===this.mode&&this.addPointHandler(),"deleting"===this.mode&&this.deletePointHandler(),["addingMask"].includes(this.mode)&&a[0]!==this.currentMaskId)return;if("addingPoint"===this.mode){var n=this.points[a[0]].slice();n.splice(a[1],0,n[a[1]]),this.points[a[0]]=n}return"deletingPoint"===this.mode&&this.points[a[0]].length>3?(this.points[a[0]].length>3&&this.points[a[0]].splice(a[1],1),void this.update()):(this.prevMode=this.mode,this.mode="dragging",this.draggingIndex=a,this.currentMaskId=a[0],void this.update())}if("adding"===this.mode&&this.addMaskHandler(),["drawing","addingMask"].includes(this.mode)&&("Enter"!==this.lastKey||["drawing","addingMask"].includes(this.prevMode)||this.points[this.currentMaskId]&&this.points[this.currentMaskId].length<3))return this.points[this.currentMaskId].push(this.localToImage(this.lastMouse)),this.updateZoom(),this.update(),void(this.lastKey="Mouse");var i=this.getRegionClick();if("default"!==this.mode){if("focus"===this.mode)return-1===i&&(this.prevMode=this.mode,this.mode="default",this.currentMaskId=-1),this.update(),void(this.lastKey="Mouse");if(["deletingMask","deleting"].includes(this.mode)){if(-1===i)return;return"deleting"===this.mode&&this.deleteMaskHandler(),1===this.points.length&&this.props.deleteLabelHandler(),this.points.splice(i,1),this.update(),void(this.lastKey="Mouse")}}else-1!==i&&(this.prevMode=this.mode,this.mode="focus",this.currentMaskId=i,this.update(),this.lastKey="Mouse")}},{key:"keyDown",value:function(e){switch(e.key){case" ":this.points[this.currentMaskId].length>0&&this.points[this.currentMaskId].pop(),this.update();break;case"a":this.addHandler();break;case"s":this.addMaskHandler();break;case"q":this.addPointHandler();break;case"d":this.deleteHandler();break;case"f":this.deleteMaskHandler();break;case"e":this.deletePointHandler();break;case"Backspace":this.props.deleteLabelHandler();break;case"Enter":"Enter"===this.lastKey&&this.points[this.currentMaskId]&&this.points[this.currentMaskId].length>=3&&(this.lastKey=null,this.baseMode="default",this.prevMode=this.mode,this.mode="default",this.save()),["adding","addingMask","addingPoint","deleting","deletingMask","deletingPoint"].includes(this.mode)&&this.points[this.currentMaskId]&&this.points[this.currentMaskId].length>=3&&(this.baseMode="default",this.prevMode=this.mode,this.mode="default");break;case"Escape":if(this.points[this.currentMaskId]){if(this.points[this.currentMaskId].length>=3)return this.save(),this.mode="default",void this.props.exitCallback();if(1===this.points.length)return void this.props.deleteLabelHandler();this.points.splice(this.currentMaskId,1),this.currentMaskId=0,this.prevMode=this.mode,this.mode="default"}break;case"=":this.zoomIn(),this.update();break;case"-":this.zoomOut(),this.update()}this.lastKey=e.key}},{key:"addHandler",value:function(){this.baseMode="default",this.prevMode=this.mode,this.mode="adding"}},{key:"addMaskHandler",value:function(){!this.points[this.currentMaskId]||this.points[this.currentMaskId].length<3||(this.currentMaskId=this.points.length,this.points.push([]),this.prevMode=this.mode,this.mode="addingMask")}},{key:"addPointHandler",value:function(){this.baseMode=this.points[this.currentMaskId]&&0===this.points[this.currentMaskId].length?"default":this.mode,this.prevMode=this.mode,this.mode="addingPoint"}},{key:"deleteHandler",value:function(){this.baseMode="default",this.prevMode=this.mode,this.mode="deleting"}},{key:"deleteMaskHandler",value:function(){!this.points[this.currentMaskId]||this.points[this.currentMaskId].length<3||(this.prevMode=this.mode,this.mode="deletingMask")}},{key:"deletePointHandler",value:function(){this.baseMode=["drawing","addingMask"].includes(this.mode)?this.mode:"default",this.prevMode=this.mode,this.mode="deletingPoint"}},{key:"changeTextHandler",value:function(e){!this.points[this.currentMaskId]||this.points[this.currentMaskId].length<3||(this.save(),this.props.dataEntrySubmit(e))}},{key:"zoomIn",value:function(){this.zoomPixels-=10,this.updateZoom()}},{key:"zoomOut",value:function(){this.zoomPixels+=10,this.updateZoom()}},{key:"updateMessage",value:function(){var e="";switch(this.mode){case"adding":e="Click a point to duplicate it (q) or click anywhere else to create a new mask for this object (s)";break;case"addingMask":e="Create a new mask for this object";break;case"addingPoint":e="Click a point to duplicate it and place it where you want";break;case"deleting":e="Click a point to delete it (e) or click a mask to delete it (f)";break;case"deletingMask":e="Select which mask to delete";break;case"deletingPoint":e="Select a point to delete";break;default:e="Please trace the "+(this.props.object||"object")}e!==this.state.message&&this.setState({message:e})}},{key:"updateZoom",value:function(){if(this.zoomed=!0,this.scale=Math.min(this.canvas.width/this.zoomPixels,this.canvas.height/this.zoomPixels),-1!==this.currentMaskId&&this.points[this.currentMaskId]&&0!==this.points[this.currentMaskId].length&&["default","dragging","drawing","addingMask"].includes(this.mode)){var e=this.points[this.currentMaskId];this.Offset={x:-(e[e.length-1].x-this.zoomPixels/2)*this.scale,y:-(e[e.length-1].y-this.zoomPixels/2)*this.scale}}}},{key:"onMouseMove",value:function(e){var t=this.canvas.getBoundingClientRect();this.lastMouse={x:e.clientX-t.left,y:e.clientY-t.top+1},"dragging"===this.mode&&(this.points[this.draggingIndex[0]][this.draggingIndex[1]]=this.localToImage(this.lastMouse)),this.update()}},{key:"pressEnterOnMobile",value:function(){this.lastKey=null,this.props.submitCallback(this.points)}},{key:"save",value:function(){var e=this;this.props.submitCallback(this.points.map((function(t){return t.map((function(t){return{x:t.x/e.canvas.width,y:t.y/e.canvas.height}}))})),this.newMask)}},{key:"getPointClick",value:function(){for(var e=0;e<this.points.length;e++)for(var t=0;t<this.points[e].length;t++)if(this.distance(this.points[e][t],this.localToImage(this.lastMouse))<this.pointSize/2)return[e,t];return null}},{key:"getRegionClick",value:function(){for(var e=-1,t=0;t<this.regions.length;t++)this.regions[t]&&this.ctx.isPointInPath(this.regions[t],this.lastMouse.x,this.lastMouse.y)&&(e=t);return e}},{key:"drawPointsAndLines",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;t<this.points.length;t++)if((!0!==e||t===this.currentMaskId)&&this.points[t]&&0!==this.points[t].length){for(var a=0;a<this.points[t].length-1;a++)this.drawLine(this.points[t][a],this.points[t][a+1]),this.drawPoint(this.points[t][a]);this.drawPoint(this.points[t][this.points[t].length-1]),["drawing","addingMask"].includes(this.mode)||["drawing","addingMask"].includes(this.prevMode)||this.drawLine(this.points[t][0],this.points[t][this.points[t].length-1])}this.points[this.currentMaskId]&&this.points[this.currentMaskId].length>0&&["drawing","addingMask"].includes(this.mode)&&this.drawLine(this.points[this.currentMaskId][this.points[this.currentMaskId].length-1],this.localToImage(this.lastMouse))}},{key:"drawRegions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.regions=[];for(var t=0;t<this.points.length;t++)if(!e||t===this.currentMaskId){var a=this.drawRegion(this.points[t]);this.regions.push(a)}}},{key:"drawPoint",value:function(e){this.ctx.fillStyle="detector"===this.props.originType?"white":"black",this.distance(e,this.localToImage(this.lastMouse))<this.pointSize/2&&(this.ctx.fillStyle="green"),this.ctx.fillRect(e.x-2.5,e.y-2.5,5,5)}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle="detector"===this.props.originType?"white":"black",this.ctx.stroke()}},{key:"drawRegion",value:function(e){if(e&&!(e.length<3)){var t=new Path2D;t.moveTo(e[0].x,e[0].y);for(var a=1;a<e.length;a++)t.lineTo(e[a].x,e[a].y);return t.closePath(),this.ctx.fillStyle=this.color,this.ctx.fill(t,"evenodd"),t}}},{key:"localToImage",value:function(e){var t,a;return this.zoomed?(t=(e.x-this.Offset.x)/this.scale,a=(e.y-this.Offset.y)/this.scale):(t=e.x/this.baseScale,a=e.y/this.baseScale),{x:Math.min(Math.max(t,0),512),y:Math.min(Math.max(a,0),512)}}},{key:"imageToLocal",value:function(e){var t=this.zoomed?this.scale:this.baseScale,a=this.zoomed?this.Offset.x:0,n=this.zoomed?this.Offset.y:0;return{x:e.x*t+a,y:e.y*t+n}}},{key:"resetView",value:function(){this.Offset={x:0,y:0},this.scale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height)}},{key:"resetImage",value:function(e){this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e?this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y):(this.ctx.setTransform(this.baseScale,0,0,this.baseScale,0,0),this.zoomed=!1),this.ctx.drawImage(this.img,0,0)}},{key:"shiftViewBy",value:function(e,t){this.Offset={x:this.Offset.x+e,y:this.Offset.y+t}}},{key:"distance",value:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},{key:"distanceToSegment",value:function(e,t,a){var n=this.distance(t,a);if(0===n)return this.distance(e,t);var i=((e.x-t.x)*(a.x-t.x)+(e.y-t.y)*(a.y-t.y))/n;i=Math.max(0,Math.min(1,i));var s={x:t.x+i*(a.x-t.x),y:t.y+i*(a.y-t.y)};return this.distance(e,s)}}]),a}(l.a.Component),p=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).update=i.update.bind(Object(h.a)(i)),i.onClick=i.onClick.bind(Object(h.a)(i)),i.regions={},i.canvasRef=l.a.createRef(),i.imgRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.Offset={x:0,y:0},this.baseScale=this.canvas.width/this.props.img.width,this.scale=this.baseScale,this.canvas.height=this.props.img.height*this.baseScale,this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"render",value:function(){var e="500px";return this.props.imageWidth&&(e=this.props.imageWidth),this.props.isFromCamera&&this.props.displayImage?l.a.createElement("div",null,l.a.createElement("img",{src:this.props.img.src}),l.a.createElement("canvas",{ref:this.canvasRef,width:e,height:e,tabIndex:"0",onMouseMove:this.onMouseMove,onKeyDown:this.keyDown})):l.a.createElement("div",null,l.a.createElement("canvas",{ref:this.canvasRef,width:e,height:e,tabIndex:"0",onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){var e=this;this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.props.img,0,0);for(var t=0;t<this.props.objects.length;t++){var a=this.props.objects[t],n=this.props.pointMap[a];if(0!==n.length){this.regions[a]=[];var i=this.props.colors[t%this.props.colors.length]||"rgba(0,200,0,.5)",s="detector"===this.props.originTypeMap[a]?"white":"black";for(var o in n){var r=n[o].map((function(t){return{x:t.x*e.canvas.width,y:t.y*e.canvas.height}})),l=this.drawRegionsAndLines(r,i,s);this.regions[a].push(l)}}}this.canvas.addEventListener("mousedown",this.onClick)}},{key:"onClick",value:function(e){var t=-1;for(var a in this.regions)for(var n in this.regions[a])this.regions[a][n]&&this.ctx.isPointInPath(this.regions[a][n],e.offsetX,e.offsetY)&&(t=a);var i=-1!==t;this.props.onClick(e.clientX,e.clientY,i,t)}},{key:"drawRegionsAndLines",value:function(e,t,a){if(!(e.length<3)){var n=new Path2D;n.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)n.lineTo(e[i].x,e[i].y),this.drawLine(e[i-1],e[i],a);return this.drawLine(e[0],e[e.length-1],a),n.closePath(),this.ctx.fillStyle=t,this.ctx.fill(n,"evenodd"),n}}},{key:"drawLine",value:function(e,t,a){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=a,this.ctx.stroke()}},{key:"getCanvasBoundingBox",value:function(){return this.canvas.getBoundingClientRect()}}]),a}(l.a.Component),g=["rgba(0,200,0,.5)","rgba(200,0,0,.5)","rgba(0,100,255,.5)","rgba(255,150,0,.5)","rgba(100,255,200,.5)","rgba(200,200,0,.5)","rgba(0,200,150,.5)","rgba(200,0,200,.5)","rgba(0,204,255,.5)"],f=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;Object(n.a)(this,a);var s=(i=t.call(this,e)).props.objects;return i.props.objects||(s=i.props.stateManager.curFeedState.objects),null===s&&(s=[]),i.props.isFromCamera&&(s=[]),i.state={objectIds:Object(c.a)(Array(s.length).keys()),currentMode:"select",currentOverlay:null,currentMaskId:null},i.processProps(s),i.registerClick=i.registerClick.bind(Object(h.a)(i)),i.segRef=l.a.createRef(),i.overtime=!1,i.displayImage=!0,setInterval((function(){i.overtime=!0}),6e4*window.MINUTES),i}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(){var e=this.props.objects;this.props.objects||(e=this.props.stateManager.curFeedState.objects),this.props.isFromCamera&&(e=[]),JSON.stringify(e)!==JSON.stringify(this.objects)&&(this.setState({objectIds:Object(c.a)(Array(e.length).keys()),currentMode:"select",currentOverlay:null,currentMaskId:null}),this.processProps(e))}},{key:"render",value:function(){var e=this;if(["draw_polygon","start_polygon"].includes(this.state.currentMode)){this.displayImage=!1;var t=this.state.objectIds.indexOf(parseInt(this.state.currentMaskId)),a=t>=0?g[t%g.length]:g[this.state.objectIds.length%g.length];return l.a.createElement(m,{img:this.image,object:this.drawing_data.name,tags:this.drawing_data.tags,masks:this.pointMap[this.state.currentMaskId],isMobile:this.props.isMobile,originType:this.originTypeMap[this.state.currentMaskId],color:a,exitCallback:function(){e.setState({currentMode:"select"})},submitCallback:this.drawingFinished.bind(this),deleteLabelHandler:this.deleteLabelHandler.bind(this),dataEntrySubmit:this.dataEntrySubmit.bind(this),mode:"start_polygon"===this.state.currentMode?"drawing":null})}return l.a.createElement("div",null,l.a.createElement("p",null,"Label and outline as ",l.a.createElement("b",null,"many objects as possible.")," Click an object in the image to start. ",this.state.objectIds.length," ","object(s) labeled."),this.state.currentOverlay,l.a.createElement("button",{onClick:function(){return e.newPolygon.bind(e)()}},"New Label"),l.a.createElement("div",null,this.state.objectIds.map((function(t,a){return l.a.createElement("button",{key:t,style:{backgroundColor:e.fullColor(g[a%g.length])},onClick:function(){return e.labelSelectHandler(t)}},e.nameMap[t])}))),l.a.createElement(p,{ref:this.segRef,img:this.image,isFromCamera:this.props.isFromCamera,objects:this.state.objectIds,pointMap:this.pointMap,originTypeMap:this.originTypeMap,colors:g,imageWidth:this.props.imageWidth,onClick:this.registerClick,displayImage:this.displayImage}),l.a.createElement("button",{onClick:this.submit.bind(this)},"Finished annotating objects"))}},{key:"processProps",value:function(e){var t=this;this.nextId=e.length,this.objects=e,this.nameMap={},this.pointMap={},this.propertyMap={},this.originTypeMap={};for(var a=0;a<e.length;a++){var n=e[a];this.nameMap[a]=n.label,this.pointMap[a]=n.mask,this.parsePoints(a),this.propertyMap[a]=n.properties,this.originTypeMap[a]=n.type}void 0!==this.props.image?this.image=this.props.image:(this.image=new Image,this.image.onload=function(){t.forceUpdate()},this.image.src=this.props.imgUrl)}},{key:"parsePoints",value:function(e){for(var t in this.pointMap[e])if(this.pointMap[e][t].length<3)delete this.pointMap[e][t];else{var a=0,n=1,i=0,s=1;for(var o in this.pointMap[e][t]){var r=this.pointMap[e][t][o];a=Math.max(r.x,a),n=Math.min(r.x,n),i=Math.max(r.y,i),s=Math.min(r.y,s)}var l=a-n+i-s,c=l<.06?3:50*l;if(this.pointMap[e][t].length>c){for(var h=[],u=this.pointMap[e][t].length/c,d=0;d<this.pointMap[e][t].length-1;d+=u)h.push(this.pointMap[e][t][parseInt(d)]);this.pointMap[e][t]=h}}}},{key:"drawingFinished",value:function(e,t){if(this.pointMap[this.state.currentMaskId]=e,this.setState({currentMode:"select",objectIds:t?this.state.objectIds.splice(0).concat(this.state.currentMaskId):this.state.objectIds}),t){var a=l.a.createElement(d,{x:this.clickPoint.x,y:this.clickPoint.y,onSubmit:this.dataEntrySubmit.bind(this),includeSubmitButton:!0,isMobile:this.props.isMobile});this.setState({currentMode:"fill_data",currentOverlay:a})}}},{key:"deleteLabelHandler",value:function(){delete this.nameMap[this.state.currentMaskId],delete this.pointMap[this.state.currentMaskId],delete this.propertyMap[this.state.currentMaskId];var e=this.state.objectIds.slice(),t=this.state.objectIds.indexOf(parseInt(this.state.currentMaskId));t>=0&&e.splice(t,1),this.setState({currentMode:"select",currentMaskId:-1,objectIds:e})}},{key:"dataEntrySubmit",value:function(e){this.drawingData=e,this.propertyMap[this.state.currentMaskId]=this.drawingData.tags,this.nameMap[this.state.currentMaskId]=this.drawingData.name,this.setState({currentMode:"select",currentOverlay:null})}},{key:"labelSelectHandler",value:function(e){this.setState({currentMode:"draw_polygon",currentOverlay:null,currentMaskId:e}),this.drawing_data={tags:this.propertyMap[e],name:this.nameMap[e]}}},{key:"registerClick",value:function(e,t,a,n){"select"===this.state.currentMode&&(a?(this.drawing_data={tags:this.propertyMap[n],name:this.nameMap[n]},this.setState({currentMode:"draw_polygon",currentOverlay:null,currentMaskId:n})):"fill_data"!==this.state.currentMode&&this.newPolygon(e,t))}},{key:"newPolygon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(this.drawing_data={tags:null,name:null},this.setState({currentMode:"start_polygon",currentMaskId:this.nextId}),-1===e){var a=this.segRef.current.getCanvasBoundingBox();e=a.left,t=a.top}this.clickPoint={x:e,y:t},this.nextId+=1}},{key:"fullColor",value:function(e){return e.substring(0,e.length-3)+"1)"}},{key:"submit",value:function(){if(this.state.objectIds.length<window.MIN_OBJECTS)alert("Label more objects, or your HIT may be rejected");else{for(var e in this.propertyMap)"string"===typeof this.propertyMap[e]&&(this.propertyMap[e]=this.propertyMap[e].split("\n "));var t={nameMap:this.nameMap,propertyMap:this.propertyMap,pointMap:this.pointMap};this.props.stateManager.socket.emit("saveObjectAnnotation",t),this.props.stateManager.logInteractiondata("object annotation",t),this.props.stateManager.onObjectAnnotationSave(t),this.props.not_turk}}}]),a}(l.a.Component),b=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).props.image?i.initialState={image:i.props.image}:i.initialState={image:void 0},i.state=i.initialState,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return void 0===this.state.image?null:l.a.createElement(f,{image:this.state.image,objects:this.state.objects,not_turk:!0,stateManager:this.props.stateManager,isMobile:this.props.isMobile,imageWidth:this.props.imageWidth,isFromCamera:this.props.isFromCamera})}}]),a}(l.a.Component);t.a=b},60:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=(a(189),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={status:"",world_state:{},flash_bbox:null},i.worldContainerRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"getVoxelWorldInitialState",value:function(){this.props.stateManager.worldSocket.emit("getVoxelWorldInitialState")}},{key:"connectToWorld",value:function(){this.props.stateManager.worldSocket.emit("get_world_info")}},{key:"flashVoxelWorldBlocks",value:function(e){this.setState({flash_bbox:e}),this.worldContainerRef.current.contentWindow.postMessage(this.state,"*"),this.setState({flash_bbox:null})}},{key:"componentDidUpdate",value:function(){this.worldContainerRef.current.contentWindow.postMessage(this.state,"*")}},{key:"componentDidMount",value:function(){var e=this;this.props.stateManager&&(this.props.stateManager.connect(this),this.worldContainerRef.current.contentWindow.addEventListener("message",(function(t){var a=t.data;"set_look"===a.status?e.props.stateManager.worldSocket.emit("set_look",a):"abs_move"===a.status&&e.props.stateManager.worldSocket.emit("abs_move",a)}),!1)),this.getVoxelWorldInitialState(),this.connectToWorld(),window.addEventListener("message",(function(e){try{if("click"===JSON.parse(e.data).msg){var t=document.getElementById("prompt");t&&t.remove()}}catch(a){return!1}}),!1)}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("div",{id:"world-container"},l.a.createElement("iframe",{id:"ifr",src:"VoxelWorld/world.html",title:"Voxel World",width:"100%",height:"1000",ref:this.worldContainerRef}),l.a.createElement("div",{id:"prompt"},l.a.createElement("span",{id:"prompt-text"},"Click in this window to enter 3D world"),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("span",{id:"prompt-text"},"Control: press w/a/s/d to move, space to move up, shift to move down"),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("span",{id:"prompt-text"},"Tip: press 'esc' to leave the 3D world"))),l.a.createElement("p",null,"Tip: press 'esc' to leave the 3D world, w/a/s/d to move, space to move up, shift to move down"))}}]),a}(l.a.Component));t.a=c},64:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(2),o=a(6),r=a(5),l=a(0),c=a.n(l),h=(a(82),a(39)),u=a(172),d=a(173),m=(a(112),a(9)),p={width:600,margin:50},g={minWidth:"60px",display:"inline-block"},f=function(e){Object(o.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).switchAnnotation=function(e){m.a.useDesktopComponentOnMobile=e.target.checked,i.setState({use_old_annotation:m.a.useDesktopComponentOnMobile})},i.initialState={url:i.props.stateManager.url,fps:0,connected:!1,agent_enable_map:!1,image_quality:-1,image_resolution:-1,use_old_annotation:m.a.useDesktopComponentOnMobile},i.props.isMobile&&(p={margin:50}),i.state=i.initialState,i.handleChange=i.handleChange.bind(Object(s.a)(i)),i.handleSubmit=i.handleSubmit.bind(Object(s.a)(i)),i.setImageSettings=i.setImageSettings.bind(Object(s.a)(i)),i.onImageQualityChange=i.onImageQualityChange.bind(Object(s.a)(i)),i.onImageResolutionChange=i.onImageResolutionChange.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"setImageSettings",value:function(e){this.setState(e)}},{key:"handleChange",value:function(e){this.setState({url:e.target.value})}},{key:"handleSubmit",value:function(e){this.props.stateManager.setUrl(this.state.url),e.preventDefault()}},{key:"handleClearSettings",value:function(e){this.props.stateManager.setDefaultUrl()}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.setState({connected:this.props.stateManager.connected}),this.props.stateManager.socket.on("image_settings",this.setImageSettings))}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&(this.props.stateManager.disconnect(this),this.setState({connected:!1}),this.props.stateManager.socket.off("image_settings",this.setImageSettings))}},{key:"onImageQualityChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:e,image_resolution:this.state.image_resolution})}},{key:"onImageResolutionChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:this.state.image_quality,image_resolution:e})}},{key:"render",value:function(){var e,t=this;e=!0===this.state.connected?c.a.createElement("status-indicator",{positive:!0,pulse:!0}):c.a.createElement("status-indicator",{negative:!0,pulse:!0});var a=c.a.createElement("p",null);!0===this.state.agent_enable_map&&(a=c.a.createElement(u.a,{control:c.a.createElement(d.a,{size:"small",onChange:function(){t.props.stateManager.handleMapToggle()}}),label:"Toggle Map: ",labelPlacement:"start"}));var n=!1;return-1===this.state.image_quality&&(n=!0),c.a.createElement("div",null,c.a.createElement("form",{onSubmit:this.handleSubmit},c.a.createElement("label",null,"Server / Robot URL:",c.a.createElement("input",{type:"text",value:this.state.url,onChange:this.handleChange})),c.a.createElement("input",{type:"submit",value:"Reconnect"})),c.a.createElement("form",{onSubmit:this.handleClearSettings},c.a.createElement("input",{type:"submit",value:"Clear Saved Settings"})),this.props.isMobile&&c.a.createElement(u.a,{control:c.a.createElement(d.a,{checked:m.a.useDesktopComponentOnMobile,onChange:this.switchAnnotation}),label:"Use Old Annotation Tool"}),c.a.createElement("p",null," FPS: ",this.state.fps," "),c.a.createElement("p",null," Connection Status: ",e," "),c.a.createElement("div",{style:{position:"absolute",left:"-15px"}},a),c.a.createElement("div",{style:p},c.a.createElement("label",{style:g},"Image Quality: \xa0"),c.a.createElement("span",null,this.state.image_quality),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.image_quality,min:1,max:100,step:1,onChange:this.onImageQualityChange,disabled:n})),c.a.createElement("div",{style:p},c.a.createElement("label",{style:g},"Image Resolution: \xa0"),c.a.createElement("span",null,this.state.image_resolution),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.image_resolution,min:16,max:512,step:16,onChange:this.onImageResolutionChange,disabled:n})))}}]),a}(c.a.Component);t.a=f},682:function(e,t,a){e.exports=a(683)},683:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(23),o=a.n(s),r=a(222),l=a.n(r),c=(a(301),a(302),a(84)),h=a(64),u=a(83),d=a(60),m=a(109),p=a(9),g=a(38);a(279);window.React=i.a,window.ReactDOM=o.a;var f={settings:{showPopoutIcon:!1},content:[{type:"row",content:[{type:"column",content:[{title:"Interact",type:"react-component",component:"InteractApp",props:{stateManager:p.a}}],width:35},{type:"column",content:[{type:"stack",content:[{title:"VoxelWorld",type:"react-component",component:"VoxelWorld",props:{stateManager:p.a}}],height:64},{type:"stack",content:[{title:"Info",type:"react-component",component:"TurkInfo",props:{stateManager:p.a}},{title:"Settings",type:"react-component",component:"Settings",props:{stateManager:p.a}}]}]}]}]},b=new l.a(f);b.registerComponent("MainPane",c.a),b.registerComponent("Settings",h.a),b.registerComponent("TurkInfo",m.a),b.registerComponent("History",u.a),b.registerComponent("VoxelWorld",d.a),b.registerComponent("InteractApp",g.a),b.init(),p.a.dashboardLayout=b},83:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=a(287),h=a(243),u=a(288),d=(a(195),function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"renderChatHistory",value:function(){return this.props.stateManager.memory.chats.map((function(e,t){return l.a.cloneElement(l.a.createElement(h.a,{alignItems:"flex-start"},l.a.createElement("div",{className:"chatItem"},""!==e.msg?l.a.createElement(u.a,{primary:e.msg}):null)),{key:t.toString()})}))}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return l.a.createElement("div",{className:"history"},l.a.createElement("p",null,"The history of the last 5 commands sent to the bot."),l.a.createElement(c.a,null,this.renderChatHistory()))}}]),a}(l.a.Component));t.a=d},84:function(e,t,a){"use strict";var n=a(3),i=a(4),s=a(6),o=a(5),r=a(0),l=a.n(r),c=a(27),h=a(41),u=a(48),d=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={rgb:null,depth:null,objects:null,humans:null},i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this.props.stateManager;return l.a.createElement("div",null,l.a.createElement(c.a,{type:"rgb",height:320,width:320,offsetH:10,offsetW:10,stateManager:e}),l.a.createElement(c.a,{type:"depth",height:320,width:320,offsetH:10,offsetW:340,stateManager:e}),l.a.createElement(h.a,{height:320,width:320,offsetH:340,offsetW:10,stateManager:e}),l.a.createElement(u.a,{height:320,width:320,offsetH:340,offsetW:340,stateManager:e}))}}]),a}(l.a.Component),m=a(60),p=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={agentType:"locobot"},i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){console.log("MainPane rendering agent type: "+this.state.agentType);var e=this.props.stateManager;return"locobot"===this.state.agentType?l.a.createElement(d,{stateManager:e}):"craftassist"===this.state.agentType?l.a.createElement(m.a,{stateManager:e}):(console.log("MainPane received invalid agent type"),l.a.createElement("h1",null,"Error: Invalid agent type"))}}]),a}(l.a.Component);t.a=p},9:function(e,t,a){"use strict";var n=a(20),i=a(122),s=a.n(i),o=a(162),r=a(3),l=a(4),c=a(123),h=a.n(c),u=a(50),d=a(108),m=a(27),p=a(64),g=a(41),f=a(48),b=a(83),v=a(38),y=a(60),k=a(102),E=a(100),M=a(101),w=a(107),_=a(105),S=a(106),j=a(141),C=a(84),x=a(109),O=new(function(){function e(){Object(r.a)(this,e),this.refs=[],this.socket=null,this.worldSocket=null,this.default_url="http://localhost:8000",this.connected=!1,this.initialMemoryState={objects:new Map,humans:new Map,lastChatActionDict:null,memory_entries:null,chats:[{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1}],timelineEvent:"",timelineEventHistory:[],timelineSearchResults:[],timelineDetails:[],timelineFilters:["Perceive","Dialogue","Interpreter","Memory"],timelineSearchPattern:"",agentType:null,commandState:"idle",commandPollTime:500,isTurk:!0,agent_replies:[{}],last_reply:"",dash_enable_map:!1,agent_enable_map:!1,backend:null},this.session_id=null,this.processMemoryState=this.processMemoryState.bind(this),this.setChatResponse=this.setChatResponse.bind(this),this.setLastChatActionDict=this.setLastChatActionDict.bind(this),this.setConnected=this.setConnected.bind(this),this.updateAgentType=this.updateAgentType.bind(this),this.handleAgentWantsMap=this.handleAgentWantsMap.bind(this),this.forceErrorLabeling=this.forceErrorLabeling.bind(this),this.updateStateManagerMemory=this.updateStateManagerMemory.bind(this),this.keyHandler=this.keyHandler.bind(this),this.updateVoxelWorld=this.updateVoxelWorld.bind(this),this.setVoxelWorldInitialState=this.setVoxelWorldInitialState.bind(this),this.memory=JSON.parse(JSON.stringify(this.initialMemoryState)),this.processRGB=this.processRGB.bind(this),this.processDepth=this.processDepth.bind(this),this.processRGBDepth=this.processRGBDepth.bind(this),this.processObjects=this.processObjects.bind(this),this.showAssistantReply=this.showAssistantReply.bind(this),this.processHumans=this.processHumans.bind(this),this.processMap=this.processMap.bind(this),this.handleMapToggle=this.handleMapToggle.bind(this),this.sendManualChange=this.sendManualChange.bind(this),this.returnTimelineEvent=this.returnTimelineEvent.bind(this),this.onObjectAnnotationSave=this.onObjectAnnotationSave.bind(this),this.startLabelPropagation=this.startLabelPropagation.bind(this),this.labelPropagationReturn=this.labelPropagationReturn.bind(this),this.onSave=this.onSave.bind(this),this.saveAnnotations=this.saveAnnotations.bind(this),this.annotationRetrain=this.annotationRetrain.bind(this),this.goOffline=this.goOffline.bind(this),this.handleMaxFrames=this.handleMaxFrames.bind(this);var t=new URLSearchParams(window.location.search),a=t.get("turk_experiment_id"),n=t.get("mephisto_agent_id"),i=t.get("turk_worker_id");this.setTurkExperimentId(a),this.setMephistoAgentId(n),this.setTurkWorkerId(i),this.default_url=window.location.host;var s=localStorage.getItem("server_url");"undefined"!==s&&void 0!==s&&null!==s||(s=this.default_url),this.setUrl(s),this.fps_time=performance.now(),this.curFeedState={rgbImg:null,depth:null,objects:[],origObjects:[],pose:null},this.prevFeedState={rgbImg:null,depth:null,objects:[],pose:null},this.stateProcessed={rgbImg:!1,depth:!1,objects:!1,pose:!1},this.frameCount=0,this.categories=new Set,this.properties=new Set,this.annotationsSaved=!0,this.offline=!1,this.frameId=0,this.offlineObjects={},this.updateObjects=[!1,!1],this.useDesktopComponentOnMobile=!0}return Object(l.a)(e,[{key:"setDefaultUrl",value:function(){localStorage.removeItem("server_url"),this.setUrl(this.default_url)}},{key:"setUrl",value:function(e){this.url=e,localStorage.setItem("server_url",e),this.socket&&this.socket.removeAllListeners(),this.restart(this.url)}},{key:"setTurkExperimentId",value:function(e){localStorage.setItem("turk_experiment_id",e)}},{key:"getTurkExperimentId",value:function(){return localStorage.getItem("turk_experiment_id")}},{key:"setMephistoAgentId",value:function(e){localStorage.setItem("mephisto_agent_id",e)}},{key:"getMephistoAgentId",value:function(){return localStorage.getItem("mephisto_agent_id")}},{key:"setTurkWorkerId",value:function(e){localStorage.setItem("turk_worker_id",e)}},{key:"getTurkWorkerId",value:function(){return localStorage.getItem("turk_worker_id")}},{key:"restart",value:function(e){var t=this;this.socket=h.a.connect(e,{transports:["polling","websocket"]});var a=this.socket;a.on("reconnect_attempt",(function(){a.io.opts.transports=["polling","websocket"]})),a.on("connect",(function(e){var a="";function n(){return(n=Object(o.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.ipify.org/?format=json");case 2:return t=e.sent,e.next=5,t.json();case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(function(){return n.apply(this,arguments)})().then((function(e){a=e.ip;var n=(+new Date).toString(36);t.session_id=a+":"+n,console.log("session id is"),console.log(t.session_id),t.socket.emit("store session id",t.session_id)})),console.log("connect event"),t.setConnected(!0),t.socket.emit("get_memory_objects"),t.socket.emit("get_agent_type"),t.socket.emit("does_agent_want_map");var i=t.worldSocket;window.setTimeout((function(){i.emit("getVoxelWorldInitialState")}),3e3)})),a.on("reconnect",(function(e){console.log("reconnect event"),t.setConnected(!0),t.socket.emit("get_memory_objects"),t.socket.emit("get_agent_type"),t.socket.emit("does_agent_want_map");var a=t.worldSocket;window.setTimeout((function(){a.emit("getVoxelWorldInitialState")}),3e3)})),a.on("disconnect",(function(e){console.log("disconnect event"),t.setConnected(!1),t.memory=t.initialMemoryState,t.refs.forEach((function(e){e instanceof M.a||(e.setState(e.initialState),e.forceUpdate())})),console.log("disconnected")})),a.on("setChatResponse",this.setChatResponse),a.on("setLastChatActionDict",this.setLastChatActionDict),a.on("memoryState",this.processMemoryState),a.on("updateState",this.updateStateManagerMemory),a.on("updateAgentType",this.updateAgentType),a.on("agentWantsMap",this.handleAgentWantsMap),a.on("rgb",this.processRGB),a.on("depth",this.processDepth),a.on("image",this.processRGBDepth),a.on("objects",this.processObjects),a.on("setVoxelWorldInitialState",this.setVoxelWorldInitialState),a.on("showAssistantReply",this.showAssistantReply),a.on("humans",this.processHumans),a.on("map",this.processMap),a.on("newTimelineEvent",this.returnTimelineEvent),a.on("labelPropagationReturn",this.labelPropagationReturn),a.on("annotationRetrain",this.annotationRetrain),a.on("saveRgbSegCallback",this.saveAnnotations),a.on("handleMaxFrames",this.handleMaxFrames);this.worldSocket=h.a.connect("http://localhost:6002",{transports:["polling","websocket"]});var n=this.worldSocket;n.on("connect",(function(e){t.worldSocket.emit("init_player",{player_type:"player",name:"dashboard"})})),n.on("updateVoxelWorldState",this.updateVoxelWorld)}},{key:"updateStateManagerMemory",value:function(e){this.memory=e.memory,this.refs.forEach((function(e){e.forceUpdate()}))}},{key:"updateAgentType",value:function(e){var t=this;this.memory.agentType=e.agent_type,this.refs.forEach((function(e){e instanceof C.a&&e.setState({agentType:t.memory.agentType}),e instanceof v.a&&e.setState({agentType:t.memory.agentType})}))}},{key:"handleAgentWantsMap",value:function(e){var t=this;console.log("agentWantsMap: "+e.agent_enable_map),this.agent_enable_map=e.agent_enable_map,this.refs.forEach((function(e){e instanceof p.a&&e.setState({agent_enable_map:t.agent_enable_map})}))}},{key:"forceErrorLabeling",value:function(e){var t=this;this.memory.isTurk=e,this.memory.agent_replies=[{msg:"Click the 'Start' button to begin!",timestamp:Date.now()}],this.refs.forEach((function(e){e instanceof v.a&&e.setState({isTurk:t.memory.isTurk,agent_replies:t.memory.agent_replies})}))}},{key:"setConnected",value:function(e){this.connected=e,this.refs.forEach((function(t){t instanceof p.a&&t.setState({connected:e}),t instanceof v.a&&t.setState({connected:e})}))}},{key:"setChatResponse",value:function(e){var t=this;j.isMobile&&alert("Received text message: "+e.chat),this.memory.chats=e.allChats,console.log("StateManager setChatResponse"),this.memory.commandState="received",setTimeout((function(){"received"===t.memory.commandState&&(t.memory.commandState="thinking")}),this.memory.commandPollTime-1),this.memory.lastChatActionDict=null,this.memory.memory_entries=null,this.refs.forEach((function(t){t instanceof v.a&&t.setState({status:e.status}),t instanceof b.a&&t.forceUpdate()}))}},{key:"setLastChatActionDict",value:function(e){console.log("StateManager setLastChatActionDict, ad:"),console.log(e.action_dict),this.memory.lastChatActionDict=e.action_dict,this.memory.memory_entries=e.ref_obj_data,this.refs.forEach((function(t){t instanceof v.a&&t.setState({action_dict:e.action_dict,memory_entries:e.ref_obj_data})}))}},{key:"updateVoxelWorld",value:function(e){e.backend&&(this.memory.backend=e.backend),this.refs.forEach((function(t){t instanceof y.a&&t.setState({world_state:e.world_state,status:e.status})}))}},{key:"setVoxelWorldInitialState",value:function(e){this.refs.forEach((function(t){t instanceof y.a&&t.setState({world_state:e.world_state,status:e.status})}))}},{key:"flashBlockInVW",value:function(e){this.refs.forEach((function(t){t instanceof y.a&&t.flashVoxelWorldBlocks(e)}))}},{key:"showAssistantReply",value:function(e){var t,a,n,i,s=this;try{var o=e.content;if(t=o.filter((function(e){return"text"===e.id}))[0].content,"point"===e.content_type)return void("pyworld"===this.memory.backend&&this.flashBlockInVW(t.slice(7)));"chat_and_text_options"===e.content_type?(a=o.filter((function(e){return"response_option"===e.id})).map((function(e){return e.content})),n=!0,i="clarification"):(a=[],n=!1)}catch(r){t=e.agent_reply,a=[],n=!1}this.memory.last_reply=t,this.refs.forEach((function(e){e instanceof v.a&&(e.setState({agent_replies:s.memory.agent_replies,response_options:a}),e.addNewAgentReplies({msg:t,isQuestion:n,questionType:i,enableBack:!1}))}))}},{key:"sendCommandToTurkInfo",value:function(e){this.refs.forEach((function(t){t instanceof x.a&&t.calcCreativity(e)}))}},{key:"updateTimeline",value:function(){this.refs.forEach((function(e){e instanceof k.a&&e.forceUpdate()}))}},{key:"returnTimelineEvent",value:function(e){this.memory.timelineEventHistory.push(e),this.memory.timelineEvent=e,this.updateTimeline(),"perceive"===JSON.parse(e).name&&(this.memory.commandState="done_thinking",this.refs.forEach((function(e){e instanceof v.a&&e.sendTaskStackPoll()}))),"interpreter"===JSON.parse(e).name&&(this.memory.commandState="executing")}},{key:"updateTimelineResults",value:function(){this.refs.forEach((function(e){e instanceof E.a&&e.forceUpdate()}))}},{key:"keyHandler",value:function(e){var t=[],a=[];for(var n in e){var i=e[n];n=parseInt(n),a.push(n),!0===i&&(38===n&&t.push("MOVE_FORWARD"),40===n&&t.push("MOVE_BACKWARD"),37===n&&t.push("MOVE_LEFT"),39===n&&t.push("MOVE_RIGHT"),49===n&&t.push("PAN_LEFT"),50===n&&t.push("PAN_RIGHT"),51===n&&t.push("TILT_UP"),52===n&&t.push("TILT_DOWN"))}if(t.length>0){var s={};for(var o in this.refs.forEach((function(e){e instanceof S.a&&(s=e.state)})),this.socket.emit("movement command",t,s),a)e[a[o]]=!1}}},{key:"buttonHandler",value:function(e){e.length>0&&this.socket.emit("movement command",e)}},{key:"logInteractiondata",value:function(e,t){var a={};a.session_id=this.session_id,a.mephisto_agent_id=this.getMephistoAgentId(),a.turk_worker_id=this.getTurkWorkerId(),a[e]=t,this.socket.emit("interaction data",a)}},{key:"onObjectAnnotationSave",value:function(e){var t=this,a=e.nameMap,n=e.pointMap,i=e.propertyMap,s=[];for(var o in a){for(var r=o<this.curFeedState.objects.length,l=r?this.curFeedState.objects[o].id:null,c=r?this.curFeedState.objects[o].xyz:null,h=0;h<n[o].length;)!n[o][h]||n[o][h].length<3?n[o].splice(h,1):h++;var u=n[o].map((function(e){return e.map((function(e,t){return[500*e.x,500*e.y]}))})),d=this.getNewBbox(u);s.push({label:a[o],mask:u,properties:i[o].join("\n "),type:"annotate",id:l,bbox:d,xyz:c})}this.curFeedState.objects=s,this.annotationsSaved=!1,this.refs.forEach((function(e){e instanceof g.a&&e.setState({objects:t.curFeedState.objects,updateFixup:!0})})),this.offline&&(this.offlineObjects[this.frameId]=this.curFeedState.objects)}},{key:"getNewBbox",value:function(e){for(var t=[],a=[],n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)t.push(e[n][i][0]),a.push(e[n][i][1]);var s=Math.min.apply(null,t),o=Math.max.apply(null,t);return[s,Math.min.apply(null,a),o,Math.max.apply(null,a)]}},{key:"startLabelPropagation",value:function(){var e=this,t=this.prevFeedState.objects.filter((function(e){return"annotate"===e.type}));for(var a in t){this.categories.add(t[a].label),t[a].properties.split("\n ").forEach((function(t){return e.properties.add(t)}))}if(t.length>0){var i={prevRgbImg:this.prevFeedState.rgbImg,depth:this.curFeedState.depth,prevDepth:this.prevFeedState.depth,objects:t,basePose:this.curFeedState.pose,prevBasePose:this.prevFeedState.pose};this.socket.emit("label_propagation",i)}if(!this.annotationsSaved){var s={rgb:this.prevFeedState.rgbImg,objects:t,frameCount:this.frameCount,categories:[null].concat(Object(n.a)(this.categories))};this.socket.emit("save_rgb_seg",s),this.annotationsSaved=!0}this.stateProcessed.rgbImg=!0,this.stateProcessed.depth=!0,this.stateProcessed.objects=!0,this.stateProcessed.pose=!0,this.frameCount++}},{key:"labelPropagationReturn",value:function(e){var t=this;this.refs.forEach((function(a){if(a instanceof g.a)for(var n in e){for(var i=0;i<e[n].mask.length;)!e[n].mask[i]||e[n].mask[i].length<3?e[n].mask.splice(i,1):i++;e[n].bbox=t.getNewBbox(e[n].mask),a.addObject(e[n]),t.curFeedState.objects.push(e[n])}})),this.offline&&(this.offlineObjects[this.frameId]=this.curFeedState.objects),Object.keys(e).length>0&&(this.annotationsSaved=!1)}},{key:"checkRunLabelProp",value:function(){return this.curFeedState.rgbImg&&this.curFeedState.depth&&this.curFeedState.objects.length>0&&this.curFeedState.pose&&this.prevFeedState.rgbImg&&this.prevFeedState.depth&&this.prevFeedState.objects.length>0&&this.prevFeedState.pose&&!this.stateProcessed.rgbImg&&!this.stateProcessed.depth&&!this.stateProcessed.objects&&!this.stateProcessed.pose}},{key:"onSave",value:function(){var e=this;if(console.log("saving annotations, categories, and properties"),this.offline){for(var t in this.offlineObjects){var a=this.offlineObjects[t];for(var i in a){var s=a[i];this.categories.add(s.label),s.properties.split("\n ").forEach((function(t){return e.properties.add(t)}))}}var o=[null].concat(Object(n.a)(this.categories)),r=Object(n.a)(this.properties);this.socket.emit("save_categories_properties",o,r);var l=0;for(var c in this.offlineObjects){var h=this.offlineObjects[c],u=l===Object.keys(this.offlineObjects).length-1,d={filepath:this.filepath,frameId:parseInt(c),outputId:l,objects:h,categories:o,finalFrame:u};this.socket.emit("offline_save_rgb_seg",d),l++}}else if(this.annotationsSaved)this.saveAnnotations();else{var m=this.curFeedState.objects.filter((function(e){return"annotate"===e.type}));for(var p in m){this.categories.add(m[p].label),m[p].properties.split("\n ").forEach((function(t){return e.properties.add(t)}))}var g={rgb:this.curFeedState.rgbImg,objects:m,frameCount:this.frameCount,categories:[null].concat(Object(n.a)(this.categories)),callback:!0};this.socket.emit("save_rgb_seg",g),this.annotationsSaved=!0}}},{key:"saveAnnotations",value:function(){var e=[null].concat(Object(n.a)(this.categories)),t=Object(n.a)(this.properties);this.socket.emit("save_annotations",e),this.socket.emit("save_categories_properties",e,t)}},{key:"annotationRetrain",value:function(e){console.log("retrained!"),this.refs.forEach((function(t){(t instanceof g.a||t instanceof _.a)&&t.setState({modelMetrics:e})}))}},{key:"goOffline",value:function(e){console.log("Going offline with filepath",e),this.filepath=e,this.frameId=0,this.offline=!0,this.socket.emit("get_offline_frame",{filepath:this.filepath,frameId:this.frameId}),this.socket.emit("start_offline_dashboard",e),this.refs.forEach((function(e){e instanceof g.a&&e.setState({objects:[],modelMetrics:null,offline:!0})}))}},{key:"handleMaxFrames",value:function(e){this.maxOfflineFrames=e,console.log("max frames:",e)}},{key:"offlineLabelProp",value:function(e,t){var a=this.offlineObjects[e],n={filepath:this.filepath,srcFrame:e,curFrame:t,objects:a};this.socket.emit("offline_label_propagation",n)}},{key:"previousFrame",value:function(){var e=this;if(0!==this.frameId){this.frameId--,console.log("Prev frame",this.frameId),this.socket.emit("get_offline_frame",{filepath:this.filepath,frameId:this.frameId}),this.curFeedState.objects=this.offlineObjects[this.frameId]||[],this.refs.forEach((function(t){t instanceof g.a&&t.setState({objects:e.curFeedState.objects})}));var t=this.offlineObjects[this.frameId]&&this.offlineObjects[this.frameId].length>0;this.offlineObjects[this.frameId+1]&&!t&&this.offlineLabelProp(this.frameId+1,this.frameId)}else console.log("no frames under 0")}},{key:"nextFrame",value:function(){var e=this;if(this.frameId!==this.maxOfflineFrames){this.frameId++,console.log("Next frame",this.frameId),this.socket.emit("get_offline_frame",{filepath:this.filepath,frameId:this.frameId}),this.curFeedState.objects=this.offlineObjects[this.frameId]||[],this.refs.forEach((function(t){t instanceof g.a&&t.setState({objects:e.curFeedState.objects})}));var t=this.offlineObjects[this.frameId]&&this.offlineObjects[this.frameId].length>0;this.offlineObjects[this.frameId-1]&&!t&&this.offlineLabelProp(this.frameId-1,this.frameId)}else console.log("no frames over",this.maxOfflineFrames)}},{key:"processMemoryState",value:function(e){this.refs.forEach((function(t){t instanceof d.a&&t.setState({isLoaded:!0,memory:e})}))}},{key:"processRGB",value:function(e){var t=this;if(this.curFeedState.rgbImg!==e){var a=new Image;a.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof m.a&&"rgb"===e.props.type&&e.setState({isLoaded:!0,rgb:a}),t.offline&&e instanceof g.a&&e.setState({rgb:a})})),this.prevFeedState.rgbImg=this.curFeedState.rgbImg,this.curFeedState.rgbImg=e,this.stateProcessed.rgbImg=!1,this.updateObjects=[!0,!0]}this.checkRunLabelProp()&&this.startLabelPropagation()}},{key:"processDepth",value:function(e){if(this.curFeedState.depth!==e){var t=new Image;t.src="data:image/webp;base64,"+e.depthImg,this.refs.forEach((function(e){e instanceof m.a&&"depth"===e.props.type&&e.setState({isLoaded:!0,depth:t})})),this.prevFeedState.depth=this.curFeedState.depth,this.curFeedState.depth={depthImg:e.depthImg,depthMax:e.depthMax,depthMin:e.depthMin},this.stateProcessed.depth=!1}this.checkRunLabelProp()&&this.startLabelPropagation()}},{key:"processRGBDepth",value:function(e){this.processRGB(e.rgb),this.processDepth(e.depth)}},{key:"processObjects",value:function(e){if(-1!==e.image&&void 0!==e.image){var t=new Image;t.src="data:image/webp;base64,"+e.image.rgb;for(var a=0;a<e.objects.length;){for(var n=0;n<e.objects[a].mask.length;)!e.objects[a].mask[n]||e.objects[a].mask[n].length<3?e.objects[a].mask.splice(n,1):n++;0!==e.objects[a].mask.length?a++:e.objects.splice(a,1)}e.objects.forEach((function(e){e.type="detector"})),this.updateObjects[1]&&(this.prevFeedState.objects=this.curFeedState.objects,this.curFeedState.objects=JSON.parse(JSON.stringify(e.objects)),this.curFeedState.origObjects=JSON.parse(JSON.stringify(e.objects)),this.stateProcessed.objects=!1,this.updateObjects=[!1,!1],this.refs.forEach((function(a){a instanceof g.a?a.setState({objects:e.objects,rgb:t,height:e.height,width:e.width,scale:e.scale}):a instanceof w.a&&a.setState({objectRGB:t})}))),this.updateObjects[0]&&(this.updateObjects[1]=!0),this.checkRunLabelProp()&&this.startLabelPropagation()}}},{key:"processHumans",value:function(e){if(-1!==e.image&&void 0!==e.image){var t=new Image;t.src="data:image/webp;base64,"+e.image.rgb,this.refs.forEach((function(a){a instanceof f.a&&a.setState({isLoaded:!0,humans:e.humans,rgb:t,height:e.height,width:e.width,scale:e.scale})}))}}},{key:"processMap",value:function(e){var t=this;this.refs.forEach((function(a){a instanceof u.a&&a.setState((function(a){return{isLoaded:!0,detections_from_memory:e.detections_from_memory,memory:t.memory,triples:e.triples,bot_xyz:[e.x,e.y,e.yaw],bot_data:e.bot_data,obstacle_map:e.map,map_update_count:a.map_update_count+1}}))})),this.curFeedState.pose&&(!e||e.x===this.curFeedState.pose.x&&e.y===this.curFeedState.pose.y&&e.yaw===this.curFeedState.pose.yaw)||(this.prevFeedState.pose=this.curFeedState.pose,this.curFeedState.pose={x:e.x,y:e.y,yaw:e.yaw},this.stateProcessed.pose=!1),this.checkRunLabelProp()&&this.startLabelPropagation()}},{key:"handleMapToggle",value:function(){this.dash_enable_map=!this.dash_enable_map,this.socket.emit("toggle_map",{dash_enable_map:this.dash_enable_map})}},{key:"sendManualChange",value:function(e){this.socket.emit("manual_change",e)}},{key:"connect",value:function(e){this.refs.push(e)}},{key:"disconnect",value:function(e){this.refs=this.refs.filter((function(t){return t!==e}))}}]),e}());t.a=O},94:function(e,t,a){}},[[682,157,0,1]]]);